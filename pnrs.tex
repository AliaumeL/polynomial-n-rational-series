%! TeX program = xelatex
%! lang = en-US
\documentclass[sigconf,natbib=false,screen, review,anonymous]{acmart}



% INPUTS
\input{globals/packages}
\input{globals/colorscheme}

% CONFIG
\input{globals/macros}
\input{globals/mathdefs}
\input{globals/knowledges.kl}
\input{globals/metadata}

\usepackage{comment}
%\includecomment{forshort}
%\excludecomment{proof}



\makeabstract
% DOCUMENT
\begin{document}

% FRONT MATTER
\maketitle
\acknowledge

\section{TODOs}

\begin{itemize}
    \item Use $\Nat$-polyregular functions all the time, and just 
        in the introduction talk about $\Nat$-rational series.
    \item Prove that $\Nat$-rational series of polynomial 
        growth are $\Nat$-polyregular functions, maybe using
        the results about ambiguity in automata?
        Theorem 5.22
    \item Define commutativity by a map 
        $\commute \colon \Sigma^* \topartial \Nat^{\Sigma}$.
    \item Define "commutative functions" and its symbol.
    \item Define "computed by" (like, recognised by) for commutative 
        functions.
    \item Change \cref{corrected-version:thm} to use directly
        star-free!
    \item Clear up the computability problems.
    \item Polynomial + Npolyregular => star free?
    \item Polynomial + N rational => N polyregular?
    \item cite the paper of Quantitative Monadic Second-Order Logic
        about why it is interesting class.
\end{itemize}


% MAIN MATTER
\section{Introduction}


There has been recent interest in $\Rel$ and $\Nat$-rational series exhibiting
\emph{polynomial growth} \cite{doueneau2021pebble,bojanczyk2022transducers}.
This computational model, in the counting case, can be traced back to a model
introduced by \textcite{schutzenberger1965finite}. It has been recently proven
that one can decide the growth rate of such functions, and decide whether they
are aperiodic in the case of $\Rel$-rational series \cite{LOPEZ23b}. Isolating
a notion of aperiocidity for functions, and deciding this property is often a
non-trivial process \cite{droste2019aperiodic}. It was conjectured in the PhD
thesis of Gaëtan Douéneau-Tabot, that the membership problem of $\Nat$-rational
series among $\Rel$-rational series was decidable under the assumption of
polynomial growth. The semantic characterization would imply that
$\Nat$-rational series of polynomial growth that are aperiodic are precisely
$\Nat$-rational series of polynomial growth, that can be realised by
$\Rel$-rational series that are aperiodic. This conjecture was based on the
previously introduced result of \textcite[Theorem 3.3]{KARH77}, which we will
disprove in \cref{sec:c-example}. 
We then provide a corrected version of the theorem, and prove the conjecture
of Douéneau in the case of \emph{commutative} $\Nat$-rational series of
polynomial growth.

\section{Preliminaries}


\begin{definition}[$\Rel$-polyregular functions, {\cite[see, e.g.]{LOPEZ23b}}]
    Let $M$ be a finite monoid, $\mu \colon \Sigma^* \to M$
    be a morphism, $k \in \Nat$, and 
    $\pi \colon M^k \to \Rel$ be a production function.
    The \intro{$\Rel$-polyregular function}
    $\pi^\dagger \colon \Sigma^* \to \Rel$
    is computed as follows:
    \begin{equation*}
        f(w) \defined
        \sum_{w = u_1 \cdots u_k} \pi(\mu(u_1), \dots, \mu(u_k))
        \quad .
    \end{equation*}

    When $\pi$ has co-domain $\Nat$, the function $\pi^\dagger$
    is called \intro{$\Nat$-polyregular}.
\end{definition}



\begin{fact}[{\cite[Exercise 1.2 p 169]{berstel2011noncommutative}}]
    \label{polynomial-rational-polyreg:fact}
    Let $\Sigma$ be a finite alphabet, and $f \colon \Sigma^* \topartial \Nat$
    be a function. The following are equivalent:
    \begin{enumerate}
        \item $f$ can be computed as a \k{$\Nat$-rational series}
            of \kl{polynomial growth}.
        \item $f$ is a \kl{$\Nat$-polyregular function}.
    \end{enumerate}
\end{fact}

\begin{definition}[Letter Counting Function]
    \label{commutative-map:def}
    Let $\Sigma$ be a finite alphabet. We define
    $\commute \colon \Sigma^* \topartial \Nat^\Sigma$ for the
    map that counts occurrences of every letter in the input word, namely:
    \begin{equation*}
        \commute[w] \defined \seqof{\card[a]{w}}{a \in \Sigma} \quad .
    \end{equation*}
\end{definition}

\begin{definition}[Commutative Function]
    \label{commutative:def}
    Let $X$ be a set.
    A function $f \colon \Sigma^* \to X$ is
    \intro{commutative} whenever
    for all $u,v \in \Sigma^*$, $f(uv) = f(vu)$.

    Equivalently, it is \reintro{commutative} whenever
    there exists a map $g \colon \Nat^\Sigma \to X$
    such that $g \circ \commute = f$.
\end{definition}


\begin{definition}[Represented Function]
    A function $g \colon \Nat^n \to \Rel$
    is \intro{represented} by a function $f \colon \Sigma^* \to \Rel$
    if there exists a map $\mu \colon \set{1, \dots, n} \to \Sigma$
    such that
    $g \circ (v \mapsto \seqof{v_{\mu(k)}}{1 \leq k \leq n}) \circ \commute = f$.
\end{definition}



We need, $\ZRat$, $\NRat$, $\ZPoly$, $\NPoly$, $\ZSF$, and $\NSF$.


We will start by formally stating the result of \citeauthor{KARH77}
in terms of polynomials and commutative $\Nat$-rational series, and
then introduce the necessary definitions. The characterization of
commutative $\Nat$-rational series computing polynomial functions
is described in terms of a class $\CoveredPoly[\vec{X}]$ of
polynomials with multiple indeterminate.

\begin{definition}[{\cite[Section 3, page 3]{KARH77}}]
    Let $\vec{X}$ be a finite tuple of indeterminate.
    The class $\CoveredPoly[\vec{X}]$
    is the class of polynomials $P \in \Rel[\vec{X}]$
    that are \kl{non-negative}
    and such that every \kl{maximal monomial} has a \kl{positive coefficient}.
    When the indeterminate are clear from the context, we write
    this class $\CoveredPoly$.
\end{definition}

We use the term \kl{$\Nat$-rational polynomial}, that will formally be
stated later on, to denote polynomials that can be computed via a
$\Nat$-rational series. In the upcoming theorem, this property
which is \emph{a priori} difficult to decide is reduced to 
the positivity of the polynomial, and the positivity of \emph{some}
coefficients. 


\begin{faketheorem}[{\cite[Theorem 3.3, page 4]{KARH77}}] 
    \label{karh:thm}
    Let $\Sigma$ be a finite alphabet.
    The set of \kl{$\Nat$-rational polynomials} over $\Sigma$
    coincides with $\CoveredPoly[\seqof{X_a}{a \in \Sigma}]$.
\end{faketheorem}

It is not clearly stated in \cite{KARH77}, but \cref{karh:thm} implies the
decidability of \kl{$\Nat$-rational polynomial} inside polynomials with $\Rel$
coefficients. We will not formalize this statement yet, as \cref{karh:thm} does
not hold in general.


We then provide in \cref{sec:proof} a
corrected version of the theorem, together with a valid proof. As a
consequence, it does not invalidate the stated conjecture.

\begin{itemize}
    \item commutative input and output
    \item commutative output
    \item no commutativity ?
\end{itemize}

\AP \paragraph*{Rational series and regular languages.} This paper uses notions
of regularity and results about \kl{$\Nat$-rational series}, however most of
the technicalities will stem from the multiple indeterminate of polynomials,
and all there is to know about regularity in this document will be confined to
the following facts. For a survey about (non-commutative) rational series, we
refer the reader to \cite{berstel2011noncommutative}. 

\begin{definition}[Rational series]
    The following are equivalent
    \begin{itemize}
        \item weighted automata
        \item rational expressions
        \item 
    \end{itemize}
\end{definition}

\begin{fact}[Folklore about regular languages]
    \label{regular:fact}
    The language $\setof{ w \in \Sigma}{ \card[a]{w} = \card[b]{w}}$
    is not regular, whenever $a,b \in \Sigma$.
    Regular languages are closed under intersection.
\end{fact}

\begin{fact}
    \label{pre-image-regular:fact}
    The pre-image of a regular language by a $\Nat$-rational series
    is a regular language. In particular,
    for all $\Nat$-rational series $S$, $S^{-1}(\set{0})$ is a regular
    language.
\end{fact}



\AP \paragraph*{Polynomials.} All polynomials considered in this paper have
coefficients in $\Rel$ unless explicitly stated otherwise. A polynomial $P \in
\Rel[\seqof{X_a}{a \in \Sigma}]$ is a \intro{$\Rel$-rational polynomial} if
there exists a \reintro{commutative} $\Rel$-rational series $f$ such that $f(w)
= P(\seqof{ \card[a]{w} }{a \in \Sigma})$. Similarly, $P$ is a
\intro{$\Nat$-rational polynomial} if the \reintro{commutative} $\Rel$-rational
series is in fact $\Nat$-rational. Beware that we only apply the polynomial
to \emph{non-negative} values.

\begin{example}
    \label{negative-not-nrat:ex}
    With $\Sigma \defined \set{1}$,
    the polynomials $X_1$, and $X_1^2 + 3$ are \kl{$\Nat$-rational polynomial},
    but $- X_1$ is a \kl{$\Rel$-rational polynomial} that is 
    not a \kl{$\Nat$-rational polynomial}.
\end{example}
\begin{proof}
    The function $w \mapsto |w|$ is a \kl{polyregular function} with unary
    output of \kl{polynomial growth}, hence  can be computed by a
    \kl{$\Nat$-rational series}. Hence, $P(X_1) \defined X_1$ is
    a \kl{$\Nat$-rational polynomial}. Similarly,
    $w \mapsto |w|^2 + 3$ is a \kl{$\Nat$-rational series},
    showing that $Q(X_1) \defined X_1^2 + 3$
    is a \kl{$\Nat$-rational polynomial}.
    Finally, 
    $T(X_1) \defined - X_1$ cannot be $\Nat$-rational as $\Nat$-rational series
    have non-negative output.
\end{proof}

We saw in \cref{negative-not-nrat:ex}
a simple criterion to check whether a polynomial is $\Nat$-rational,
but being non-negative is not enough, as the following example
illustrates. Note that the proof scheme
of this example will be at the core of \cref{thm:counter-example}.

\begin{example}
    Over a binary alphabet $\Sigma \defined \set{a,b}$,
    the polynomial $P(X_a, X_b) \defined (X_a - X_b)^2$
    is a \kl{$\Rel$-rational polynomial} that is \kl{non-negative},
    but is
    not a \kl{$\Nat$-rational polynomial}.
\end{example}
\begin{proof}
    Assume by contradiction that
    $S$ is a $\Nat$-rational series computing $P$.
    Then, $S^{-1}(\set{0})$ should be a regular language
    (\cref{pre-image-regular:fact}),
    but $S^{-1}(\set{0}) = \setof{ w \in \Sigma }{ \card[a]{w} = \card[b]{w} }$
    is not a regular language (\cref{regular:fact}).
\end{proof}


\AP Let us now give some vocabulary on polynomials with multiple indeterminate
over $\Rel$. A \intro{monomial} is a product of variables and integers. For
instance, $XY$ is a \kl{monomial}, $3 X$ is a \kl{monomial}, but $X + Y$ or
$2X^2 + XY$ are not.

\AP A polynomial $P \in \Rel[X_1, \dots, X_k]$ is \intro{non-negative} if
$P(n_1, \dots, n_k) \geq 0$ for all $n_1, \dots, n_k \geq 0$. Beware that we do
not consider negative values, as the numbers $n_i$ will ultimately count the
number of occurrences of a letter in a word. As an example, the polynomial $(X
- Y)^2$ is \kl{non-negative}, and so is the polynomial $X^3$, but the
polynomial $X^2 - 2X$ is not.

\AP
In a polynomial $P \in \Rel[X_1, \dots, X_k]$, a monomial 
is a \intro{maximal monomial} if it is a maximal element
for the visibility ordering of polynomials \emph{in $\Rat$}
among monomials with non-zero coefficients in $P$.\footnote{
    One could equivalently define maximal elements by removing the (non-zero)
    multiplicative constant of the monomials, and then
    considering the usual divisibility relation of $\Rel$ polynomials.
}
In the polynomial 
$P(X,Y) \defined X^2 - 2XY + X^2 + X + Y$, the \reintro{maximal monomials}
are $X^2$, $-2 XY$, and $X^2$.
A \kl{monomial} has \intro{positive coefficient} in a polynomial $P$ if its
multiplicative constant is positive. In the polynomial $P(X,Y) \defined (X -
Y)^2$, the \kl{positive monomials} are $X^2$ and $Y^2$.


\paragraph*{Outline of the paper.}
todo.

\section{The Counter Example}
\label{sec:c-example}

Let us now introduce the counter example that was found trying to generalise
the original proof to non-commutative \kl{$\Rel$-rational series} of
\kl{polynomial growth}. The counter example will use three indeterminate, and
we will prove in \cref{sec:proof} that \citeauthor{KARH77}’s theorem holds on
polynomial with at most two indeterminate.

\begin{definition}[Counter Example Polynomial]
    \label{def:bad-polynomial}
    We define $P(X,Y,Z) \defined Z (X + Y)^2 + 2 (X - Y)^2$.
\end{definition}

\begin{theorem}
    \label{thm:counter-example}
    Over $\Sigma \defined \set{a,b,c}$,
    there exists a polynomial $P \in \CoveredPoly$ that is not
    a \kl{$\Nat$-rational polynomial}. Namely,
    $P$ is the polynomial of \cref{def:bad-polynomial}.
\end{theorem}
\begin{proof}
    Let us write $X,Y,Z$ instead of $X_a, X_b, X_c$ to improve
    readability.
    It is clear that $P$ is \kl{non-negative}. We can develop
    the expression of $P$ to 
    obtain
    $P = ZX^2 + ZY^2 + 2ZXY + 2X^2 -4XY + 2Y^2$.
    The \kl{maximal monomials} of $P$
    are $ZX^2$, $ZY^2$, and $2ZXY$, all of which have
    \kl{positive coefficients}.

    Assume by contradiction that $P$ is a \kl{$\Nat$-rational polynomial}.
    There exists a \kl{commutative}
    $\Nat$-rational series $f \colon \Sigma \topartial \Nat$
    such that $P(\card[a]{w}, \card[b]{w}, \card[c]{w}) = f(w)$.
    Remark that $P(X,Y,Z) = 0$
    if and only if $Z(X+Y)^2 = -2 (X-Y)^2$. Hence,
    $P(X,Y,Z)=0$ if and only if $Z = 0$ and $X = Y$, or 
    $Z \neq 0$, and $X = Y = 0$.

    Now, let us consider the language $L \defined \setof{w}{ f(w) = 0}$. By the
    above computation, we conclude that $L = \setof{ w \in \set{a,b}^* }{
    \card[a]{w} = \card[b]{w} } \cup \set{ c }^*$.
    Because $L \cap \set{a,b}^*$ is notoriously not a regular language
    (\cref{regular:fact}), we
    conclude that $L$ is not a regular language.
    However, $L = f^{-1}(\set{0})$, which is a regular language
    because $f$ is a $\Nat$-rational series
    (\cref{pre-image-regular:fact}).
\end{proof}

\begin{corollary}
    The result stated in \cite[Theorem 3.3]{KARH77}, restated
    in \cref{karh:thm}, is false
    for all polynomials with at least $3$ indeterminate.
\end{corollary}

As we will see in the next section, the characterization
of \kl{$\Nat$-rational polynomials} using the set $\CoveredPoly$
holds when the polynomials have at most $2$ indeterminate. This shows
that the examples in \cite{KARH77} are not invalidated, as they
all use at most two indeterminate.

\section{The Corrected Theorem}
\label{sec:proof}

Let us now provide another class of polynomials, $\CorrectPoly$, that restricts
$\CoveredPoly$ to a subset that is ``closed under fixing indeterminate", namely,
polynomials $P(X_1, \dots, X_n) \in \CoveredPoly$ such that partially evaluated
polynomials remain in $\CoveredPoly$. We use the following notation
to fix the value of some indeterminate
$\intro*\restr{P(X,Y)}{X = 1}$ is the polynomial $P(1,Y)$. More generally, if $\nu$ is
a partial function from $\vec{X}$ to $\Nat$, the restriction
$\restr{P(\vec{X})}{\nu}$ is the polynomial with indeterminate $\vec{Y}
\defined \vec{X} - \dom(\nu)$ obtained by fixing the variables of the domain of
$\nu$.


\begin{definition}
    Let $\vec{X}$ be a finite tuple of indeterminate.
    The class $\CorrectPoly[\vec{X}]$ is the collection of
    polynomials $P \in \Rel[\vec{X}]$ such that
    $P$ is 
    such that, for every partial function $\nu \colon \vec{X} \topartial \Nat$,
    every \kl{maximal monomial} of
    $\restr{P}{\nu}$ has a \kl{positive coefficient}.
\end{definition}

First, let us remark that $\CorrectPoly \subseteq \CoveredPoly$, because
polynomials in $\CorrectPoly$ are \kl{non-negative}. Let us also check that the
counter example provided in \cref{thm:counter-example} is not in
$\CorrectPoly$. For that, notice that for $P$ defined in
\cref{def:bad-polynomial}, $P(X,Y,1) = 3X^2 + 3Y^2 - 2XY$, which has a negative
coefficient for a \kl{maximal monomial}, namely $-2XY$. Let us also assert that
polynomials that have all coefficients in $\Nat$ are \kl{$\Nat$-rational
polynomials}, which will be a base case in an upcoming induction.

\begin{remark}
    \label{inductive-correct-poly:remark}
    Let $P \in \Rel[X,\vec{Y}]$ be a polynomial.
    The following are equivalent:
    \begin{enumerate}
        \item $P \in \CorrectPoly$,
        \item The \kl{maximal monomials} of 
            $P$ have \kl{positive coefficients},
            and 
            for all $n \in \Nat$,
            $\restr{P}{X = n} \in \CorrectPoly$.
    \end{enumerate}
    Furthermore, if $P \in \Rel[]$ is a polynomial without
    indeterminate, then $P \in \CorrectPoly$ if and only
    if its \kl{maximal monomial} (the constant term)
    has a \kl{positive coefficient}.
\end{remark}
\begin{proof}
    By induction on the number of indeterminate,
    leveraging the fact that if there exists at least one indeterminate
    $X$, i.e., that $\vec{X} = X \vec{Y}$, then for all $n \in \Nat$
    and partial function $\nu \colon \vec{Y} \topartial \Nat$,
    we have 
    \begin{equation*}
        \restr{\left(\restr{P}{X = n}\right)}{\nu} = \restr{P}{ \nu[X = n]}
        \quad
        ,
    \end{equation*}
    where $\nu[X = n]$ is the partial function from
    $\vec{X}$ to $\Nat$ that coincides with $\nu$ on $\vec{Y}$
    and maps $X$ to $n$.
\end{proof}

\begin{example}
    \label{n-poly-n-poly:example}
    Let $P \in \Nat[\vec{X}]$. Then, $P$
    is a \kl{$\Nat$-rational polynomial}.
\end{example}
\begin{proof}
    Let $P \in \Nat[\vec{X}]$, and $\nu \colon \vec{X} \topartial \Nat$
    be a partial function.
    Notice that $\restr{P}{\nu}$ continues to be
    a polynomial with \kl{positive coefficients}, and in particular
    with 
    \kl{maximal monomials} having \kl{positive coefficients}.
\end{proof}

Let us now prove that \kl{$\Nat$-rational polynomials} are in $\CorrectPoly$.
To simplify the reasoning, we will use results on $\Nat$-polyregular functions,
also known as, polyregular functions with unary output
\cite{doueneau2021pebble,bojanczyk2019string}. Note that the connection between
rational series and polyregular functions is not specific to $\Nat$, as
$\Rel$-rational series of polynomial growth are computed as polyregular
functions with output in $\set{+1,-1}$ post-composed with computing the sum of
outputted letters \cite{LOPEZ23b}. Because we only consider functions with
output in $\Rel$, and that a commutative output monoid simplifies the definitions,
let us only define $\Rel$-polyregular functions.

The following \cref{n-poly-combinatorics:lem} is a slight refinement over the
classical combinatorial analysis of \kl{$\Rel$-polyregular functions}
\cite[Lemma 4.16]{LOPEZ23b} and \kl{$\Nat$-polyregular functions} that takes
into account \emph{all} \kl{maximal monomials} instead of a specific one
\cite[Lemma 5.37]{gaetanphd}.

\begin{lemma}
    \label{n-poly-combinatorics:lem}
    Let $f$ be a  \kl{$\Nat$-polyregular} function. 
    There exists $\omega \in \Nat$
    such that for all $p \in \Nat$,
    for all $\alpha_0, \dots, \alpha_p \in \Sigma^*$,
    for all $u_1, \dots, u_p \in \Sigma^*$,
    there exists a polynomial $P \in \Rel[X_1, \dots, X_p]$
    whose \kl{maximal monomials} have \kl{positive coefficients},
    and such that for all $X_1, \dots, X_p \geq \omega$:
    \begin{equation*}
        f\left(
            \alpha_0 \prod_{i = 1}^p (u_i^{\omega \times X_i} \alpha_i)
        \right)
        = P(X_1, \dots, X_p) \quad .
    \end{equation*}
\end{lemma}
\begin{proof}
    Let $\omega$ be an idempotent power for the finite monoid $M$,
    and
    $w \defined \alpha_0 \prod_{i = 1}^p (u_i^{\omega \times X_i} \alpha_i)$.
    Let $k \in \Nat$, and $\pi \colon M^k \topartial \Nat$ be such that
    $f = \pi^\dagger$. That is, 
    $f(w)$ is the sum over all factorizations of $w$
    into $k$ words $(w_1, \dots, w_k) \in \Sigma^*$
    of the value $\pi(\mu(w_1), \dots, \mu(w_k))$.

    Let us define an equivalence relation $\equiv$ over words of
    $\Sigma^*$ as follows: two words $v_1, v_2$ are equivalent if they are
    equal when normalizing them with the rules $u_i^{\omega} u_i^{\omega} \to
    u_i^{\omega}$ for all $1 \leq i \leq p$. That is, we disregard
    repetitions of the factors $u_i^{\omega}$ in the words.
    We lift the equivalence relation $\equiv$ to $k$-tuples of
    words by pointwise application.

    Remark that if $(v_1, \dots, v_k) \equiv (w_1, \dots, w_k)$ then
    $\pi(\mu(v_1), \dots, \mu(v_k)) = \pi(\mu(w_1), \dots, \mu(w_k))$ because
    $\mu(u_i^\omega) = \mu(u_i)^\omega$ is an idempotent element of the monoid
    $M$. In particular, $f(w)$ can be computed as the sum over equivalence
    classes for $\equiv$, of the value of $\pi$ on one representative,
    which belongs to $\Nat$.

    Therefore, it suffices to prove that the number of partitions of $w$ in a
    single equivalence class for $\equiv$ is a polynomial $P(X_1, \dots, X_p)$
    with \kl{positive coefficients} for its \kl{maximal monomials}.

    Notice that to produce all elements in a given equivalence class
    means adding the factors $u_i^\omega$ where $1 \leq i \leq p$
    back to the normalized version
    of the equivalence class. For all elements in an equivalence class,
    one has to add the same amount of $u_i^\omega$ for $1 \leq i \leq p$,
    and therefore the number of possible choices
    is either constant, or 
    is a product of binomials of the form $\binom{X - l}{s}$
    which has the desired shape.
\end{proof}


\begin{lemma}
    \label{n-rat-correct:lem}
    Let $P \in \Rel[X_1, \dots, X_p]$ be \kl{represented}
    by a \kl{$\Nat$-rational series}. Then,
    $P \in \CorrectPoly$.
\end{lemma}
\begin{proof}
    Let $f$ be the \kl{commutative}
    \kl{$\Nat$-rational series}
    with domain $\Sigma \defined \set{a_1, \dots, a_p}$
    that \kl{represents} $P$. Because $f$ has \kl{polynomial growth},
    it is in fact a \kl{$\Nat$-polyregular function}
    (\cref{polynomial-rational-polyreg:fact}).
    Using \cref{n-poly-combinatorics:lem},
    there exists a number $\omega \in \Nat$
    and polynomial $Q$ with \kl{positive coefficients} for its
    \kl{maximal monomials} such that
    for all $X_1, \dots, X_p \geq \omega$:
    \begin{equation*}
        f\left(
            \prod_{i = 1}^p (a_i)^{\omega \times X_i}
        \right)
        = Q(X_1, \dots, X_p)
        = P(\omega X_1, \dots, \omega X_p) 
        \quad .
    \end{equation*}
    We conclude that $P(\omega X_1, \dots, \omega X_p) = Q(X_1, \dots, X_p)$
    as polynomials,
    and in particular that
    the \kl{maximal monomials} of 
    $P$ have \kl{positive coefficients}.

    Remark that for every partial valuation $\nu \colon \vec{X} \topartial \Nat$,
    the polynomial $\restr{P}{\nu}$ continues to be represented
    by a \kl{$\Nat$-polyregular function}, namely
    $f$ partially applied to a word. As a consequence,
    the \kl{maximal monomials} of
    $\restr{P}{\nu}$ also have \kl{positive coefficients}, and 
    we have proven that $P \in \CorrectPoly$.
\end{proof}



\textbf{TODO: rewrite this}
The core of the upcoming proof of \cref{lem:correct-to-n-rat} relies on the
following observation: if a polynomial $P$ is written $X^p + Q$, where all
terms of $Q$ have \kl{degree} less than $p$, then one can find some large
enough $K \in \Nat$ so that $X^p - (X - K)^p + Q$ also has a positive maximal
coefficient. It works because $X^p - (X - K)^p = K X^{p-1} + \cdots$, hence the
new \kl{maximal monomial} can be made to have arbitrarily large \kl{coefficient}
by increasing $K$.
As a consequence, for values $n \leq K$ of $X$, one can compute $\restr{P}{X =
n}$ which remains in $\CorrectPoly$, and apply an induction hypothesis.
Furthermore, for values $n > K$ of $X$, one has the guarantee that $X^p - (X -
K)^p + Q$ has positive maximal coefficients, hence can be computed by a
$\Nat$-rational series, while $(X - K)^p$ is clearly computable by a
$\Nat$-rational series, hence $(X^p - (X - K)^p + Q) + (X - K)^p$ is computable
as the sum of two $\Nat$-rational series, and we have concluded that our
original polynomial was a \kl{$\Nat$-rational polynomial}. 

When multiple indeterminate are involved, a bit of care is needed. The key
ingredient is to notice that polynomials in $\CorrectPoly$ are actually stable
under a \emph{discrete} analogue of the usual differentiation operator.
Intuitively, polynomials $P$ in $\CorrectPoly$ have \kl{positive} \kl{maximal
monomials}, and so does $\partial P$, $\partial^2 P$ etc. 

\begin{definition}
    \label{discrete-derivative:def}
    Let $\vec{X}$ be a tuple of indeterminate,
    $K \in \Nat$,
    and 
    $P \in \Rel[\vec{X}]$ be a polynomial.
    \begin{equation*}
        \Diff{K}{P} \defined 
        P(\vec{X}) - P(\vec{X} - K) \quad .
    \end{equation*}
    Where $P(\vec{X} - K)$ is the polynomial function
    obtained by pre-composing $P$ with the map 
    $\vec{X} \mapsto \seqof{X_i - K}{X_i \in \vec{X}}$.
\end{definition}


As one would expect, the discrete derivatives are linear operations on
polynomials, that commutes with the partial application operators
$\restr{\cdot}{\nu}$.

\begin{fact}
    \label{discrete-deriv-linear:fact}
    For all tuple $\vec{X}$ of indeterminate,
    for all $K \in \Nat$, for all partial function
    $\nu \colon \vec{X} \topartial \Nat$:
    \begin{enumerate}
        \item $\Diff{K}{ \cdot } \colon \Rel[\vec{X}] \to \Rel[\vec{X}]$
            is a linear operator,
        \item $\restr{\cdot}{\nu} \colon \Rel[\vec{X}] \to \Rel[\vec{X}]$
            is a linear operator,
        \item $\Diff{K}{ \cdot } \circ \restr{\cdot}{\nu}
            = \restr{\cdot}{\nu} \circ \Diff{K}{\cdot}$.
    \end{enumerate}
\end{fact}

The upcoming \cref{lem:correct-to-n-rat} is proven using an induction on the
number $d$ of indeterminate, and the degrees of the \kl{maximal monomials}. To
make the induction formal, let us define $\Monomials[\vec{X}]$ as the
(infinite) set of all possible \kl{monomials} over $\vec{X}$, ordered by
\kl{divisibility}. Remark that this set is isomorphic to $\Nat^{\vec{X}}$ with
the product ordering, which is a \kl{well-quasi-ordering}.

\AP To a polynomial $P$, we assign the set $\MaximalMonomials(P)$ of its
\kl{maximal monomials}, belonging to $\Pfin(\Monomials)$, which remains a
\kl{well-quasi-ordering} when endowed with the \intro{Hoare ordering} of
subsets, that is, $S_1 \hoareleq S_2$ whenever for all \kl{monomial} $M_1 \in
S_1$, there exists a monomial $M_2 \in S_2$, such that $M_1$ \kl{divides}
$M_2$.

Let us now prove that the \kl{discrete differentiation} operator
can be used to perform an induction.

\begin{fact}
    \label{derivation-simplifies:fact}
    For all $P \in \Rel[\vec{X}]$ that are non-constant,
    for all $K \in \Nat$,
    $\MaximalMonomials(\Diff{K}{P}) \hoarele
    \MaximalMonomials(P)$.
\end{fact}

\begin{fact}
    Let $M,T$ be two \kl{monomials}, such that
    $T$ \kl{strictly divides} $M$.
    Then,
    $T$ \kl{divides} some \kl{maximal monomial}
    of $\Diff{K}{M}$.
\end{fact}


\begin{lemma}
    \label{derivation-stabilises-correct:lem}
    Let $P \in \CorrectPoly$,
    $P_1$ be the sum of \kl{maximal monomials} of $P$,
    and $P_2 \defined P - P_1$ be the sum of
    non-maximal monomials of $P$.
    There exists a computable $K$,
    such that
    $(\Diff{K}{P_1} + P_2) \in \CorrectPoly$.
\end{lemma}

\begin{lemma}
    \label{lem:correct-to-n-rat}
    Let $P$ be a polynomial in $\CorrectPoly$.
    Then, 
    $P$ is
    \kl{represented} by a \kl{star-free $\Nat$-polyregular function}.
\end{lemma}
\begin{proof}
    We prove the result by induction on $\MaximalMonomials(P)$. 

    \textbf{Base case:} If the \kl{maximal monomial} of $P$ is a constant term,
    then because $P \in \CorrectPoly$, $P = n \in \Nat$, which is
    \kl{represented} by a \kl{star-free $\Nat$-polyregular function}.

    \textbf{Induction:} Assume that $P$ is not a constant polynomial.
    Leveraging \cref{derivation-stabilises-correct:lem}, there exists a
    computable $K \in \Nat$ such that $\Diff{K}{P} \in \CorrectPoly$. Using
    \cref{derivation-simplifies:fact} (because $P$ is non-constant), we also
    know that $\MaximalMonomials(\Diff{K}{P}) \hoarele \MaximalMonomials(P)$.
    By induction hypothesis, we conclude that $\Diff{K}{P}$ is \kl{represented}
    by a \kl{star-free $\Nat$-polyregular function} $f_1$.



    Assume that $\alpha Y^p M \in \MaximalMonomials(P)$
    for some indeterminate $Y$, $\alpha \neq 0$, and $p \geq 1$.
    Because $P \in \CorrectPoly$, we know that $\alpha > 0$.
    Using \cref{lem:delta-cool},
    we know that there exists a computable $K$ such that
    the polynomial
    $\Diff{K}{P} \defined P - \alpha (Y - K)^p M$
    satisfies that for all partial valuations $\nu \colon Y\vec{X} \topartial \Nat$
    such that $\nu(Y) > K$ or $\nu(Y)$ is undefined,
    the \kl{maximal monomials} of $\Diff{K}$ have \kl{positive coefficients}.
    In particular, $\Diff{K}{P} (Y - K)$  belongs to $\CorrectPoly$.
    Furthermore, $\MaximalMonomials(\Diff{K}{P}) = \MaximalMonomials(\Diff{K}{Y - K})
    \hoarele \MaximalMonomials(P)$.
    By induction hypothesis,
    we conclude that
    $\Diff{K}{Y - K}$ is \kl{represented}
    by a \kl{star-free $\Nat$-polyregular function} $g_1$,
    \begin{equation*}
        f_1(Y, \vec{X}) \defined
        \begin{cases}
            0 & \text{ if } Y \leq K \\
            \Diff{K} & \text{ otherwise }
        \end{cases}
        \quad .
    \end{equation*}

    Because $\alpha \geq 0$, it is an easy check
    that the following function is also a $\Nat$-rational series
    \begin{equation*}
        f_2(Y, \vec{X}) \defined
        \begin{cases}
            0 & \text{ if } Y \leq K \\
            \alpha(Y - K)^pM & \text{ otherwise }
        \end{cases}
        \quad .
    \end{equation*}

    Because $P \in \CorrectPoly$, for every $n \leq K$, $\restr{P}{Y = n} \in
    \CorrectPoly$ (\cref{inductive-correct-poly:remark}).
    Furthermore,
    $\MaximalMonomials(\restr{P}{Y = n})
    \hoarele \MaximalMonomials(P)$. Hence, by induction hypothesis,
    the following function is \kl{represented} by a
    \kl{star-free $\Nat$-rational series}:
    \begin{equation*}
        f_3(Y, \vec{X}) \defined
        \begin{cases}
            P(Y, \vec{X}) & \text{ if } Y \leq K \\
            0 & \text{ otherwise }
        \end{cases}
        \quad .
    \end{equation*}
    We conclude by remarking that 
    $P = f_1 + f_2 + f_3$.
\end{proof}

We are now ready to state the corrected and generalised version of
\cref{karh:thm}.

\begin{theorem}
    \label{corrected-version:thm}
    Let $P \in \Rel[\vec{X}]$ be a polynomial.
    The following are equivalent:
    \begin{enumerate}
        \item \label{corrected-1:item} $P \in \CorrectPoly$,
        \item \label{corrected-2:item} $P$ is \kl{represented} by a \kl{$\Nat$-rational series},
        \item \label{corrected-3:item} $P$ is \kl{represented} by a \kl{$\Nat$-polyregular function},
        \item \label{corrected-4:item} $P$ is \kl{represented} by a \kl{star-free $\Nat$-polyregular function}.
    \end{enumerate}
\end{theorem}
\begin{proof}
    The implications 
    \cref{corrected-4:item} $\implies$
    \cref{corrected-3:item} $\implies$
    \cref{corrected-2:item} are obvious.
    \cref{lem:correct-to-n-rat} proves
    \cref{corrected-1:item} $\implies$ \cref{corrected-4:item},
    while \cref{n-rat-correct:lem}
    proves 
    \cref{corrected-2:item} $\implies$ \cref{corrected-1:item}.
\end{proof}


\begin{lemma}
    \label{lem:correct-covered-2}
    $\CorrectPoly[X,Y] = \CoveredPoly[X,Y]$.
\end{lemma}
\begin{proof}
    It is clear that $\CorrectPoly[X,Y] \subseteq \CoveredPoly[X,Y]$,
    by considering the empty valuation $\nu \colon \set{X,Y} \topartial \Nat$.
    For the converse inclusion, let us consider $P(X,Y)$
    that is \kl{non-negative}, such that the \kl{maximal monomials}
    have \kl{positive coefficients}.
   

    If we fix none of the variables, then the \kl{maximal monomials}
    have \kl{positive coefficients} by assumption. If we fix one of the
    variables, we can assume without loss of generality that we 
    fix $X = k$ for some $k \in \Nat$.
    Then $P(k,Y)$ is a \kl{non-negative} \emph{univariate} polynomial, 
    and therefore must have a positive leading coefficient
    (which is the unique \kl{maximal monomial} in this case)
    or be constant equal to 0. In both cases, the \kl{maximal monomials}
    have \kl{positive coefficients}.
    The same reasoning applies \emph{a fortiori} in the case where
    we fix the two indeterminate, leading to a constant polynomial.
\end{proof}

\section{Effective procedures}
\label{sec:deciding}

The goal of this section is to go beyond polynomials and characterize all
$\Rel$-polyregular functions that are $\Nat$-polyregular, under the assumption
that they are \kl{commutative}.

\begin{theorem}
    \label{decidable-n-poly:thm}
    Given a \kl{commutative}
    \kl{$\Rel$-polyregular function} $f \colon \Sigma^* \to \Rel$,
    one can decide if $f$ can be computed by a \kl{$\Nat$-polyregular function},
    and effectively compute a representation of $f$.
\end{theorem}

Before proving \cref{decidable-n-poly:thm}, let us first examine the
effectiveness of \cref{corrected-version:thm}, namely, provide an algorithm to
decide whether a polynomial $P$ belongs to $\CorrectPoly$. The idea will be to
compute a bound to values taken by the valuations $\nu$ appearing in the
definition of $\CorrectPoly$. As a \emph{mise en jambes}, let us consider
separately the case of one indeterminate.

\begin{lemma}
    \label{decide-correct-univariate:lemma}
    Let $P \in \Rel[X]$, there exists a computable $N \in \Nat$,
    such that the following are equivalent:
    \begin{enumerate}
        \item \label{decide-correct-univariate-1:item}
            $P \in \CorrectPoly$,
        \item \label{decide-correct-univariate-2:item}
            The \kl{maximal monomial}
            of $P$ has a \kl{positive coefficient},
            and $P(n) \in \Nat$
            for all $0 \leq n \leq N_0$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    Let us first remark that the implication 
    \cref{decide-correct-univariate-1:item}
    $\implies$ \cref{decide-correct-univariate-2:item} is trivial for every
    $N \in \Nat$.
    For the converse implication,
    let $P \in \Rel[X]$.
    If $P$ is a constant polynomial, then $P \in \CorrectPoly$
    if and only if $P(0) \in \Nat$, and $N \defined 0$
    suffices.
    Otherwise, $P$ is non-constant, and let $n \geq 1$ be the \kl{degree} of $P$.
    Let $P_1$ and $\alpha > 0$ be such that
    $P \defined P_1 + \alpha X^n$. 
    To prove that $P \in \CorrectPoly$, it suffices to show that
    $P(k) \in \Nat$ for all $k \in \Nat$.
    Let us define $\beta$ as the
    maximal absolute value of coefficients appearing in $P_1$, which is
    assumed to be non-zero,
    and $N_0 \defined \beta + 1 \geq 2$.
    Remark that for $X \geq N_0$,
    \begin{align*}
        P(X) &\geq X^n - \beta \sum_{i = 0}^{n-1} X^i \\
             &= X^n - \beta \frac{X^n - 1}{X - 1} \\
             &= \frac{X^{n+1} - X^n - \beta X^n + \beta}{X - 1} \\
             &= \frac{X^n(X - (\beta + 1)) + \beta}{X - 1} \\
             &\geq 0
    \end{align*}
    This proves that $P(k) \in \Nat$ for all $k \geq N_0$,
    and because $P$ satisfies \cref{decide-correct-univariate-2:item},
    $P(k) \in \Nat$ for all $1 \leq k \leq N_0$. We have proven 
    that $P \in \CorrectPoly$.
\end{proof}

In the case of multiple indeterminate, we leverage
\cref{lem:delta-cool} to perform an induction on the degree
of the polynomials and the number of variables of the polynomial.

\begin{lemma}
    \label{decide-correct-poly:lem}
    One can decide if a polynomial belongs to $\CorrectPoly$.
\end{lemma}
\begin{proof}
    We prove the result by induction on the number of indeterminate.

    \textbf{Base Case:} If $P$ has zero indeterminate, i.e., is a constant
    function, then to decide whether $P \in \CorrectPoly$ it suffices to check
    that $P(0) \in \Nat$.

    \textbf{Induction:} Let $P \in \Rel[Y, \vec{X}]$, we start by checking
    whether \kl{maximal monomials} of $P$ have \kl{positive coefficients}.
    Without loss of generality, assume that $Y$ divides some \kl{maximal
    monomial} $\alpha Y^p M$ with $p \geq 1$. By applying
    \cref{lem:delta-cool}, we can compute a bound $K \in \Nat$ such that
    $\Diff{K} \defined P - \alpha (Y - K)^p M$ has \kl{positive coefficients}
    for its \kl{maximal monomials} for all partial valuations $\nu \colon
    Y\vec{X} \topartial \Nat$ such that $Y > K$ (if $Y$ is assigned a value). In
    particular, we conclude that, for all $\restr{P}{Y = n}$ belongs to
    $\CorrectPoly$ for all $n > K$. By induction hypothesis, one can
    decide whether $\restr{P}{X = n}$ belongs to $\CorrectPoly$
    for all $0 \leq n \leq K$, which is equivalent 
    to deciding whether
    $P \in \CorrectPoly$ thanks to \cref{inductive-correct-poly:remark}.
\end{proof}

To prove the theorem, let us first provide a nice characterization of
\kl{commutative} \kl{$\Rel$-polyregular functions} in terms of polynomials.
This is actually a refinement of \cref{n-poly-combinatorics:lem} in the
commutative case.

\begin{lemma}
    \label{decompose-polynomial:lem}
    Let $f \colon \Sigma^* \to \Rel$ be a \kl{commutative}
    \kl{$\Rel$-polyregular function}. There exists $\omega \in \Nat$,
    and polynomials $\seqof{P_{\seqof{n_a}{a \in \Sigma}}}{ 0 \leq n_a < \omega}$,
    such that for all $w \in \Sigma^*$,
    \begin{equation*}
        f(w) = P_{\seqof{\card[a]{w} [\omega]}{a \in \Sigma}}
        (\seqof{\card[a]{w} / \omega}{a \in \Sigma}) \quad .
    \end{equation*}
    Which informally means that for every choice of rest modulo $\omega$
    for every variable, there exists a polynomial describing the
    behavior of $f$ when adding multiples of $\omega$ letters at a time.

    Furthermore, the polynomials are computable from $f$.
\end{lemma}
\begin{proof}
    equivalent partitions of the word, but commutativity?.q
    Lemma 5.37 phd gaëtan.
\end{proof}

As a consequence, we conclude 
\begin{proof}[Proof of \cref{decidable-n-poly:thm}]
    We use \cref{decompose-polynomial:lem}
    to effectively compute
    a polynomial representation of $f$. Remark that
    $f$ is a \kl{$\Nat$-polyregular function} if and only if
    all these polynomials are \kl{$\Nat$-rational polynomials},
    which is decidable thanks to
    \cref{decide-correct-poly:lem,corrected-version:thm}.
\end{proof}

\subsection{Star-free $\Nat$-polyregular functions}


Let us now prove that the above characterizations of
commutative
$\Nat$-polyregular functions can be combined with the recent
advances in the study of $\Rel$-polyregular functions 
\cite{LOPEZ23b}
to prove the following theorem.

\begin{theorem}
    \label{zsf-npoly-nsf:thm}
    Let $\Sigma$ be a finite alphabet, and $f \colon \Sigma^* \to \Nat$
    be both a \kl{star-free $\Rel$-polyregular function}
    and a \kl{commutative} \kl{$\Nat$-polyregular function}.
    Then, $f$ is a \kl{commutative} \kl{star-free $\Nat$-polyregular function}.
    That is, the following equality holds:
    \begin{equation*}
        \ZCommut \cap \ZSF \cap \NPoly
        = \ZCommut \cap \NSF
        \quad .
    \end{equation*}
\end{theorem}

Note that this proves in the commutative case a conjecture that was 
formulated by Thesis Gaetan, and that is non trivial, because 

\begin{conjecture}
    \label{nsf-zsf:conj}
    In the general case, the following equation holds:
    \begin{equation*}
        \ZSF \cap \NPoly
        = 
        \NSF
        \quad .
    \end{equation*}
\end{conjecture}

As a corollary of \cref{zsf-npoly-nsf:thm} and the effective decision
procedures of $\ZSF$ obtained in \cite{LOPEZ23b}, we conclude that $\NSF$ is
decidable inside $\NPoly$ under the assumption of commutativity.

\begin{corollary}
    One can decide if a \kl{commutative} \kl{ $\Rel$-polyregular function}
    can be realized by a \kl{star-free $\Nat$-polyregular function},
    in which case the conversion is effective.
\end{corollary}

The key ingredient of this section is the use of a semantic characterization of
\kl{star-free $\Rel$-polyregular functions} among \kl{$\Rel$-rational series}
that generalizes the aperiodicity of languages to functions by the means of
polynomial behaviors.

\begin{definition}[Ultimately polynomial]
    \label{ultimately-polynomial:def}
    Let $\Sigma$ be a finite alphabet. 
    A function $f \colon \Sigma^* \to \Rel$
    is \intro{ultimately polynomial}
    whenever there exists $N_0 \in \Nat$ such that
    for all $n \in \Nat$
    and for all words $\alpha_0, w_1, \alpha_1, \cdots, \alpha_{n-1}, w_n, \alpha_n
    \in \Sigma^*$, there exists a polynomial $P \in \Rel[X_1, \dots, X_n]$
    such that
    \begin{equation*}
        f\left(
            \alpha_0 \prod_{i = 1}^{n} w_i^{X_i} \alpha_i
        \right)
        = 
        P(X_1, \dots, X_n)
        \quad 
        \forall X_1, \dots, X_n \geq N_0
        \quad .
    \end{equation*}
\end{definition}


Let us recall from \cite{LOPEZ23b} that this definition correctly
generalizes the indicator functions of regular languages.

\begin{example}
    A language $L$ is aperiodic if and only if 
    the indicator function is ultimately polynomial.
\end{example}
\begin{proof}
    TODO.
\end{proof}

\begin{proof}[Proof of \cref{zsf-npoly-nsf:thm}]
    We proceed by induction on the size of the alphabet $\card{\Sigma}$.

    \textbf{Base Case.} When $\Sigma$ is empty, $\Sigma^*$ contains
    only the empty word $\varepsilon$, and because $f$ is a
    \kl{$\Nat$-polyregular function}, $f(\varepsilon) \in \Nat$.
    Note that $f$ is therefore a constant function, equal to a natural
    number, hence belongs to $\NSF$.

    
    \textbf{Induction.}
    Because $f$ is \kl{ultimately polynomial},
    there exists $N_0 \in \Nat$, 
    and $P \in \Rel[\seqof{X_a}{a \in \Sigma}]$ 
    such that
    \begin{equation*}
        f\left( \prod_{a \in \Sigma} a^{X_a} \right)
        = 
        P(\seqof{X_a}{a \in \Sigma})
        \quad
        \text{ when }
        \forall a \in \Sigma, X_a \geq N_0
        \quad .
    \end{equation*}
    Furthermore, leveraging \cref{decompose-polynomial:lem},
    we obtain $\omega \in \Nat$
    and a family of polynomials 
    $\seqof{P_{\seqof{n_a}{a \in \Sigma}}}{0 \leq n_a < \omega}$
    such that.
    Because each of those polynomials coincide with $P$ over an infinite
    subgrid of $\Nat$,
    we conclude that all polynomials are in fact equal to a single one.
    we conclude that the polynomials 
    $P_{\seqof{n_a}{a \in \Sigma}}$ are all equal.

    Now, we conclude in particular that the function 
    computing $P$ is \kl{$\Nat$-polyregular}, because $f$ is,
    hence is computable by a \kl{star-free $\Nat$-polyregular function},
    because of \cref{nsf-polynomials:thm}.
    When fixing values of some indeterminate below $N_0$,
    we obtain a new function $g$, that remains commutative,
    remains ultimately polynomial, and remains \kl{$\Nat$-polyregular}.
    By induction hypothesis, this function $g$ is also 
    \kl{star-free $\Nat$-polyregular}, and we conclude
    that 
    $f = P + \sum g$ which remains star free.
\end{proof}


\section{Conclusion}
\label{sec:ccl}

\begin{itemize}
    \item Actually, we have an algorithm that allows
        us to \emph{decide} if a polynomial is $\Nat$-rational.
    \item Actually, we obtain a characterisation of
        commutative 
        $\Nat$-rational series of polynomial growth
        among $\Rel$-rational series.
    \item The question of $\Nat$-polyregular functions
        among $\Rel$-polyregular functions remains open
        because of the non-commutativity of the input.
    \item The question of $\Nat$-rational series (commutative)
        among $\Rel$-rational series remains open.
\end{itemize}


\begin{corollary}
    The following problem is decidable: given $P \in \Rel[\vec{X}]$,
    decide whether $P$ is a \kl{$\Nat$-rational polynomial}.
\end{corollary}
\begin{proof}
    Thanks to \cref{karh:thm}, one only has to decide whether
    $P \in \CoveredPoly$. The procedure is as follows.
    \begin{enumerate}
        \item Check if all \kl{maximal monomials} have
            \kl{positive coefficients} in $P$, if not, answer \texttt{false}.
        \item Consider $N \in \Nat$ large enough so that
              $P \geq 0$ when all indeterminate are chosen greater
              than $N$. This is possible because all \kl{maximal
              monomials} have \kl{positive coefficients}, and such an $N$
              is computable.
        \item Compute $P$
    \end{enumerate}

    Now, if all \kl{maximal monomials}
    have \kl{positive coefficients}, then there exists a computable
    $N \in \Nat$ such that 
    In particular, 


\end{proof}


\begin{conjecture}
    $\CorrectPoly = \setof{P}{ P \geq 0 \wedge \exists K \in \Nat, P \circ (+K) \in \Nat[\vec{X}]}$.
\end{conjecture}
\begin{proof}[Proof Sketch]
    If $S \defined P \circ (+K) \in \Nat[\vec{X}]$, then for every partial application,
    maximal coefficients of $S$ are positive. As maximal coefficients of 
    (partial applications of) $S$ are the same as the ones of $P$
    \emph{except for the constant terms} (full application),
    where $P$ is already guaranteed to be non-negative, we conclude
    that $P \in \CorrectPoly$.

    Conversely, we prove by induction on the degree of $P \in \CorrectPoly$,
    that there exists some $K$ such that $P \circ (+K) \in \Nat[\vec{X}]$.
    First, notice that $\CorrectPoly$ is closed under pre-composition with
    $(+K)$. Then, remark that $P(X - K)$ has the same maximal coefficients as
    $P$ and new maximal coefficients that are multiples of $K$. Hence, for a
    large enough $K$, we conclude that $P(X - K)$ is the sum of its maximal
    coefficients, plus a polynomial that lies in $\CorrectPoly$. We conclude by
    induction hypothesis. 
\end{proof}

\begin{conjecture}
    $\CorrectPoly$ is precisely composed of polynomials that
    have non-negative coefficients in a \emph{binomial basis},
    i.e., where polynomials are obtained
    as sums and products of $\binom{X_i}{p_i}$.
\end{conjecture}

\begin{conjecture}
    star-free $\Nat$-rational is star-free and $\Nat$-rational?
\end{conjecture}


\begin{center}
    \begin{tabular}{c|cc}
        \toprule
        & \textbf{Commutative} & \textbf{General} \\
        \midrule
        \textbf{Commutative}
        and \textbf{Invertible} & commutative $\ZPoly$ & $\ZPoly$ \\
        \textbf{Commutative} & commutative $\NPoly$ & $\NPoly$ \\
        \textbf{General} & ? & polyregular 
    \end{tabular}
\end{center}


% BACKMATTER
\printbibliography

\appendix

\end{document}
