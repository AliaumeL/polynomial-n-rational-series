% Upgreek letters
\makeatletter
\newcommand\mathgr[1]{\tokcycle
  {\addcytoks{##1}}
  {\processtoks{##1}}
  {\ifcsname up\expandafter\@gobble\string##1\endcsname
   \addcytoks[1]{\csname up\expandafter\@gobble\string##1\endcsname}%
    \else\addcytoks{##1}\fi}
  {\addcytoks{##1}}{#1}%
  \expandafter\mathrm\expandafter{\the\cytoks}%
}
\makeatother

\NewDocumentCommand{\rightmarginnote}{m}{%
    \checkoddpage%
    \ifoddpage%
        \marginpar{#1}%
    \else%
        \reversemarginpar%
        \marginpar{#1}%
    \fi
}

% Create a proof environment for results in appendix,
% that take a label of a theorem in the main text, and
% produce a proof
% \begin{proof}[Proof of \cref{the-label}]
% \phantomsection\label{the-label:proof}
% content
% \end{proof}
\NewDocumentEnvironment{proofof}{o}{%
    \IfValueTF{#1}{%
        % checks if \#1 is a defined command in which case
        % we call it
        \def\insideRestate{1}
        \ifcsname #1\endcsname
            \csname #1\endcsname*
        \fi
        \begin{proof}[Proof of \cref{#1} on page \pageref{#1}]
        \phantomsection\label{#1:proof}
    }{%
        \begin{proof}
    }
    \let\oldqedsymbol\qedsymbol
    \renewcommand\qedsymbol{\hyperref[#1]{\oldqedsymbol}}
}{%
    \end{proof}
    \renewcommand\qedsymbol{\oldqedsymbol}
}

% Refers to the proof of a result
\NewDocumentCommand{\proofref}{m}{%
    \ifdefined\insideRestate%
        \rightmarginnote{\vspace{0.6em}\ttfamily\small\hyperref[#1]{Go to \cref{#1} p.\pageref{#1:proof}}}%
    \else%
    % if appendices are present, then refer to the appendix
    % otherwise do nothing.
    % \hyperref[#1:proof]{Proof of \cref{#1}}
    \IfRefUndefinedExpandable{#1:proof}{}{%
        %\hfill\hyperref[#1:proof]{(Proof p.\pageref{#1:proof})}
        \rightmarginnote{\vspace{0.6em}\ttfamily\small\hyperref[#1:proof]{Go to proof of \cref{#1} p.\pageref{#1:proof}}}%
    }%
    \fi%
}

% new theorem 
\newtheorem{faketheorem}[theorem]{Flawed Theorem}
\newtheorem{problem}[theorem]{Problem}
\newtheorem{fact}[theorem]{Fact}

\usepackage{lowco2}
