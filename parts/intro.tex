%! TeX program = xelatex
%! lang = en-US
% MAIN MATTER
\section{Introduction}
\label{introduction:sec}

\AP Traditional results from automata theory state the equivalence of languages
defined in terms of deterministic finite automata and regular expressions
\cite{KLEE56}, Monadic Second Order Logic ($\intro*\MSO$)
\cite{BUCH60,ELGO61,TRAK66}, or finite monoids \cite{RABI59,SCHU61}. Among regular
languages, there exists a robust subclass sharing similar characterizations,
namely the \emph{star-free} regular languages. These are obtained via
counter-free (minimal) automata \cite{MNPA71}, represented by star-free regular
expressions \cite{SCHU65}, definable in First Order Logic ($\intro*\FO$)
\cite{MNPA71}, and recognized by aperiodic monoids \cite{SCHU65}. It is
decidable whether a regular language is aperiodic, thanks to the
characterizations in terms of minimal automaton and/or syntactic monoid.

\AP There have been recurrent attempts to generalize the notions of regularity
and aperiodicity from languages to functions, leading to classes of various
expressiveness, such as\footnote{This list is far from exhaustive.} Mealy
Machines ($\intro*\Mealy$) \cite{MEAL55}, sequential functions
($\intro*\Sequential$) \cite{SCHU77}, rational functions ($\intro*\Rational$)
\cite{EILE74}, \intro{regular functions} ($\intro*\Regular$) \cite{ENHO01}, and
\intro{polyregular functions} ($\intro*\Poly$) \cite{ENMA02,BOJA18,BOKL19}. For
all of these models, an \emph{aperiodic} counterpart can be defined
(respectively, $\intro*\AMealy$, $\intro*\ASequential$, $\intro*\ARational$,
$\intro*\ARegular$, $\intro*\SF$), lifting the correspondence between
counter-free automata, star-free regular languages and aperiodic monoids to the
functional setting: for Mealy Machines \cite{SCHU65,MNPA71}, for sequential
functions \cite{CHOF03}, for rational functions \cite{FGL16,FGLM18}, for
regular functions \cite{BOJA14,CADA15,DJR16,DGK21}, and for polyregular
functions \cite{BDK18,BOKL19}. The inclusions between these classes of
functions are all known to be strict, and we depicted in
\cref{computational-models:fig} the status of the \emph{membership problem}
associated to these strict inclusions (that is, given a function $f$, decide if
$f$ can be computed by a function of a proper subclass). We also redirect the
reader to the survey of Muscholl and Puppis for a more comprehensive
introduction to the status of various membership problems between classes of
string-to-string functions \cite{MUSC19}.


%Note that in
%\cref{computational-models:fig}, if $\mathsf{B}$ is a proper subclass of
%$\mathsf{C}$, then the \emph{aperiodic} variant of $\mathsf{B}$ is precisely
%the intersection of $\mathsf{B}$ with the \emph{aperiodic} variant of the
%larger class $\mathsf{C}$. Because such a (strong) statement does not
%explicitly appear in the literature, a standalone proof will be given in
%\cref{orthogonal-aperiodic-power:thm}. As an example, to conclude that a
%function can be computed by an \emph{aperiodic sequential function}
%($\ASequential$) it is enough to prove that it is sequential ($\Sequential$),
%and computed by an \intro{aperiodic polyregular function} ($\SF$). 


\AP To approach the \emph{aperiodicity} membership problems the traditional
approach has been to develop so-called canonical objects, akin to the minimal
automaton or the syntactic monoid of regular languages, over which aperiodicity
is equivalent to a simple syntactic criterion, e.g. having no counters
\cite{MNPA71}. This is the proof scheme that has been implemented for
sequential functions \cite{CHOF03}, and more recently for rational functions
\cite{FGL16,FGLM18}. Unfortunately, such a canonical object remains to be
defined for regular and polyregular functions.

\begin{figure}
    \centering
    \begin{tikzpicture}[
        xscale=1.2,
        decidable/.style={
            ->, thick, color=black
        },
        unknown/.style={
            ->, dashed, color=gray
        }
        ]
        % Create nodes for the classes and their aperiodic variants
        % Mealy / sequential / rational / regular / polyregular
        \node (mealy)  at (0, 2) {$\Mealy$};
        \node (seq)    at (2, 2) {$\Sequential$};
        \node (rat)    at (4, 2) {$\Rational$};
        \node (reg)    at (6, 2) {$\Regular$};
        \node (poly)   at (8, 2) {$\Poly$};
        % Aperiodic variants
        \node (amealy) at (0,0) {$\AMealy$};
        \node (aseq)   at (2,0) {$\ASequential$};
        \node (arat)   at (4,0) {$\ARational$};
        \node (areg)   at (6,0) {$\ARegular$};
        \node (apoly)  at (8,0) {$\SF$};
        % Arrows
        % The decidability is known for inclusions
        % mealy -> sequential -> rational -> regular -> polyregular
        % similarly for the aperiodic variants
        \draw[decidable] (mealy) --
            node[midway, above] {folklore}
            (seq);
        \draw[decidable] (seq)   -- 
            node[midway, above] {\cite{CHOF03}}
            (rat);
        \draw[decidable] (rat)   -- 
            node[midway, above] {\cite{FGRS13,BGMP15}}
            (reg);
        \draw[decidable] (reg)   -- 
            node[midway, above] {\cite{BOKL19}}
            (poly);
        \draw[decidable] (amealy) --
            (aseq);
        \draw[decidable] (aseq) --
            (arat);
        \draw[decidable] (arat) --
            (areg);
        \draw[decidable] (areg) --
            (apoly);
        % Decidability of the aperidoic variants are known
        % for mealy, sequential, rational but not for regular nor polyregular.
        % we draw the arrows
        \draw[decidable] (amealy) --
            node[midway, left] {\cite{SCHU65,MNPA71}}
            (mealy);
        \draw[decidable] (aseq) -- 
            node[midway, left] {\cite{CHOF03}}
            (seq);
        \draw[decidable] (arat) -- 
            node[midway, left] {\cite{FGL16,FGLM18}}
            (rat);
        \draw[unknown] (areg) --
            node[midway, left] {$\simeq$\cite{BOJA14}}
            (reg);
        \draw[unknown] (apoly) --
            node[midway, left] {?}
            (poly);
    \end{tikzpicture}
    \caption{
        In this picture, arrows denote strict inclusions. Plain
        arrows signify that the corresponding membership problem is decidable,
        while dashed arrows signify that the corresponding membership problem
        is conjectured to be decidable. In the case of \kl{regular functions}
        ($\Regular$),
        the decidability has only been obtained under a different notion
        of equivalence of functions \cite{BOJA14}.
    }
    \label{computational-models:fig}
\end{figure}


\AP In order to approach the decision problems on \kl{polyregular functions},
restricting the output alphabet to a single letter has proven to be a fruitful
approach \cite{DOUE21,DOUE22}. The key advantage of single-letter output
alphabets is that the particular order in which letters are produced by the
machine is irrelevant. This restriction greatly simplifies the definition of
\kl{polyregular functions}, and opens the door to results that would otherwise
fail because of this ordering, such as the so-called \emph{pebble minimization
theorem} of \cite{DOUE21}, which fails in the general case
\cite{BOJA22,KLEP23}. Let us remark that the restriction to \emph{unary output}
in the case of \kl{polyregular functions} can often be lifted to outputs in the
free commutative semigroup generated by a finite alphabet $\Gamma$. In this
sense, the shift to \emph{single letter output alphabet} is really about
enforcing commutativity on the output. However, even with the restriction to
single letter output alphabets, the decidability of \kl{star-free polyregular
functions} among \kl{polyregular functions} remains an open problem
\cite[Conjecture 7.61]{DOUE23}.

\AP \kl{Polyregular functions} with a single letter output alphabet can be seen
as having outputs in $\Nat$, and this is why they were introduced respectively
as \kl{$\Nat$-polyregular functions} ($\NPoly$, for \kl{polyregular functions}
with unary output) and \kl{star-free $\Nat$-polyregular functions} ($\NSF$ for
\kl{star-free polyregular functions} with unary output) \cite{DOUE21,DOUE22}.
From this point of view, $\NPoly$ is a subclass of a larger and well-studied
class of functions called (non-commutative) \kl{rational series}
\cite{REUT80,BERE88,BERE10}. It has been noticed in \cite{CDTL23} that
\kl{$\Nat$-polyregular functions} correspond to a natural (strict) subclass of
\kl{$\Nat$-rational series} ($\NRat$), another model of computation that aims
at generalizing the notion of regular language to functions with outputs in a
\emph{commutative} semiring \cite{BERE88,BERE10}.\footnote{In particular, the
    notion of \kl{rational series} with output in $\Gamma^*$ is not well-defined.} It was frequently rediscovered in the literature that
\kl{$\Nat$-polyregular functions} (although not often called this way) are a
subclass of \kl{rational series} \cite{SCHU62,KRRC13,CDTL23}. 

In \cite{CDTL23}, the authors introduced the class of \kl{$\Rel$-polyregular
functions} ($\ZPoly$) that generalize \kl{$\Nat$-polyregular functions} by
allowing negative outputs. This remains a subclass of \kl{rational series},
more precisely, of the class of \intro{$\Rel$-rational series}
($\intro*\ZRat$). For this class of functions the aperiodic variant $\ZSF$ has
been shown to be decidable \cite{CDTL23}. Let us underline that several
non-equivalent notions of aperiodicity coexist for rational series
\cite{REUT80,DRGA19,CDTL23}, and that we only refer to the one applying to
\kl{rational series} that are actually in $\ZPoly$ \cite{CDTL23}.

\AP This approach through rational series has several limitations. First,
$\ZPoly$ does not correspond to a restriction of \kl{polyregular functions},
because of the extra expressive power introduced by the negative outputs
\cite{CDTL23}. Furthermore, deciding the membership of $\NRat$ inside $\ZRat$
is an open problem (see e.g. \cite{KARH77}), that remains open even in the
restricted case of $\NPoly$ and $\ZPoly$ \cite[Open question 5.55]{DOUE23}. It
was conjectured that, being ``computable using coefficients in $\Nat$'' and being
``star-free'' were two orthogonal properties, and therefore that the following
equation would hold: $\NSF = \NPoly \cap \ZSF$ \cite[Conjecture 7.61]{DOUE23}.
This would imply the decidability of aperiodicity for single letter output
polyregular functions since aperiodicity is decidable for $\ZSF$. We refer the
reader to \cref{previously-known-inclusions:fig} to get an overview of the
different classes of functions appearing in the paper. 

\begin{figure}
    \centering
    \includestandalone[width=7cm]{tikz/class-inclusions}
    \caption{
        Decidability and inclusions of classes of functions,
        arranged along two axes. The first one is the complexity
        of the output alphabet ($\Rel$, $\Nat$, $\Sigma$). The second
        one is the allowed computational power
        (\kl{star-free polyregular functions}, \kl{polyregular functions}, 
        \kl{rational series}).
        Arrows denote strict inclusions,
        and effectiveness (both in terms of decidability and of effective
        representation) is represented by thick double arrows. Inclusions that are
        suspected to be effective are represented using a dashed arrow together with a
        question mark.
    }
    \label{previously-known-inclusions:fig}
\end{figure}


\subparagraph*{Contributions.} This paper focuses on \kl{$\Nat$-polyregular
functions} that are furthermore \kl{commutative}, that is where the output of
the functions remains unchanged when the letters of the input word are
permuted. In this restricted setting, we answer positively to \cite[Conjecture
7.61]{DOUE23} (stating that $\NSF = \NPoly \cap \ZSF$), and prove that the
membership problems between $\NSF$, $\ZSF$, $\NPoly$, and $\ZPoly$ are all
decidable, with effective conversion algorithms. This effectively shows that
all arrows in the upper left square of \cref{previously-known-inclusions:fig}
are decidable in the \kl{commutative} setting. Furthermore, we characterize
\kl{commutative} \kl{$\Nat$-polyregular functions} as the class of
\kl{$\Rel$-polyregular functions} that are \kl{combinatorial} (defined page
\kpageref{combinatorial}), which is a semantic property akin to the notion of
\kl{ultimate polynomiality} that characterizes $\ZSF$ inside $\ZPoly$
\cite{CDTL23}. As a byproduct of our analysis, we provide a counter example to
the characterization of polynomials computed by \kl{$\Nat$-rational series}
given by \cite[Theorem 3.3, page 4; re-introduced as \cref{karh:thm}]{KARH77}.

As a byproduct of our fine-grained of (commutative) $\Nat$ and $\Rel$
polyregular functions, we fully characterize the polynomials that they can
express. Note that even \kl{$\Nat$-polyregular functions} can compute
polynomials with coefficients in $\Rat$, such as the polynomial $X(X-1)/2$ (see
\cref{q-polynomial-n-poly:ex}). However, not all polynomials $P \in
\Rat[\vec{X}]$ can be expressed using polyregular functions, and we prove that
it is the case only for those obtained as $\Nat$ (resp. $\Rel$) linear
combinations of products binomial coefficients $\binom{X_1 - p_1}{k_1} \times
\cdots \times \binom{X_n - p_n}{k_n}$.\footnote{For the reader perplexed by the
    fact that $\binom{X_n - p_n}{k_n}$ is \emph{not} a polynomial, we redirect to page 
\kpageref{binomial monomial}.}


\subparagraph*{Outline of the paper.} In \cref{preliminaries:sec}, we provide
a combinatorial definition of
\kl{$\Nat$-polyregular functions} (resp. $\Rel$-polyregular functions), show
that one can decide if a function $f \in \ZPoly$ is \kl{commutative}
(\cref{decidable-commutative-poly:lemma}), and give the basic definitions used
on multivariate polynomials. In \cref{polynomials:sec}, we focus on
\emph{polynomials}, by introducing the \cref{karh:thm} of \cite{KARH77},
providing a counter-example in \cref{thm:counter-example}, and an alternative
characterization in \cref{corrected-version:thm}. Also in
\cref{polynomials:sec}, we provide characterizations of $\Rat$-polynomials that
can be expressed respectively by \kl{$\Nat$-polyregular functions}
(\cref{decide-rat-poly-npoly:cor}) and
\kl{$\Rel$-polyregular functions} (\cref{integer-binomial-polynomials:cor}).
Finally, in \cref{beyond-polynomials:sec}, we leverage the results over
polynomials to decide $\NPoly$ inside $\ZPoly$ in the \kl{commutative} case
(\cref{decidable-n-poly:thm}), and prove that \cref{zsf-nsf:conjecture}
\cite[Conjecture 7.61]{DOUE23} holds for \kl{commutative} functions
(\cref{zsf-npoly-nsf:thm}).
