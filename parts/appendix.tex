%! TeX program = xelatex
%! lang = en-US

\section{Proofs of section \ref{polynomials:sec}}


\begin{proofof}[n-poly-n-poly:example]
    The polynomials of $\Nat[\vec{X}]$
    are obtained from basic functions (constant in $\Nat$,
    $X_i$ for some $1 \leq i \leq n$)
    by products and sums (\cref{stability-polyregular:lemma}). Because the basic functions are
    \kl{represented} by \kl{star-free $\Nat$-polyregular} functions (see
    \cref{size-of-word-nsf:ex}),
    that are closed under these operations, we conclude.
\end{proofof}

\begin{proofof}[negative-but-npoly:ex]
    The function $w \mapsto |w|$ is a \kl{$\Nat$-polyregular function}.
    Thus, 
    $P(X) \defined X$ is
    a \kl{$\Nat$-rational polynomial}. Similarly,
    $w \mapsto |w|^2 + 3$ is a \kl{$\Nat$-polyregular function},
    showing that $Q(X) \defined X^2 + 3$
    is a \kl{$\Nat$-rational polynomial}.

    Remark that $P = (X-1)^2 + 1$. Let $f  \colon \Sigma^* \to \Nat$
    that maps $aw \mapsto |w|^2$, and $\varepsilon \mapsto 0$.
    It is clear that $f \in \NPoly$, and that 
    $P$ is \kl{represented} by
    $\ind{|w| \geq 1} \times f + \ind{|w| = 0} + 1$.

    Finally, 
    $T(X) \defined - X$ cannot be 
    a \kl{$\Nat$-rational polynomial} as \kl{$\Nat$-polyregular functions}
    are non-negative.
\end{proofof}



\begin{proofof}[undecidable-non-negative:lem]
    Recall that by the undecidability of the Hilbert's Tenth Problem \cite[Problem 10 page 22]{HILB1902}, it is
    undecidable whether a given polynomial $P \in \Rel[X_1, \dots, X_k]$ has a solution in
    $\Rel^k$ \cite{MATI1970,DAVIS1973}.
    The result follows by observing that
    checking whether a polynomial $P \in \Rel[\vec{X}]$ has no solutions in $\Rel^k$ if and only 
    if $P^2 - 1$ is \kl{non-negative}. 

    Let us prove that checking whether $P \in \CoveredPoly$ is undecidable. Let
    $P \in \Rel[\vec{X}]$ be a polynomial, and let us write $P = P_+ - P_-$
    where both $P_+$ and $P_-$ belong to $\Nat[\vec{X}]$. Let $Z$ be a fresh
    indeterminate. We define $Q \defined P_+ + (Z - 1) P_-$. By construction, $Q$
    has \kl{non-negative} \kl{maximal monomials}. Furthermore, $Q$ itself is
    \kl{non-negative} if and only if $\restr{Q}{Z = 0} = P$ is \kl{non-negative},
    since for every $n > 0$, $\restr{Q}{Z = n} \in \Nat[\vec{X}]$ is
    \kl{non-negative}. We conclude that 
    $P$ is \kl{non-negative} if and only if $Q$ is \kl{non-negative},
    if and only if $Q \in \CoveredPoly$.
\end{proofof}

\begin{proofof}[n-poly-combinatorics:lem]
	Let us fix a finite monoid $M$, a morphism $\mu \colon \Sigma^* \to M$, and
	let $\omega$ be an idempotent power for the finite monoid $M$,
	i.e., a number such that for all $x \in M$,
	$(x^{\omega})^2 = x^{\omega}$.
	We will prove by induction on $k \in \Nat_{\geq 1}$
	that for all
	$\pi \colon M^k \to \Nat$,
	the lemma holds for the function
	$f = \pi^\dagger$, i.e., such that
	$f(w)$ is the sum over all factorizations of $w$
	into $k$ words $(w_1, \dots, w_k) \in \Sigma^*$
	of the value $\pi(\mu(w_1), \dots, \mu(w_k))$.
	Since every \kl{$\Nat$-polyregular function}
	is obtained via some choice of $M, \mu, \pi$ (\cref{nat-rel-poly:def})
	we derive the desired result.

	In all cases, we will use a \kl{pumping pattern} $q \colon \Nat^p \to
		\Sigma^*$ defined by $q(X_1, \dots, X_p) \defined \alpha_0 \prod_{i = 1}^p
		(u_i^{\omega \times X_i} \alpha_i)$ using some words $\alpha_i$ (for $0 \leq i
		\leq p$) and $u_i$ (for $1 \leq i \leq p)$ in $\Sigma^*$. That is, we will
	implicitly multiply all variables by $\omega$ in order to make the
	equations more readable. Note that when using an induction hypothesis, we
	will therefore have to check that the polynomial $q$ will have this
	specific form.

	\textbf{Base case: $k = 1$.}
	Let us show that $f \circ q$ is
	actually a constant (positive) function (and in particular a \kl{natural binomial function}), as for
	all $n_1, \dots, n_p \geq 1$,
	\begin{align*}
		f(q(n_1, \dots, n_p))
		 & \eqdef \pi\left(\mu(q(n_1, \dots, n_p))\right)                                      \\
		 & \eqdef \pi\left(\mu(\alpha_0 \prod_{i = 1}^p u_i^{\omega n_i} \alpha_i)\right)
		\\
		 & = \pi\left(\mu(\alpha_0) \prod_{i = 1}^p \mu(u_i)^{\omega n_i} \mu(\alpha_i)\right)
		 & \text{ morphism }
		\\
		 & = \pi\left(\mu(\alpha_0) \prod_{i = 1}^p \mu(u_i) \mu(\alpha_i)\right)
		 & \text{ idempotent and } n_i \geq 1                                                  \\
		 & = c \geq 0
	\end{align*}

	\textbf{Induction hypothesis.}
	The proof will essentially follow the same schema as the base case,
	with extra care needed to properly handle the summation of polynomials
	that arises when $k \geq 2$.

	We will use the fact that given $n_1, \dots, n_p \geq 0$,
	there exists a bijection between
	partitions of $q(\omega n_1, \dots, \omega n_p)$
	into $k+1$ words, and
	triples composed of
	a position  $1 \leq \ell \leq p$,
	a ratio     $0 \leq b \leq n_\ell$,
	a remainder $0 \leq r < \omega \times \card{u_\ell}$,
	and a partition of
	$(u_\ell^\omega)_{[-r:]} u_\ell^{\omega \times (n_\ell - b)}
		\alpha_{\ell+1} \cdots \alpha_{p-1} u_p^{n_p} \alpha_{p}$
	into $k$ words,
	where we have used the notation
	$(v)_{[-r:]}$ to denote the word obtained from $v$
	by keeping only the last $r$ letters, in a sort of Pythonic syntax.
	That is, we look at where the first ``cut" is made.

	Now, given $(\ell, b, r)$ respecting the inequalities
	mentioned above,
	one can define the \kl{pumping patterns}
	$\CutPref{\ell,r,b} \colon \Nat^{\ell - 1} \to \Sigma^*$
	and
	$\CutSuff{\ell,r} \colon \Nat^{p - \ell + 1} \to \Sigma^*$
	so that
	$q(X_1, \dots, X_p) = \CutPref{\ell,r,b}(X_1, \dots, X_{\ell-1})
		q_{\ell, r}(X_{\ell} - b, \dots, X_p)$
	under the assumption that $X_\ell \geq b$:
	\begin{align*}
        \CutPref{\ell,r,b}(X_1, \dots, X_{\ell - 1})
        &\defined
        \alpha_0 u_1^{\omega X_1} \alpha_2 \dots \alpha_{\ell - 1}
        u_\ell^{\omega b} (u_{\ell}^\omega)_{[1:r]}
        \quad .
        \\
		\CutSuff{\ell,r}(X_{1}, \dots, X_{p - \ell + 1})
        &\defined
        (u_\ell^\omega)_{[-r:]} u_\ell^{\omega X_1}
		\alpha_{\ell+1} \cdots \alpha_{p-1} u_p^{X_{p - \ell + 1}} \alpha_{p}
		\quad .
	\end{align*}
	Remark that $\CutSuff{\ell,r}$ has all of its indeterminates
	multiplied by $\omega$, so that the induction hypothesis
	can be used.

	The key remark is that $\mu(\CutPref{\ell,r,b}(X_1, \dots, X_{\ell - 1}))$ is a
	constant function from $\Nat^{\ell-1}$ to $M$, and that its value
	only depends on whether $b = 0$ or $b > 0$.
	This holds with
	the exact same proof as the base case of this induction. Let us call
	$m_{\ell,r,1}$ and $m_{\ell,r,0}$ the two elements of the monoid that are
	obtained by $\mu(\CutPref{\ell,r,b}(X_1, \dots, X_{\ell-1}))$ respectively when
	$b = 0$ and when $b > 0$. Finally, let us define $\pi_{\ell,r,0} \colon M^k
		\to \Nat$ via $\pi_{\ell,r,0}(m_2, \dots, m_{k+1}) \defined
		\pi(m_{\ell,r,0}, m_1, \dots, m_{k+1})$.

	With all of this preliminary work done, we are now ready to conclude by
	simply unrolling the definition of
	a function
	$f$ defined using a \kl{production function}
	$\pi \colon M^{k+1} \to \Nat$.
	In the following equations, we omit the precise
	range for the sum over $(\ell, r, b)$ to save space.
	\begin{align*}
		 & f(q(n_1, \dots, n_p))           \\
		 & \eqdef
		\sum_{v_1 \dots v_{k+1} = q(n_1, \dots, n_p)}
		\pi(\mu(v_1), \dots, \mu(v_{k+1})) \\
		 & = \sum_{(\ell, b, r)}
		\sum_{v_2 \dots v_{k+1} = \CutSuff{\ell,r}(n_\ell - b, \dots, n_p)}
		\pi(\mu(\CutPref{\ell,r,b}(n_1, \dots, n_{\ell-1})), \mu(v_2), \dots, \mu(v_{k+1}))
		\\
		 & =
		\sum_{(\ell, 0, r)}
		\sum_{v_2 \dots v_{k+1} = \CutSuff{\ell,b,0}(n_\ell - b, \dots, n_p)}
		\pi(m_{\ell,r,0}, \mu(v_2), \dots, \mu(v_{k+1}))
		\\
		 & +
		\sum_{(\ell, b > 0, r)}
		\sum_{v_2 \dots v_{k+1} = \CutSuff{\ell,r}(n_\ell - b, \dots, n_p)}
		\pi(m_{\ell,r,1}, \mu(v_2), \dots, \mu(v_{k+1}))
		\\
		 & =
		\sum_{(\ell, 0, r)}
		\sum_{v_2 \dots v_{k+1} = \CutSuff{\ell,b,0}(n_\ell - b, \dots, n_p)}
		\pi_{\ell,r,0}(\mu(v_2), \dots, \mu(v_{k+1}))
		\\
		 & +
		\sum_{(\ell, b > 0, r)}
		\sum_{v_2 \dots v_{k+1} = \CutSuff{\ell,r}(n_\ell-b, \dots, n_p)}
		\pi_{\ell,r,1}(\mu(v_2), \dots, \mu(v_{k+1}))
		\\
		 & =
		\sum_{1 \leq \ell \leq p}
		\sum_{0 \leq r < \omega \times \card{u_\ell}}
		(\pi_{\ell,r,0})^\dagger (\CutSuff{\ell, 0, r}(n_\ell-b, \dots, n_p))
		\\
		 & +
		\sum_{1 \leq \ell \leq p}
		\sum_{0 \leq r < \omega \times \card{u_\ell}}
		\sum_{0 < b < n_\ell}
		(\pi_{\ell,r,1})^{\dagger}(\CutSuff{\ell,r}(n_\ell - b, \dots, n_p))
	\end{align*}
	Now, using the induction hypothesis,
	we have \kl{natural binomial functions} $F_{\ell,r,0}$ and $F_{\ell,r,1}$
	satisfying
	\begin{equation*}
		(\pi_{\ell,r,1})^{\dagger}(\CutSuff{\ell,r}(n_\ell - b, \dots, n_p))
		= F_{\ell,r,1}(\omega (n_\ell - b), \dots, \omega n_p)
		\quad
		\forall n_\ell - b, \dots, n_p \geq 1
		\quad .
	\end{equation*}
	And similarly
	\begin{equation*}
		(\pi_{\ell,r,0})^{\dagger}(\CutSuff{\ell,r}(n_1, \dots, n_{\ell-1})
		= F_{\ell,r,0}(\omega n_1, \dots, \omega n_{\ell-1})
		\quad
		\forall n_1, \dots, n_{\ell - 1} \geq 1
		\quad .
	\end{equation*}

	It is a well-known equality that for all $s,n \in \Nat$,
	$\sum_{0 < i < n} \binom{s}{i} = \binom{s+1}{n}$.
	As a consequence, \kl{natural binomial functions} are
	stable under the following summation operation:
	$\Sigma_Y \colon Q(x_1,\dots,x_n,y) \mapsto \sum_{0 < b < y} Q(x_1, \dots, x_n, b)$.
	This allows us to conclude by defining:
	\begin{equation*}
		F(x_1, \dots, x_p) \defined
		\sum_{1 \leq \ell \leq p} \sum_{0 \leq r < \omega \card{u_\ell}}
		F_{l,r,0}(x_{\ell}, \dots, \omega x_p) + \Sigma_Y F_{l,r,1}(Y,
		x_{\ell+1}, \dots, x_p)
		\quad .
	\end{equation*}
	The latter being a \kl{natural binomial function} satisfying
	the desired equality.
\end{proofof}

\begin{proofof}[n-sf-combinatorics:lem]
	We redo the proof of \cref{n-poly-combinatorics:lem}, with the extra
	assumption that the monoid $M$ is \kl(monoid){aperiodic}, hence that there
	exists $s \in \Nat$ such that $x^{s+1} = x^s$ for all $x \in M$. As a
	consequence, we can define $\omega = 1$, and
	translate inputs by $s$, instead of multiplying them by $\omega$.
\end{proofof}

\begin{proofof}[derivation-translation:lem]

    We will first prove the equivalence between \cref{d-t-transl:item} and
    \cref{d-t-correct:item} without keeping track of the constant $K$, and then
    notice that this $K$ is actually computable. This will simplify the reading
    process.

    We will first prove that \cref{d-t-transl:item} $\implies$
    \cref{d-t-correct:item}, for any choice of $K \in \Nat$. Indeed, let us
    consider some partial valuation $\nu \colon \vec{X} \topartial \Nat$. By
    assumption, $\translate{K}(\restr{P}{\nu}) \in \Nat[\vec{X}]$, and in
    particular conclude that \kl{maximal monomials} of
    $\translate{K}(\restr{P}{\nu})$ are exactly the \kl{maximal monomials} of
    $\restr{P}{\nu}$, and are therefore \kl{non-negative}.

    Conversely, the implication \cref{d-t-correct:item} $\implies$
    \cref{d-t-transl:item} is proven by induction on the number of
    indeterminates of $P$. If $P$ is a constant polynomial, then $P = n$ for
    some $n \in \Nat$, and we conclude that $\translate{0}(P) \in
    \Nat[\vec{X}]$. Otherwise, $P = P_1 + P_2$ where $P_1$ is the sum of the
    \kl{maximal monomials} of $P$. Using
    \cref{derivation-stabilises-correct:lem}, there exists a computable $K \in
    \Nat$ such that $Q \defined \Diff{K}{P_1} + \translate{K}(P_2)$ belongs to
    $\Nat[\vec{X}]$. Furthermore, for all partial functions $\nu \colon \vec{X}
    \topartial \set{0, \dots, K}$ fixing at least one indeterminate of $P$, the
    induction hypothesis yields a number $L_\nu \in \Nat$ such that
    $\translate{L_\nu}(\restr{P}{\nu}) \in \Nat[\vec{X}]$. Let us define $L_m$
    to be the maximum of $L_\nu$ where $\nu$ ranges over partial
    functions described above.


    Let us prove that for all partial functions $\nu \colon \vec{X} \topartial
    \Nat$, the translation $\translate{L_m + K}(\restr{P}{\nu})$ belongs to
    $\Nat[\vec{X}]$. Without loss of generality, $\nu$ fixes only
    indeterminates that appear in $P$. If $\nu$ fixes at least one
    indeterminate $X_i$ to a value $\nu(X_i) = k \leq K$, then we can write
    $\nu = \mu [X_i = k]$, where $\mu$ does not fix the value of $X_i$. By
    construction, we know that $\translate{L_i}(\restr{\restr{P}{X_i =
    k}}{\mu})$ belongs to $\Nat[\vec{X}]$, and therefore that $\translate{K +
    L_m}(\restr{P}{\nu})$ does so too. The only case left is when all the
    variables appearing in $\nu$ are greater than $K$.
    In that case, $\nu = \translate{K}(\mu)$ for some partial 
    valuation $\mu$.
    In this case,
    $\translate{K}(\restr{P}{\translate{K}(\mu)})
    = \restr{\translate{K}(P)}{\mu}$.
    Remark that by definition,
    $\translate{K}(P) = P_1 + Q$,
    hence that
    $\translate{K + L_m}(P) = \translate{L_m}(P_1) + \translate{L_m}(Q)$
    belongs to $\Nat[\vec{X}]$.
    Finally,
    we conclude that $\restr{\translate{K+L_m}(P)}{\mu}$
    belongs to $\Nat[\vec{X}]$
    because
    the latter is closed under partial applications.


    Now, remark that in the proof, we have computed $K$ recursively from $P$,
    and only applied partial functions using values below $K$. This not only
    shows that $K$ is computable from $P$, but also that
    \cref{d-t-transl-fin:item} and \cref{d-t-transl:item} are equivalent.

    For the effective decision procedure,
    given $P \in \Rel[\vec{X}]$,
    one applies \cref{derivation-translation:lem}
    to obtain a bound $K$, and then 
    computes $\translate{K}(\restr{P}{\nu})$ for all 
    partial valuations $\nu \colon \vec{X} \topartial \set{0, \dots, K}$.
    Then $P \in \CorrectPoly$ if and only if all those polynomials
    belong to $\Nat[\vec{X}]$, which is decidable.
\end{proofof}


\begin{proofof}[integer-binomial-polynomial:lem]
	Let us first notice that $\pbinom{X}{k}$ is \kl{integer-valued}
	when $k \in \Nat$. One way to notice this is that when $X \geq 0$,
	$\pbinom{X}{k} = \binom{X}{k}$ is the number of ways to choose $k$ elements among $X$,
	which is an integer. When
	$X < 0$, then $\pbinom{X}{k} = (-1)^k \pbinom{k - X + 1}{k} = (-1)^k \binom{k - X + 1}{k}$
	is also an integer. Because \kl{integer-valued} polynomials are closed under products,
	$\Rel$-linear combination, and 
    shifting of domain by an integer,
    we conclude that all \kl{integer binomial polynomials} are
	\kl{integer-valued}.

	For the converse direction, we follow the original proof of PÃ³lya \cite{POLYA1915,CACHA1996}.
	The only difference is that we leverage differential operators on multiple indeterminates.
	To that end, let us consider the operator $\Delta_i$ that maps
	a polynomial $P$ to the polynomial $\Delta_i(P) \defined P(X_1, \dots, X_i + 1, \dots, X_k) - P$.
	That is, the discrete partial derivative with respect to the $i$-th indeterminate.
	Let us notice that $\Delta_i \pbinom{X_i}{\alpha} = \pbinom{X_i}{\alpha - 1}$ when $\alpha > 0$,
	indeed:
	\begin{align*}
		\Delta_i \pbinom{X_i}{\alpha} & = \pbinom{X_i + 1}{\alpha} - \pbinom{X_i}{\alpha}                                                         \\
		                              & = \frac{(X_i + 1) \cdots (X_i + 1 - \alpha + 1)}{\alpha!} - \frac{X_i \cdots (X_i - \alpha + 1)}{\alpha!} \\
		                              & = \frac{X_i \cdots (X_i - \alpha + 2)}{\alpha!} \alpha                                                    \\
		                              & = \pbinom{X_i}{\alpha - 1}
		\quad .
	\end{align*}
	Furthermore, when $\alpha = 0$, $\Delta_i \pbinom{X_i}{0} = 0$.

	Let us now remark that a simple expansion proves $\Delta_i \Delta_j P = \Delta_j \Delta_i P$ for all
	$1 \leq i,j \leq k$.
	This justifies the soundness of the notation
	$\Delta_\alpha$ where $\alpha \colon \set{1, \dots, k} \to \Nat$ is a
	multi-index, where $\Delta_{\alpha} \defined \Delta_1^{\alpha_1} \cdots
		\Delta_k^{\alpha_k}$.
	Let us write $\card{\alpha} \defined \sum_{i = 1}^k \alpha_i$ for the
	size of a multi-index.
	We claim that for all $P \in \Rat[X_1, \dots, X_k]$ of degree at most $d$,
	the following \emph{discrete Taylor expansion} holds:
	\begin{equation}
		\label{discrete-taylor:eq}
		P =
		\sum_{\card{\alpha} \leq d}
		\Delta_{\alpha} P (0, \dots, 0)
		\times
		\prod_{i = 1}^k \pbinom{X_i}{\alpha_i}
		\quad .
	\end{equation}

	To obtain \cref{discrete-taylor:eq}, we proceed by induction on the degree $d$.
	When $d = 0$, the result is holds because $P = P(0, \dots, 0)$.
	Assume that the result holds for all polynomials of degree at most $d$.
	Let $P$ of degree at most $d+1$.
	Then, there exists coefficients $\seqof{c_{\alpha}}{\card{\alpha} \leq d+1}$
	in $\Rat$
	such that
	\begin{equation*}
		P = \sum_{\card{\alpha} \leq d+1} c_{\alpha} \prod_{i = 1}^k \pbinom{X_i}{\alpha_i}
		\quad .
	\end{equation*}
	This is because the monomials of the form $\prod_{i = 1}^k \pbinom{X_i}{\alpha_i}$
	form a basis of $\Rat[X_1, \dots, X_k]$.
	In particular, when applying one partial derivative, one can leverage the induction hypothesis to obtain:
	\begin{align*}
		\Delta_1 P & = \sum_{\card{\alpha} \leq d+1} c_{\alpha} \Delta_1 \prod_{i = 1}^k \pbinom{X_i}{\alpha_i}
		=
		\sum_{\card{\alpha} \leq d+1 \wedge \alpha_1 > 0} c_{\alpha}  \pbinom{X_1}{\alpha_1 - 1} \prod_{i = 2}^k \pbinom{X_i}{\alpha_i}
		\\
		           & = \sum_{\card{\beta} \leq d} \Delta_{\beta}(\Delta_1 P)(0,\dots,0) \times \pbinom{X_1}{\beta_1} \prod_{i = 2}^k \pbinom{X_i}{\beta_i}
		\quad .
	\end{align*}

	Using again the fact that the monomials form a basis, we conclude by
	identification that for all $\card{\alpha} \leq d+1$ such that $\alpha_1 >
		0$, we have $c_{\alpha} = \Delta_{\alpha}P (0,\dots,0)$. We can repeat the
	same process with $\Delta_i$ for $1 \leq i \leq k$ to obtain that
	$c_{\alpha} = \Delta_{\alpha} P (0,\dots, 0)$ for all $\alpha$ such that $1
		\leq \card{\alpha} \leq d+1$. Now, for the specific case of $\card{\alpha}
		= 0$, which is the constant term of $P$, we simply conclude that
	$P(0,\dots,0) = c_{\alpha}$, and notice that $\Delta_{\alpha} P = P$ in
	this case.

	Let us now conclude by noticing that if $P$ is \kl{integer-valued},
	then so is $\Delta_i P$ for all $1 \leq i \leq k$. As a consequence,
	so are $\Delta_{\alpha} P$, for all multi-indexes $\alpha$, and we conclude
	that $\Delta_{\alpha}P (0,\dots,0) \in \Rel$ for all $\alpha$.
	Combined with \cref{discrete-taylor:eq}, we conclude that $P$ is an \kl{integer binomial polynomial}.
    Remark that $\Delta_{\alpha} P (0, \dots, 0)$ only ever involves evaluation of $P$ on 
    $\Nat^k$, justifying the weakening of the hypothesis.
\end{proofof}


\begin{proofof}[polyrec-integer-strong:lem]
    Because $n P \in \CorrectPoly$,
    it is represented by a \kl{star-free $\Nat$-polyregular function} $f$ thanks to
    \cref{corrected-version:thm}. Let us now use \cref{n-sf-combinatorics:lem}
    to obtain a number $s \geq 1$ (that only depends on $P$) such
    that for all \kl{pumping patterns} $q \colon \Nat^p \to \Sigma^*$, $f
    \circ q(X_1 + s, \dots, X_p + s)$ is a \kl{natural binomial function} $F$
    over $\Nat^p$. We will use this $s$ with $p = k$, where
    $k = \card{\vec{X}}$ is the number of indeterminates of $P$,
    and $q(X_1, \dots, X_k) \defined \prod_{i = 1}^k a_i^{X_i}$,
    assuming the alphabet $\Sigma$ is $\set{a_1, \dots, a_k}$.
    In particular, $F(x_1, \dots, x_k) = f \circ q (x_1, \dots, x_k) = nP(x_1, \dots, x_k)$
    for all $\vec{x} \in (\Nat_{\geq s})^k$.
    Let us write the
    \kl{natural binomial function} $F$ as follows:
    \begin{equation*}
        F(X_1, \dots, X_k) =
        \sum_{\card{\alpha} \leq d} e_{\alpha} \prod_{i = 1}^k \binom{X -
        p_{\alpha,i}}{\alpha(i)} \quad
        \text{where } \forall 
        \card{\alpha} \leq d,
        e_{\alpha} \in \Nat
        \quad .
    \end{equation*}

    Because of the equality $\binom{X - p - 1}{k} + \binom{X - p - 1}{k -
    1} = \binom{X - p}{k}$, we conclude that we can find a $K \in \Nat$ and
    coefficients $f_{\alpha} \in \Nat$ such that $F(X_1, \dots, X_k) =
    \sum_{\card{\alpha} \leq d} f_{\alpha} \prod_{i = 1}^k \binom{X_i -
    K}{\alpha(i)}$, i.e., we can assume that $p_{\alpha,i} = K$ for all
    $\card{\alpha} \leq d$.
    Let us remark that $P$ is an \kl{integer-valued} polynomial of
    degree $d$, and therefore one can use
    \cref{integer-binomial-polynomial:lem} to rewrite it in the following form:
    \begin{equation*}
        P(X_1, \dots, X_k) = \sum_{\card{\alpha} \leq d}
        c_{\alpha} \prod_{i = 1}^k \pbinom{X_i - K}{\alpha(i)}
        \quad \text{where } \forall \card{\alpha} \leq d, 
        c_{\alpha}
        \in \Rel \quad .
    \end{equation*}

    Because $F(x_1, \dots, x_k) = P(x_1, \dots, x_k)$ for all
    $\vec{x} \in (\Nat_{\geq s})^k$, one can write
    \begin{equation*}
        n \left(\sum_{\card{\alpha} \leq d} c_{\alpha} \prod_{i = 1}^k \pbinom{x_i - K}{\alpha(i)} \right)
        = 
        \sum_{\card{\alpha} \leq d} f_{\alpha} \prod_{i = 1}^k \binom{x_i - K}{\alpha(i)}
        \quad 
        \forall \vec{x} \in (\Nat_{\geq s})^k
    \end{equation*}

    Because this equality holds over $(\Nat_{\geq s})^k$, we conclude that the
    underlying polynomials are equal in $\Rel[\vec{X}]$, and therefore that:
    \begin{equation*}
        \sum_{\card{\alpha} \leq d} n c_{\alpha} \prod_{i = 1}^k \pbinom{X_i - K}{\alpha(i)}
        = 
        \sum_{\card{\alpha} \leq d} f_{\alpha} \prod_{i = 1}^k \pbinom{X_i - K}{\alpha(i)}
    \end{equation*}

    Identifying the coefficients of the two polynomials (which is possible
    because the products of binomial coefficients translated by $K$ form a
    basis of $\Rat[\vec{X}]$), we conclude that for all $\card{\alpha} \leq d$,
    $n c_{\alpha} = f_{\alpha}$. In particular,
    for all $\card{\alpha} \leq d$, $c_{\alpha} \in \Nat$,
    hence $P$ is a \kl{natural binomial polynomial}.

    Remark that this reasoning remains true whenever we partially apply $P$ to
    some values in $\Nat$, since partial applications of $nP$ continue to be in
    $\CorrectPoly$ by definition, and remain \kl{integer-valued}. We have
    proven that $P$ is a \kl{strongly natural binomial polynomial}.
\end{proofof}

\section{Proofs of section  \ref{beyond-polynomials:sec}}

\begin{proofof}[decompose-polynomial:lem]
    Let us first remark that one only needs to consider the case where $f$ is a
    function in $\NPoly$, because every function $f \in \ZPoly$ can be decomposed
    as $f = f_+ - f_-$ where $f_+$ and $f_-$ 
    are \kl{$\Nat$-polyregular functions}, and because \kl{integer binomial
    polynomials} are closed under subtraction.
    Now, let us prove this result by induction on the number of letters in the alphabet.
    When the alphabet is empty, the result is trivial because $f$ can only be applied to $\varepsilon$,
    hence can be represented using a constant polynomial.

    Assume that the result holds for all functions with an alphabet of size at
    most $k-1$. We first apply \cref{n-poly-combinatorics:lem} to obtain a number
    $\omega$ such that for all \kl{pumping patterns} $q \colon \Nat^\ell \to
    \Sigma^*$, there exists a (computable) \kl{natural binomial function} $F_q$
    such that $f \circ q (\omega X_1, \dots, \omega X_\ell) = F_q$ over
    $(\Nat_{\geq 1})^\ell$.
    Given a tuple $\vec{r} \in \set{0, \dots, \omega - 1}^k$, and a 
    set $S \subseteq \set{1, \dots, k}$,
    let us define
    the \kl{pumping pattern} $q_{(S,\vec{r})} \colon \Nat^{\card{S}} \to \Sigma^*$ as
    $q_{(S, \vec{r})}(\seqof{X_i}{i \in S}) \defined \prod_{i = 1}^k a_i^{r_i} \cdot \prod_{i \in S} a_i^{X_i}$.
    Let us write $F_{(S,\vec{r})} \colon \Nat^{\card{S}} \to \Nat$ 
    for the associated
    \kl{natural binomial function} satisfying:
    \begin{equation*}
        f \left(
            \prod_{i = 1}^k a_i^{r_i}
            \cdot
            \prod_{i \in S} a_i^{\omega x_i}
        \right)
        = 
        F_{(S,\vec{r})}(\seqof{x_i}{i \in S})
        \quad 
        \forall \vec{x} \in (\Nat_{\geq 1})^{S}
        \quad .
    \end{equation*}

    Such a function $F_{(S,\vec{r})}$ coincides with a \kl{natural binomial
    polynomial} $P_{(S,\vec{r})} \in \Rat[\seqof{X_i}{i \in S}]$ on large
    enough inputs. Let us write $N_0 \geq 1$ be a number such that
    $F_{(S,\vec{r})}(\seqof{x_i}{i \in S}) = P_{(S,\vec{r})}(\seqof{x_i}{i \in
    S})$ for all $(S, \vec{r}) \in \ModuloTypes[\omega]^k$, for all $\vec{x}
    \in (\Nat_{\geq N_0})^{S}$. This $N_0$ is computable because one can
    collect upper bounds from the syntax of the \kl{natural binomial functions}
    $F_{(S,\vec{r})}$.
    We conclude that:
    \begin{equation*}
        f\left(
            \prod_{i = 1}^k a_i^{x_i}
        \right)
        = 
        P_{(S, \vec{r})}(\seqof{\floor{x_i / \omega}}{i \in S})
        \quad 
        \text{ where } (S, \vec{r}) = \moduloType[\omega](\vec{x})
        \text{ and }
        \vec{x} \in (\Nat_{\geq N_0 \omega})^k
        \quad .
    \end{equation*}

    This provides a representation for $f$ on large enough inputs, and we can
    apply the induction hypothesis on the functions $f_{a^n} \colon (\Sigma
    \setminus \set{a})^* \to \Nat$ in $\NPoly$ defined by $f_{a^n} (w) \defined
    f(a^n \cdot w)$, for every $a \in \Sigma$ and $n \leq N_0\omega$. Remark
    that \kl{integer binomial polynomials} are closed multiplying the input by
    a constant, hence that we can always move from a decomposition using
    $\omega$ to a decomposition using a multiple of $\omega$.
    Let us then consider as our new $\omega'$ the least common multiple of
    $\omega$, $N_0$, and all the $\omega_{a^n}$'s obtained for each $f_{a^n}$.

    We can now, given an entry $\vec{x} \in \Nat^k$ with
    $\moduloType[\omega'](x) = (S, \vec{r})$ recognize if a some letter
    $a$ appears less than $N_0 \omega$ times in the input, and apply the
    corresponding polynomials from the induction hypothesis if it is the case.
    Whenever all letters appear at least $N_0 \omega$ times, we can apply the
    polynomial $P_{(S,\vec{r})}$.
\end{proofof}

\section{Proofs of section \ref{sec:ccl}}

\begin{proofof}[pre-compose-growth-commut:lemma]
    If $f \in \ZPoly[k]$, then 
    for every \kl{polyregular function} $g \in \Poly[\ell]$,
    $f \circ g \in \ZPoly[k \times \ell]$
    \cite{CDTL23}.

    Conversely, it was proven in \cite[Theorem III.3]{CDTL23}
    that $f \in \ZPoly[k]$ if and only if
    for all $\alpha_0, \cdots, \alpha_k$,
    for all $w_1, \dots, w_k$,
    we have 
    \begin{equation}
        \label{k-pumpable:eqn}
        f\left(
            \alpha_0 \prod_{i = 1}^k w_i^{X_i} \alpha_i
        \right)
        = \bigO( (X_1 + \cdots X_k)^{k} )
        \quad .
    \end{equation}
    Now, the \kl{commutative} \kl{star-free polyregular function} 
    $h \colon \set{1, \dots, k}^* \to \Sigma^*$ that maps
    a word $u$
    to $\alpha \prod_{i = 1}^k w_i^{\card[i]{u}}$
    has \kl{growth rate} $1$.
    Hence, 
    $f \circ h \in \ZPoly[k]$, 
    and we indeed conclude that 
    \cref{k-pumpable:eqn}
    holds, i.e. that $f \in \ZPoly[k]$.
\end{proofof}

\begin{proofof}[pre-compose-sf-commut:lemma]
    If $f \in \ZSF$, then for all $h \in \SF$,
    $f \circ h \in \ZSF$, and \emph{a fortiori}
    for \kl{commutative} functions $h$.

    Conversely, assume that $f \circ h \in \ZSF$
    for all \kl{commutative} functions $h \in \SF$.
    Using \cite[Theorem V.13]{CDTL23},
    to conclude that $f \in \ZSF$,
    it suffices to prove that
    for all $\alpha_0, \cdots, \alpha_k \in \Sigma^*$,
    for all $w_1, \dots, w_k \in \Sigma^*$,
    there exists a polynomial $P \in \Rel[X_1, \dots,X_k]$
    and a constant $N_0 \in \Nat$,
    such that if $X_1, \dots, X_k \geq N_0$:
    \begin{equation}
        \label{ultimate-polynomial:eqn}
        f\left(
            \alpha_0 \prod_{i = 1}^k w_i^{X_i} \alpha_i
        \right)
        = P(X_1, \dots, X_k)
        \quad .
    \end{equation}
    Let us consider
    the \kl{commutative} \kl{star-free polyregular function}
    $h \colon \set{1, \dots, k}^* \to \Sigma^*$ that maps
    a word $u$
    to $\alpha \prod_{i = 1}^k w_i^{\card[i]{u}}$.
    We know that
    $f \circ h \in \ZSF$, hence, that 
    there exists $Q \in \Rel[X_1, \dots, X_n]$
    and $M_0 \in \Nat$,
    such that for all $X_1, \dots, X_n \geq N_0$,
    $f \circ h( \prod_{i = 1}^k \underline{i}^{X_i}) = Q(X_1, \dots, X_n)$.
    In particular,
    we can take $N_0 = M_0$, and $P = Q$ to conclude that
    \cref{ultimate-polynomial:eqn} holds, hence, that
    $f \in \ZSF$.
\end{proofof}
