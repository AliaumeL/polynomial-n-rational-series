%! TeX program = xelatex
%! lang = en-US
\section{Polynomials}
\label{polynomials:sec}

The goal of this section is to provide semantic characterizations of
\kl{$\Nat$-rational polynomials}, decide if a polynomial $P$ is a
\kl{$\Nat$-rational polynomial}, and if so, explicitly compute a
\kl{$\Nat$-polyregular function} $f$ that \kl{represents} $P$.

It is an easy check that polynomials with coefficients in $\Nat$ are
\kl{$\Nat$-rational polynomials} (\cref{n-poly-n-poly:example}). However,
\cref{negative-but-npoly:ex} provides an example of a polynomial with negative
coefficients that is a \kl{$\Nat$-rational polynomial}. As a consequence, the
class of interest strictly contains $\Nat[\vec{X}]$.

\begin{fact}
    \label{n-poly-n-poly:example}
    Let $P \in \Nat[\vec{X}]$. Then, $P$
    is a \kl{$\Nat$-rational polynomial}.
\end{fact}

\begin{example}
    \label{negative-but-npoly:ex}
    Let $P \defined X^2 -2X + 2$. Then $P$
    is a \kl{$\Nat$-rational polynomial}.
\end{example}
\begin{proof}
    Remark that $P = (X-1)^2 + 1$. Let $f  \colon \Sigma^* \to \Nat$
    that maps $aw \mapsto |w|^2$, and $\varepsilon \to 0$.
    It is clear that $f \in \NPoly$, and that 
    $P$ is \kl{represented} by
    $\ind{|w| \geq 1} \times f + \ind{|w| = 0}$.
\end{proof}

Let us now introduce the characterization of \kl{$\Nat$-rational polynomials}
given by \citeauthor{KARH77}, which is stated using a class
$\CoveredPoly[\vec{X}]$ of polynomials with multiple indeterminate.

\begin{definition}[{\cite[Section 3, page 3]{KARH77}}]
    Let $\vec{X}$ be a finite tuple of indeterminate.
    The class $\CoveredPoly[\vec{X}]$
    is the class of polynomials $P \in \Rel[\vec{X}]$
    that are \kl{non-negative}
    and such that every \kl{maximal monomial} is \kl{non-negative}.
    When the indeterminate are clear from the context, we write
    this class $\CoveredPoly$.
\end{definition}

\begin{faketheorem}[{\cite[Theorem 3.3, page 4]{KARH77}}] 
    \label{karh:thm}
    Let $\Sigma$ be a finite alphabet
    and $P$ be a polynomial. The following are equivalent:
    \begin{enumerate}
        \item $P$ is a \kl{$\Nat$-rational polynomial},
        \item $P \in \CoveredPoly$.
    \end{enumerate}
\end{faketheorem}


\subsection{The counter example}
\label{sec:c-example}

Let us now introduce the counter example that was found trying to generalize
the original proof $\ZPoly$.
The counter example will use three indeterminates, and
we will prove in \cref{sec:proof} that \citeauthor{KARH77}â€™s theorem holds on
polynomial with at most two indeterminate. In particular, the examples
appearing in \cite{KARH77} are not invalidated, as they all use at most two
indeterminates. Furthermore, the converse implication, that is, that
\kl{$\Nat$-rational polynomials} belong to $\CoveredPoly$ is correct, and can
even be strengthened as we will see in \cref{corrected-version:thm}.

\begin{definition}
    \label{def:bad-polynomial}
    We define $\BadPoly(X,Y,Z) \defined Z (X + Y)^2 + 2 (X - Y)^2$.
\end{definition}

\begin{lemma}
    \label{thm:counter-example}
    The polynomial $\BadPoly$ belongs to $\CoveredPoly$,
    but is not a \kl{$\Nat$-rational polynomial}.
\end{lemma}
\begin{proof}
    It is clear that $\BadPoly$ is \kl{non-negative}. We can develop
    the expression of $\BadPoly$ to 
    obtain
    $\BadPoly = ZX^2 + ZY^2 + 2ZXY + 2X^2 -4XY + 2Y^2$.
    The \kl{maximal monomials} of $P$
    are $ZX^2$, $ZY^2$, and $2ZXY$, all of which have
    \kl{positive coefficients}.

    Assume by contradiction that $\BadPoly$ is a \kl{$\Nat$-rational polynomial}.
    Let $\Sigma \defined \set{a,b,c}$ be a finite alphabet.
    There exists a \kl{commutative}
    \kl{$\Nat$-polyregular function} $f \colon \Sigma^* \to \Nat$
    such that for all $w \in \Sigma^*$,
    $\BadPoly(\card[a]{w}, \card[b]{w}, \card[c]{w}) = f(w)$.

    Remark that $\BadPoly(X,Y,Z) = 0$
    if and only if $Z(X+Y)^2 = -2 (X-Y)^2$. Hence,
    $\BadPoly(X,Y,Z)=0$ if and only if $Z = 0$ and $X = Y$, or 
    $Z \neq 0$, and $X = Y = 0$.

    Now, let us consider the language $L \defined \setof{w}{ f(w) = 0}$. By the
    above computation, we conclude that $L = \setof{ w \in \set{a,b}^* }{
    \card[a]{w} = \card[b]{w} } \cup \set{ c }^*$.
    Because $L \cap \set{a,b}^*$ not a regular language,
    we
    conclude that $L$ is not a regular language.
    However, $L = f^{-1}(\set{0})$ is a regular language
    (\cref{pre-image-regular:fact}). 
\end{proof}

\begin{corollary}
    The result stated in \cite[Theorem 3.3]{KARH77}, restated
    in \cref{karh:thm}, is false
    when allowing at least $3$ indeterminates.
\end{corollary}
