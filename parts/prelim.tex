%! TeX program = xelatex
%! lang = en-US
\section{Preliminaries}
\label{preliminaries:sec}

\AP In the rest of this paper, we use the symbol $\Rel$ to denote the set of
integers, $\Rat$ to denote the set of rational numbers, and $\Nat$ to denote
the set of non-negative integers. The capital letters $\Sigma,\Gamma$ denote
fixed alphabets, i.e. finite set of letters, and $\Sigma^*, \Gamma^*$ (resp.
$\Sigma^+, \Gamma^+$) are the set of words (resp. non-empty words) over
$\Sigma, \Gamma$. The empty word is written $\varepsilon \in \Sigma^*$. When $w
\in \Sigma^*$ and $a \in \Sigma$, we let $\card{w} \in \Nat$ be the length of
$w$, and $\card[a]{w}$ be the number of occurrences of $a$ in $w$. 

\AP
We assume that the reader is familiar with the basics of automata theory, in
particular the notions of monoid morphisms, idempotents in monoids, monadic
second-order ($\MSO$) logic and first-order ($\FO$) logic over finite words
(see e.g. \cite{THOM97}). As aperiodicity will be a central notion of this
paper, let us recall that a monoid $M$ is \intro(monoid){aperiodic} whenever
for all $x \in M$, there exists $n \in \Nat$ such that $x^{n+1} = x^n$.

\AP Let us briefly recall that one of the equivalent definitions of a
\intro{$K$-rational series} (where $K$ is a ring), and refer to \cite{BERE10}
for a comprehensive introduction. The \kl{$K$-rational series} from $\Sigma^*$
to $K$ are the functions computed by \intro{$K$-weighted automata} which are
non-deterministic finite automata with transitions labelled by elements of $K$,
and whose output on a given word is the sum over all accepting paths of the
products of the weights along the path. For instance, the function $w \mapsto
2^{\card{w}}$ is computed by an \kl{$\Nat$-weighted automaton} with a single
state, and a loop labelled by $2$, and is therefore an \kl{$\Nat$-rational
series}.

\AP We use the notation $\commute \colon \Sigma^* \to \Nat^\Sigma$ for the map
that counts occurrences of every letter in the input word (that is, computes
the Parikh vector) namely: $ \commute[w] \defined \seqof{a \mapsto
\card[a]{w}}{a \in \Sigma}$. Given a set $X$, a function $f \colon \Sigma^* \to
X$ is \intro{commutative} whenever for all $u \in \Sigma^*$, for all
permutations $\sigma$ of $\set{1, \dots, \card{w}}$, $f(\sigma(u)) = f(u)$.
Equivalently, it is \reintro{commutative} whenever there exists a map $g \colon
\Nat^\Sigma \to X$ such that $g \circ \commute = f$.

\AP Let $n \in \Nat$, and let $\Sigma$ be a finite alphabet. Given a function
$\eta \colon \set{1, \dots, n} \to \Sigma$, we define the $\eta^\dagger \colon
\Nat^n \to \Sigma^*$ as $\eta^\dagger(\vec{x}) \defined \eta(1)^{x_1} \dots
\eta(n)^{x_n}$. A function $f \colon \Nat^n \to X$ is \intro{represented} by a
\kl{commutative} function $g \colon \Sigma^* \to X$ if there exists a map $\eta
\colon \set{1, \dots, n} \to \Sigma$ such that $g \circ \eta^\dagger = f$. This
notion will be useful to formally state that a polynomial ``is'' a
\kl{commutative} \kl{polyregular function}. For instance, the polynomial
function $P(X,Y) = X \times Y$ is \kl{represented} by the \kl{commutative}
function $g \colon \set{a,b}^* \to \Rel$ defined by $g(w) \defined \card[a]{w}
\times \card[b]{w}$.

\subsection{Polyregular Functions}

\AP Because the functions of interest in this paper have output in $\Nat$ or
$\Rel$, we will only provide the definition of \kl{polyregular functions} for
these two output semigroups, and we refer the reader to \cite{BOKL19} for the
general definition of \kl{polyregular functions}. As a model of computation, we
will use the following definition of transducers, that is based on the marble
transducers \cite{EHB99}, and follows the general pattern of transducers
introduced in \cite{CDTL23}. Note that we only consider $\Rel$-valued (resp.
$\Nat$-valued) functions, but could consider other commutative semigroups.

\begin{definition}
    Let $\mathcal{H}$ be a family of functions
    from $\Sigma^*$ to $\Rel$.
    An \intro{$\mathcal{H}$-transducer} $\aTransd$ is
    a tuple $(Q, q_0, \delta, \lambda, F)$ where
         $Q$ is a finite set of states,
         $q_0 \in Q$ is called the initial state of the transducer,
         $\delta \colon Q \times \Sigma \to Q$
            is called the deterministic transition function of the transducer,
         $\lambda \colon Q \times \Sigma \to \mathcal{H}$
            is called the correction function of the transducer,
         and $F \colon Q \to \Rel$ is called the output function of the transducer.
\end{definition}

Based on this syntax, let us now define the semantics of a transducer, in terms
of the function from $\Sigma^*$ to $\Rel$ that it computes. The intuition is
that it suffices to apply the correction function $\lambda$ on every transition
of the underlying automaton, sum the results, and add to this number the output
associated to the final state of the computation.

\begin{definition}
    \label{transducer-sem:def}
    Let $\aTransd \defined (Q,q_0, \delta, \lambda, F)$ be an \kl{$\mathcal{H}$-transducer}.
    The function
    $\aTransd \colon Q \times \Sigma^* \to \Rel$
    is defined inductively as follows:
        $\aTransd(q, \varepsilon) \defined F(q)$, and
        $\aTransd(q, a u) \defined \aTransd(\delta(q,a), u)
            + \lambda(q,a)(u)$.
    The function \intro{computed} by a transducer $\aTransd$
    is $w \mapsto \aTransd(q_0, w)$.
\end{definition}

\begin{example}
    \label{simple-transd:ex}
    Let $\mathsf{Const}$ be the set of constant functions from $\Sigma^*$ to $\Rel$,
    and let us write $\const{n}$ for the constant function equal to $n \in \Rel$.
    In 
    \cref{simple-transd:fig}, we provide a graphical depiction of a
    \kl{$\mathsf{Const}$-transducer} that \kl{computes} the function
    $f \colon \set{a,b}^* \to \Rel$ defined by
    $f(\varepsilon) = 1$,
    $f(aw) = 3 \times \card{w}$,
    and $f(bw) = 3 \times \card{w} + 1$.
\end{example}

\begin{figure}
    \centering
    \begin{tikzpicture}[
        etat/.style={minimum size=2em}
        ]
        \node[etat,state,initial,
            accepting by arrow,
            accepting text={$1$},
            accepting where=below,
            ] (A) at (0,0) {$q_0$};
        \node[etat,state,
            accepting by arrow,
            accepting text={$0$},
            accepting where=below,
            ] (B) at (2.5,0) {$q_1$};

        \draw[->] (A) to[bend right=20] node[midway, below] {$a \mid \const{0}$} (B);
        \draw[->] (A) to[bend left=20] node[midway, above] {$b \mid \const{1}$} (B);


        \draw[->] (B) edge[loop right] node[midway, right]
            {$a,b \mid \const{3}$} (B);
    \end{tikzpicture}
    \caption{A \kl{$\mathsf{Const}$-transducer}, where $\mathsf{Const}$ is the set of constant functions
        from $\set{a,b}^*$ to $\Rel$,
        with a set of states $Q \defined \set{ q_0, q_1 }$,
        an initial state $q_0$,
        an output function $F \colon Q \to \Rel$ such that $F(q_0) = 1$ and $F(q_1) = 0$,
        and correction functions $\lambda(q,a) = \const{0}$, $\lambda(q,b) = \const{1}$,
        and $\lambda(q_1,a) = \lambda(q_1,b) = \const{3}$.
    }
    \label{simple-transd:fig}
\end{figure}

\AP Let us recall that a \intro{counter} in an automaton is a pair $u,w$ of
words together with an integer $n > 1$, such that $\delta(q_0, uw^n) =
\delta(q_0, u)$ and $\delta(q_0, u w^k) \neq \delta(q_0, u)$ for all $k < n$;
where we used the extension of $\delta \colon Q \times \Sigma \to Q$ to words
by defining $\delta(q, \varepsilon) = q$, and $\delta(q,au) =
\delta(\delta(q,a), u)$. An automaton is \reintro{counter-free} if it contains
no \reintro{counters}. This notion can be lifted to
\kl{$\mathcal{H}$-transducers} by considering counters of their underlying
automata. 

\AP The notion of \kl{$\mathcal{H}$-transducer} can be used to inductively
define the classes of
\intro{$\Rel $-polyregular functions}
$\intro*\ZPoly[k]$,
\intro{$\Nat $-polyregular functions}
$\intro*\NPoly[k]$,
\intro{star-free $\Rel $-polyregular functions}
$\intro*\ZSF[k]$, and
\intro{star-free $\Nat $-polyregular functions}
$\intro*\NSF[k]$, 
as follows \cite[Theorems 5.15 and 7.10]{DOUE23}: in the base
case, $\reintro*\NPoly[-1] = \reintro*\NSF[-1]  = \reintro*\ZSF[-1] =
\reintro*\ZPoly[-1]$ is the singleton containing the constant function equal to
$0$; and for $k \geq 0$, $\reintro*\ZPoly[k]$ is the set of functions
\kl{computed} by a \kl{$\reintro*\ZPoly[k-1]$-transducer}, and
$\reintro*\NPoly[k]$ is the set of functions \kl{computed} by an
\kl{$\reintro*\NPoly[k-1]$-transducer} \emph{with an $\Nat$-valued output
function $F$}, and similarly for $\reintro*\NSF[k]$ and $\reintro*\ZSF[k]$,
where the transducer is furthermore required to be \kl{counter-free}. Then,
$\reintro*\NPoly = \bigcup_{k \in \Nat} \reintro*\NPoly[k]$, and classes
$\reintro*\NSF$, $\reintro*\ZPoly$ and $\reintro*\ZSF$ are defined analogously.
In the rest of the paper, we will always assume that
\kl{$\reintro*\NPoly[k]$-transducers} and \kl{$\reintro*\NSF[k]$-transducers}
have an $\Nat$-valued output functions, making a clean separation between
$\NPoly$ and $\ZPoly$.

\begin{example}
    \label{non-canonical-transd:ex}
    Let $\BadExOk \colon \set{a}^* \to \Nat$
    be defined as
    $\BadExOk(\varepsilon) = 1$,
    $\BadExOk(a) = 0$,
    and $\BadExOk(a^n) = n-1$ for all $n \geq 2$.
    The function $\BadExOk$ is \kl{computed} by the two \kl{$\NPoly[0]$-transducers}
    depicted in \cref{non-canonical-transd:fig}.
    As a consequence, $f \in \NPoly[1]$.
    Furthermore, because the automaton of 
        \cref{non-canonical-transd:fig:counter-free}
        has no \kl{counter},
    and the correction function only uses functions in $\NSF[0]$,
    $f \in \NSF[1]$.
\end{example}
\begin{proofof}[non-canonical-transd:ex]
    Let us prove that the transducer of
    \cref{non-canonical-transd:fig:counter-free}
    computes $f$.
    We prove by induction on $w$
    that $A(q_0, w) = f(w)$,
    and that $A(q_1, w) = f(aw)$.
    Let us first remark that $f(au) = \card{u}$.
    
    When $w = \varepsilon$, $A(q_0, \varepsilon) = F(\varepsilon) = 1 = f(\varepsilon)$.
    Similarly, $A(q_1, \varepsilon) = F(q_1) = 0 = f(a)$.

    Assume that $w = au$. Then:
    \begin{align*}
        A(q_0, w) = A(q_0, au) &= \lambda(q_0, a)(u) + A(q_1, u) \\ 
                               &= 0 + A(q_1,u) \\
                               &= f(au) & \text{by induction hypothesis} \\
                               &= f(w) 
    \end{align*}
    Similarly,
    \begin{align*}
        A(q_1, w) = A(q_1, au) &= \lambda(q_1, a)(u) + A(q_1, u) \\ 
                               &= 1 + \ind{\card{u} = 0} + A(q_1,u) \\
                               &= 1 + \ind{\card{u} = 0} + f(au) & \text{by induction hypothesis} \\
                               &= \begin{cases}
                                    2 + f(a) & \text{if $u = \varepsilon$} \\
                                    1 + f(au) & \text{otherwise}
                               \end{cases}
                               \\
                               &= \begin{cases}
                                    2 & \text{if $u = \varepsilon$} \\
                                    1 + \card{u} & \text{otherwise}
                               \end{cases}
                               \\
                               &= \begin{cases}
                                   f(aa) & \text{if $u = \varepsilon$} \\
                                   f(
                               \end{cases}
    \end{align*}
\end{proofof}


\begin{figure}
    \centering
    \begin{subfigure}[b]{0.49\linewidth}
        \begin{tikzpicture}[
            etat/.style={minimum size=2em}
            ]
            \node[etat,state,initial,
                accepting by arrow,
                accepting text={$1$},
                accepting where=below,
                ] (A) at (0,0) {$\varepsilon$};
            \node[etat,state,
                accepting by arrow,
                accepting text={$0$},
                accepting where=below,
                ] (B) at (2,0) {$a$};

            \draw[->] (A) to node[midway, below] {$a \mid 0$} (B);

            \draw[->] (B) to[bend right=45] node[midway, above] {$a \mid 1 + \ind{\card{w} \geq 1}$} (A);
        \end{tikzpicture}
        \caption{This automaton has a \kl{counter}.}
    \end{subfigure}
    \begin{subfigure}[b]{0.49\linewidth}
        \begin{tikzpicture}[
            etat/.style={minimum size=2em}
            ]
            \node[etat,state,initial,
                accepting by arrow,
                accepting text={$1$},
                accepting where=below,
                ] (A) at (0,0) {$\varepsilon$};
            \node[etat,state,
                accepting by arrow,
                accepting text={$0$},
                accepting where=below,
                ] (B) at (2,0) {$a$};

            \draw[->] (A) to node[midway, below] {$a \mid 0$} (B);

            \draw[->] (B) edge[loop right] node[midway, right]
                {$a \mid 1$} (B);
        \end{tikzpicture}
        \caption{This automaton is \kl{counter-free}.}
        \label{non-canonical-transd:fig:counter-free}
    \end{subfigure}
    \caption{Two \kl{$\NPoly[0]$-transducers}
    \kl{computing} the function $\BadExOk$ of \cref{non-canonical-transd:ex},
    that maps $a^n$ to $n$ for all $n \geq 2$, $a$ to $0$, and $\varepsilon$ to $1$.
    }
    \label{non-canonical-transd:fig}
\end{figure}


\AP One of the appeals of $\NPoly$ and $\ZPoly$ are the numerous
characterizations of these classes in terms of logic, weighted automata, and
the larger class of \kl{polyregular functions} \cite{CDTL23,DOUE23}. In this
paper, the main focus will be the connection to weighted automata, which is
based on the notion of \emph{growth rate}. The \intro{growth rate} of a
function $f \colon \Sigma^* \to \Rel$ is defined as the minimal $k$ such that
$\card{f(w)} = \bigO\left(\card{w}^k\right)$. If such a $k$ exists, we say that
the function $f$ has \intro{polynomial growth}. It turns out that for all $k
\in \Nat$, $\ZPoly[k]$ (resp. $\NPoly[k]$) are precisely functions in $\ZRat$
(resp. in $\NRat)$ that have growth rate at most $k$. Not all
\kl{$\Nat$-rational series} have \kl{polynomial growth}, a typical example
being the function $a^n \mapsto 2^n$.

Let us briefly state that \kl{commutativity} is a decidable property of
\kl{$\Rel$-rational series}, hence of \kl{$\Rel$-polyregular functions}.

\begin{lemma}
    \label{decidable-commutative-poly:lemma}
    \label{decidable-commutative-rat:lemma}
    Let $f \in \ZRat$. One can decide if 
    $f$
    is \kl{commutative}.
\end{lemma}

\subsection{Polynomials} 
\AP All polynomials considered in this paper have
coefficients in $\Rel$ unless explicitly stated otherwise. 
A polynomial $P \in \Rel[X_1, \dots, X_k]$ is \intro{non-negative} when for
all non-negative integer inputs $n_1, \dots, n_k \geq 0$, the output  $P(n_1,
\dots, n_k)$ of the polynomial is non-negative. Beware that we do not consider
negative values as input, as the numbers $n_i$ will ultimately count the number
of occurrences of a letter in a word. As an example, the polynomial $(X - Y)^2$
is \kl{non-negative}, and so is the polynomial $X^3$, but the polynomial $X^2 -
2X$ is not.

\AP Let us now give some vocabulary on polynomials with multiple indeterminates
over $\Rel$. A \intro{monomial} is a product of indeterminates and integers.
For instance, $XY$ is a \kl{monomial}, $3 X$ is a \kl{monomial}, $-Y$ is a
\kl{monomial}, but $X + Y$ or $2X^2 + XY$ are not. We write $\intro*\Monomials[X_1,
\dots, X_n]$ for the set of \kl{monomials} over these indeterminates.
Every polynomial $P \in \Rel[X_1, \dots, X_n]$ decomposes uniquely
into a sum of \kl{monomials}.

\AP A \kl{monomial} $S$ \intro{divides} a \kl{monomial} $T$, when $S$ divides
$T$ seen as polynomials in $\Rat$. For instance, $2X$ \kl{divides} $XY$, $-YZ$
\kl{divides} $X^2 Y Z^3$, and $Y$ does not \kl{divide} $X$. In the
decomposition of $P \in \Rel[X_1, \dots, X_k]$, a \kl{monomial} is a
\intro{maximal monomial} if it is a maximal element for the \kl{divisibility
ordering} of \kl{monomials}. In the polynomial $P(X,Y) \defined X^2 - 2XY + Y^2
+ X + Y$, the set of \reintro{maximal monomials}, written
$\intro*\MaximalMonomials(P)$, is $\set{X^2,  -2 XY,  Y^2}$.  In the polynomial
$P(X,Y) \defined (X - Y)^2$, the \kl{non-negative} \kl{monomials} are $X^2$ and
$Y^2$.
