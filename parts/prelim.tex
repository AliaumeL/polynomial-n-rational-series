%! TeX program = xelatex
%! lang = en-US
\section{Preliminaries}
\label{preliminaries:sec}

\AP In the rest of this paper, we use the symbol $\Rel$ to denote the set of
integers, $\Rat$ to denote the set of rational numbers, and $\Nat$ to denote
the set of non-negative integers. The capital letters $\Sigma,\Gamma$ denote
fixed alphabets, i.e. finite set of letters, and $\Sigma^*, \Gamma^*$ (resp.
$\Sigma^+, \Gamma^+$) are the set of words (resp. non-empty words) over
$\Sigma, \Gamma$. The empty word is written $\varepsilon \in \Sigma^*$. When $w
\in \Sigma^*$ and $a \in \Sigma$, we let $\card{w} \in \Nat$ be the length of
$w$, and $\card[a]{w}$ be the number of occurrences of $a$ in $w$. 

\AP
We assume that the reader is familiar with the basics of automata theory, in
particular the notions of monoid morphisms, idempotents in monoids, monadic
second-order ($\MSO$) logic and first-order ($\FO$) logic over finite words
(see e.g. \cite{THOM97}). As aperiodicity will be a central notion of this
paper, let us recall that a monoid $M$ is \intro(monoid){aperiodic} whenever
for all $x \in M$, there exists $n \in \Nat$ such that $x^{n+1} = x^n$.

\AP Let us briefly recall that one of the equivalent definitions of a
\intro{$K$-rational series} (where $K$ is a ring), and refer to \cite{BERE10}
for a comprehensive introduction. The \kl{$K$-rational series} from $\Sigma^*$
to $K$ are the functions computed by \intro{$K$-weighted automata} which are
non-deterministic finite automata with transitions labelled by elements of $K$,
and whose output on a given word is the sum over all accepting paths of the
products of the weights along the path. For instance, the function $w \mapsto
2^{\card{w}}$ is computed by an \kl{$\Nat$-weighted automaton} with a single
state, and a loop labelled by $2$, and is therefore an \kl{$\Nat$-rational
series}.

\AP We use the notation $\commute \colon \Sigma^* \to \Nat^\Sigma$ for the map
that counts occurrences of every letter in the input word (that is, computes
the Parikh vector) namely: $ \commute[w] \defined \seqof{a \mapsto
\card[a]{w}}{a \in \Sigma}$. Given a set $X$, a function $f \colon \Sigma^* \to
X$ is \intro{commutative} whenever for all $u \in \Sigma^*$, for all
permutations $\sigma$ of $\set{1, \dots, \card{w}}$, $f(\sigma(u)) = f(u)$.
Equivalently, it is \reintro{commutative} whenever there exists a map $g \colon
\Nat^\Sigma \to X$ such that $g \circ \commute = f$.

\AP Let $n \in \Nat$, and let $\Sigma$ be a finite alphabet. Given a function
$\eta \colon \set{1, \dots, n} \to \Sigma$, we define the $\eta^\dagger \colon
\Nat^n \to \Sigma^*$ as $\eta^\dagger(\vec{x}) \defined \eta(1)^{x_1} \dots
\eta(n)^{x_n}$. A function $f \colon \Nat^n \to X$ is \intro{represented} by a
\kl{commutative} function $g \colon \Sigma^* \to X$ if there exists a map $\eta
\colon \set{1, \dots, n} \to \Sigma$ such that $g \circ \eta^\dagger = f$. This
notion will be useful to formally state that a polynomial ``is'' a
\kl{commutative} \kl{polyregular function}. For instance, the polynomial
function $P(X,Y) = X \times Y$ is \kl{represented} by the \kl{commutative}
function $g \colon \set{a,b}^* \to \Rel$ defined by $g(w) \defined \card[a]{w}
\times \card[b]{w}$.

\subsection{Polyregular Functions}
\label{polyregular:sec}

\AP Because the functions of interest in this paper have output in $\Nat$ or
$\Rel$, we will only provide the definition of \kl{polyregular functions} for
these two output semigroups, and we refer the reader to \cite{BOKL19} for the
general definition of \kl{polyregular functions}. 


\AP In order to prove \cref{n-poly-combinatorics:lem}, we will rely on an
equivalent definition of \kl{$\Nat$-polyregular functions} that is more
combinatorial in nature, and is similar in shape to the \emph{finite counting
automata} introduced by \cite{SCHU62}. Note that we only consider $\Rel$-valued (resp.
$\Nat$-valued) functions, but could consider other commutative semigroups.

\begin{definition}[$\Rel$-polyregular functions {\cite{CDTL23}}]
    \label{nat-rel-poly:def}
    Let $M$ be a finite monoid, $\mu \colon \Sigma^* \to M$
    be a morphism, $k \in \Nat$, and 
    $\pi \colon M^k \to \Rel$ be a function.
    The following function 
    $\pi^\dagger \colon \Sigma^* \to \Rel$
    is \kl{$\Rel$-polyregular}:
    \begin{equation*}
        \pi^\dagger (w) \defined
        \sum_{w = u_1 \cdots u_k} \pi(\mu(u_1), \dots, \mu(u_k))
        \quad .
    \end{equation*}
    When $\pi$ has co-domain $\Nat$, the function $\pi^\dagger$
    is furthermore \kl{$\Nat$-polyregular}.
    We call $\pi$ the \emph{production function} of $\pi^\dagger$.
    If the monoid $M$ is \kl(monoid){aperiodic}
    then
    the function $f$ is \kl{star-free $\Rel$-polyregular}
    (resp. \kl{star-free $\Nat$-polyregular}).
\end{definition}

In order to illustrate the above definition, let us provide an example of a
\kl{$\Nat$-polyregular function} computed using a finite monoid.

\begin{example}
    \label{size-of-word-nsf:ex}
    The map $f \colon w \mapsto \card{w} + 1$
    belongs to $\NSF$.
\end{example}
\begin{proof}
    Let us define $M \defined (\set{1}, \times)$ which is 
    a finite \kl{aperiodic monoid}, $\mu \colon \Sigma^* \to M$
    defined by $\mu(w) \defined 1$, and
    $\pi \colon M^2 \to \Nat$
    that is the constant function equal to $1$.
    We check that for all $w \in \Sigma^*$:
    \begin{equation*}
        \pi^\dagger(w)
        =
        \sum_{uv = w} 1
        =
        \card{w} + 1
        = f(w)
        \quad . 
        \qedhere
    \end{equation*}
\end{proof}



\AP One of the appeals of $\NPoly$ and $\ZPoly$ are the numerous
characterizations of these classes in terms of logic, weighted automata, and
the larger class of \kl{polyregular functions} \cite{CDTL23,DOUE23}. In this
paper, the main focus will be the connection to weighted automata, which is
based on the notion of \emph{growth rate}. The \intro{growth rate} of a
function $f \colon \Sigma^* \to \Rel$ is defined as the minimal $k$ such that
$\card{f(w)} = \bigO\left(\card{w}^k\right)$. If such a $k$ exists, we say that
the function $f$ has \intro{polynomial growth}. It turns out that for all $k
\in \Nat$, $\ZPoly[k]$ (resp. $\NPoly[k]$) are precisely functions in $\ZRat$
(resp. in $\NRat)$ that have growth rate at most $k$ \cite{CDTL23}. 

\AP The notion of \kl{$\mathcal{H}$-transducer} can be used to inductively
define the classes of \intro{$\Rel $-polyregular functions} $\intro*\ZPoly[k]$,
\intro{$\Nat $-polyregular functions} $\intro*\NPoly[k]$, \intro{star-free
$\Rel $-polyregular functions} $\intro*\ZSF[k]$, and \intro{star-free $\Nat
$-polyregular functions} $\intro*\NSF[k]$, as follows \cite[Theorems 5.15 and
7.10]{DOUE23}: in the base case, $\reintro*\NPoly[-1] = \reintro*\NSF[-1]  =
\reintro*\ZSF[-1] = \reintro*\ZPoly[-1]$ is the singleton containing the
constant function equal to $0$; and for $k \geq 0$, $\reintro*\ZPoly[k]$ is the
set of functions \kl{computed} by a \kl{$\reintro*\ZPoly[k-1]$-transducer}, and
$\reintro*\NPoly[k]$ is the set of functions \kl{computed} by an
\kl{$\reintro*\NPoly[k-1]$-transducer} \emph{with an $\Nat$-valued output
function $F$}, and similarly for $\reintro*\NSF[k]$ and $\reintro*\ZSF[k]$,
where the transducer is furthermore required to be \kl{counter-free}. Then,
$\reintro*\NPoly = \bigcup_{k \in \Nat} \reintro*\NPoly[k]$, and classes
$\reintro*\NSF$, $\reintro*\ZPoly$ and $\reintro*\ZSF$ are defined analogously.
In the rest of the paper, we will always assume that
\kl{$\reintro*\NPoly[k]$-transducers} and \kl{$\reintro*\NSF[k]$-transducers}
have an $\Nat$-valued output functions, making a clean separation between
$\NPoly$ and $\ZPoly$. that \kl{represents} $P$.



Because $f$ has \kl{polynomial
growth}, it is in fact a \kl{$\Nat$-polyregular function} (\cite[Theorem
5.22]{DOUE23}).
\begin{lemma}[CITE]
    \label{polyregular-polynomial-growth:lemma}
    Let $f \in \ZRat$. The following are equivalent:
    \begin{enumerate}
        \item $f \in \ZPoly[k]$.
        \item $f$ has polynomial growth of degree at most $k$.
    \end{enumerate}
    And similarly for $\NPoly$ and $\NRat$.
\end{lemma}

Let us state the crucial compositional properties of
\kl{$\Rel$-polyregular functions} that will be used in this paper
to construct \kl{$\Rel$-polyregular functions}.
\begin{lemma}[CITE]
    \label{stability-polyregular:lemma}
    The class $\NPoly[k]$ (resp. $\ZPoly[k]$) is stable under the operations of
    addition, multiplication, Cauchy product,
    and ``value pinning''.
\end{lemma}

Let us briefly state that \kl{commutativity} is a decidable property of
\kl{$\Rel$-rational series}, hence of \kl{$\Rel$-polyregular functions}.

\begin{lemma}
    \label{decidable-commutative-poly:lemma}
    \label{decidable-commutative-rat:lemma}
    Let $f \in \ZRat$. One can decide if 
    $f$
    is \kl{commutative}.
\end{lemma}
\begin{proof}
    Remark that the group of permutations of $\set{1, \dots, n}$ is generated by
    the cycle $c \defined (n,1, \dots, n-1)$ and the transposition $t \defined (1, 2)$.
    As a consequence, a function $f$ is commutative if and only if
    $f \circ c = f = f \circ t$.
    When $f$ is a rational series,
    $f \circ c$ and $f \circ t$ are both rational series that can be
    effectively computed from $f$, and since equivalence
    of rational series is decidable 
    \cite[\textbf{WHERE}]{BERE10}
    we have obtained a decision procedure.
\end{proof}

\subsection{Polynomials} 
\AP All polynomials considered in this paper have
coefficients in $\Rel$ unless explicitly stated otherwise. 
A polynomial $P \in \Rel[X_1, \dots, X_k]$ is \intro{non-negative} when for
all non-negative integer inputs $n_1, \dots, n_k \geq 0$, the output  $P(n_1,
\dots, n_k)$ of the polynomial is non-negative. Beware that we do not consider
negative values as input, as the numbers $n_i$ will ultimately count the number
of occurrences of a letter in a word. As an example, the polynomial $(X - Y)^2$
is \kl{non-negative}, and so is the polynomial $X^3$, but the polynomial $X^2 -
2X$ is not.

\AP Let us now give some vocabulary on polynomials with multiple indeterminates
over $\Rel$. A \intro{monomial} is a product of indeterminates and integers.
For instance, $XY$ is a \kl{monomial}, $3 X$ is a \kl{monomial}, $-Y$ is a
\kl{monomial}, but $X + Y$ and $2X^2 + XY$ are not. We write $\intro*\Monomials[X_1,
\dots, X_n]$ for the set of \kl{monomials} over these indeterminates.
Every polynomial $P \in \Rel[X_1, \dots, X_n]$ decomposes uniquely
into a sum of \kl{monomials}.

\AP A \kl{monomial} $S$ \intro{divides} a \kl{monomial} $T$, when $S$ divides
$T$ seen as polynomials in $\Rat$. For instance, $2X$ \kl{divides} $XY$, $-YZ$
\kl{divides} $X^2 Y Z^3$, and $Y$ does not \kl{divide} $X$. In the
decomposition of $P \in \Rel[X_1, \dots, X_k]$, a \kl{monomial} is a
\intro{maximal monomial} if it is a maximal element for the \kl{divisibility
ordering} of \kl{monomials}. In the polynomial $P(X,Y) \defined X^2 - 2XY + Y^2
+ X + Y$, the set of \reintro{maximal monomials}, written
$\intro*\MaximalMonomials(P)$, is $\set{X^2,  -2 XY,  Y^2}$.  In the polynomial
$P(X,Y) \defined (X - Y)^2$, the \kl{non-negative} \kl{monomials} are $X^2$ and
$Y^2$.
