%! TeX program = xelatex
%! lang = en-US
\subsection{The Corrected Theorem}
\label{sec:proof}

The counter example provided by \cref{def:bad-polynomial} relies on the fact
that $\CoveredPoly$ is not stable under fixing indeterminates, while
\kl{$\Nat$-polyregular functions} are. In this section, we prove that closing
$\CorrectPoly$ under assignments of variable is enough to recover from
\cref{karh:thm}. Because the previous attempt to characterize this class of
polynomials did not hold, this part of the paper will try to be extremely
precise.

\AP We use the following notation to fix the value of some indeterminate, if
$P(X,Y)$ is a polynomial in $\Rel[X,Y]$, then $\intro*\restr{P(X,Y)}{X = 1}$ is
the polynomial $P(1,Y) \in \Rel[Y]$. More generally, if $\nu$ is a partial
function from $\vec{X}$ to $\Nat$, written $\nu \colon \vec{X} \topartial
\Nat$, the restriction $\restr{P(\vec{X})}{\nu}$ is the polynomial with
indeterminates $\vec{Y} \defined \vec{X} - \dom(\nu)$ obtained by fixing the
variables of the domain of $\nu$.


\begin{definition}
    Let $\vec{X}$ be a finite tuple of indeterminates.
    The class $\CorrectPoly[\vec{X}]$ is the collection of
    polynomials $P \in \Rel[\vec{X}]$ such that
    $P$ is 
    such that, for every partial function $\nu \colon \vec{X} \topartial \Nat$,
    every \kl{maximal monomial} of
    $\restr{P}{\nu}$ is \kl{non-negative}.
\end{definition}

First, let us remark that $\CorrectPoly \subseteq \CoveredPoly$, because
polynomials in $\CorrectPoly$ are \kl{non-negative}. Let us also check that the
counter example provided in \cref{thm:counter-example} is not in
$\CorrectPoly$. For that, notice that for $\BadPoly$ introduced in
\cref{def:bad-polynomial}, $\BadPoly(X,Y,1) = 3X^2 + 3Y^2 - 2XY$, which has a negative
coefficient for a \kl{maximal monomial}, namely $-2XY$. 

Let us now prove that \kl{$\Nat$-rational polynomials} are in $\CorrectPoly$.
The following \cref{n-poly-combinatorics:lem} is a slight refinement over the
classical combinatorial analysis of \kl{$\Rel$-polyregular functions}
\cite[Lemma 4.16]{LOPEZ23b} and \kl{$\Nat$-polyregular functions} that takes
into account \emph{all} \kl{maximal monomials} instead of a specific one
\cite[Lemma 5.37]{gaetanphd}.

\begin{lemma}
    \label{n-poly-combinatorics:lem}
    Let $f$ be a  \kl{$\Nat$-polyregular} function. 
    There exists $\omega \in \Nat$
    such that for all $p \in \Nat$,
    for all $\alpha_0, \dots, \alpha_p \in \Sigma^*$,
    for all $u_1, \dots, u_p \in \Sigma^*$,
    there exists a polynomial $P \in \Rel[X_1, \dots, X_p]$
    whose \kl{maximal monomials} are \kl{non-negative},
    and such that for all $X_1, \dots, X_p \geq \omega$:
    \begin{equation*}
        f\left(
            \alpha_0 \prod_{i = 1}^p u_i^{\omega \times X_i} \alpha_i
        \right)
        = P(X_1, \dots, X_p) \quad .
    \end{equation*}
\end{lemma}
\begin{proof}
    Let $\omega$ be an idempotent power for the finite monoid $M$,
    and
    $w \defined \alpha_0 \prod_{i = 1}^p (u_i^{\omega \times X_i} \alpha_i)$.
    Let $k \in \Nat$, and $\pi \colon M^k \topartial \Nat$ be such that
    $f = \pi^\dagger$. That is, 
    $f(w)$ is the sum over all factorizations of $w$
    into $k$ words $(w_1, \dots, w_k) \in \Sigma^*$
    of the value $\pi(\mu(w_1), \dots, \mu(w_k))$.

    Let us define an equivalence relation $\equiv$ over words of
    $\Sigma^*$ as follows: two words $v_1, v_2$ are equivalent if they are
    equal when normalizing them with the rules $u_i^{\omega} u_i^{\omega} \to
    u_i^{\omega}$ for all $1 \leq i \leq p$. That is, we disregard
    repetitions of the factors $u_i^{\omega}$ in the words.
    We lift the equivalence relation $\equiv$ to $k$-tuples of
    words by pointwise application.

    Remark that if $(v_1, \dots, v_k) \equiv (w_1, \dots, w_k)$ then
    $\pi(\mu(v_1), \dots, \mu(v_k)) = \pi(\mu(w_1), \dots, \mu(w_k))$ because
    $\mu(u_i^\omega) = \mu(u_i)^\omega$ is an idempotent element of the monoid
    $M$. In particular, $f(w)$ can be computed as the sum over equivalence
    classes for $\equiv$, of the value of $\pi$ on one representative,
    which belongs to $\Nat$.

    Therefore, it suffices to prove that the number of partitions of $w$ in a
    single equivalence class for $\equiv$ is a polynomial $P(X_1, \dots, X_p)$
    with \kl{positive coefficients} for its \kl{maximal monomials}.

    Notice that to produce all elements in a given equivalence class
    means adding the factors $u_i^\omega$ where $1 \leq i \leq p$
    back to the normalized version
    of the equivalence class. For all elements in an equivalence class,
    one has to add the same amount of $u_i^\omega$ for $1 \leq i \leq p$,
    and therefore the number of possible choices
    is either constant, or 
    is a product of binomials of the form $\binom{X - l}{s}$
    which has the desired shape.
\end{proof}


\begin{corollary}
    \label{n-rat-correct:lem}
    Let $P \in \Rel[X_1, \dots, X_p]$ be \kl{represented}
    by a \kl{$\Nat$-rational series}. Then,
    $P \in \CorrectPoly$.
\end{corollary}
\begin{proof}
    Let $f$ be the \kl{commutative}
    \kl{$\Nat$-rational series}
    with domain $\Sigma \defined \set{a_1, \dots, a_p}$
    that \kl{represents} $P$. Because $f$ has \kl{polynomial growth},
    it is in fact a \kl{$\Nat$-polyregular function}
    (\cref{polynomial-rational-polyreg:fact}).
    Using \cref{n-poly-combinatorics:lem},
    there exists a number $\omega \in \Nat$
    and polynomial $Q$ with \kl{positive coefficients} for its
    \kl{maximal monomials} such that
    for all $X_1, \dots, X_p \geq \omega$:
    \begin{equation*}
        f\left(
            \prod_{i = 1}^p (a_i)^{\omega \times X_i}
        \right)
        = Q(X_1, \dots, X_p)
        = P(\omega X_1, \dots, \omega X_p) 
        \quad .
    \end{equation*}
    We conclude that $P(\omega X_1, \dots, \omega X_p) = Q(X_1, \dots, X_p)$
    as polynomials,
    and in particular that
    the \kl{maximal monomials} of 
    $P$ have \kl{positive coefficients}.

    Remark that for every partial valuation $\nu \colon \vec{X} \topartial \Nat$,
    the polynomial $\restr{P}{\nu}$ continues to be represented
    by a \kl{$\Nat$-polyregular function}, namely
    $f$ partially applied to a word. As a consequence,
    the \kl{maximal monomials} of
    $\restr{P}{\nu}$ also have \kl{positive coefficients}, and 
    we have proven that $P \in \CorrectPoly$.
\end{proof}





\AP The core of the upcoming \cref{lem:correct-to-n-rat} leverages a notion of
\kl{discrete derivative} to perform an induction on the \kl{maximal monomials},
and suitable notions of \kl{translations} of the domain of polynomials. Namely,
we write $\translate{K}$ for the \intro{translation function} that maps a
polynomial $P \in \Rel[X_1, \dots, X_n]$ to the polynomial $P(X_1 + K, \dots,
X_n + K)$.

\begin{fact}
    \label{translation-invariance:fact}
    The following sets are stable under \kl{translations}
    $\translate{K}$,
    where $K \in \Nat$ is non-negative:
    \begin{itemize}
        \item $\CorrectPoly$,
        \item \kl{$\Nat$-rational polynomials},
        \item Polynomials \kl{represented}
            by \kl{star-free $\Nat$-polyregular functions}.
    \end{itemize}
\end{fact}

The idea behind the \kl{discrete derivative} introduced in
\cref{discrete-derivative:def} is to consider the map $P \mapsto P(X) -
P(X-K)$, which will be formulated using the \kl{translation function} in the
case of multiple variables.

\begin{definition}
    \label{discrete-derivative:def}
    Let $\vec{X}$ be a tuple of indeterminates,
    $K \in \Nat$,
    and 
    $P \in \Rel[\vec{X}]$ be a polynomial.
    \begin{equation*}
        \Diff{K}{P} \defined 
        P - \translate{-K}(P) \quad .
    \end{equation*}
\end{definition}

Let us now prove that for a single indeterminate $X$, polynomials $P \in
\CorrectPoly$ are \kl{$\Nat$-rational polynomials}. This will illustrate how
the different ingredients piece together. Given a polynomial $P \in
\CorrectPoly$, the goal is to build a \kl{$\Nat$-polyregular function} $f$ that
\kl{represents} $P$. Note that in this case, the function has unary input and
unary output. We prove the result on the degree $\deg(P)$ of the polynomial
$P$, where the base case is trivial because when $P$ is a constant function,
this constant must be in $\Nat$. For the induction step, we can assume that $P
= \alpha X^n + Q$, where $\deg(Q) < \deg(P)$, $n \geq 1$, and $\alpha > 0$. On
the one hand, $\alpha X^n$ is a \kl{$\Nat$-rational polynomial}, but on the
other hand, $Q$ may not belong to $\CorrectPoly$. However, there exists $K \in
\Nat$ such that $\Diff{K}{X^n} + Q$ belongs to $\CorrectPoly$, for instance by
considering $K$ to be the sum of absolute values of coefficients of $P$.
Furthermore, $\Diff{K}{X^n} + Q$ has degree smaller than $\deg(P)$, hence is a
\kl{$\Nat$-rational polynomial}. Now, $P = \alpha (X - K)^n + \Diff{K}{X^n} +
Q$, and therefore, $P(X+K) = X^n + (\Diff{K}{X^n} + Q)(X+K)$ is a
\kl{$\Nat$-rational polynomial}, \kl{represented} by a \kl{$\Nat$-polyregular
function} $f_1$. Now, for values $k$ of $X$ that are smaller than $K$, we can
compute $P(k) = \restr{P}{X=k}$, which belongs to $\Nat$. It is possible to
build a \kl{$\Nat$-polyregular function} $f_2 \colon \Nat \to \Nat$ that
outputs $P(k)$ if the input is at most $K$, and $f_1(k)$ otherwise.


In the actual statement of \cref{corrected-version:thm}, the representation of
polynomials in $\CorrectPoly$ is strengthened from \kl{$\Nat$-polyregular
functions} to \kl{star-free $\Nat$-polyregular functions}. This is not
surprising, given the conjecture that \kl{ultimate polynomial}
\kl{$\Nat$-polyregular functions} (re-introduced in \cref{star-free:sec}) were
conjectured to be star free in \cite{LOPEZ23b}.


When multiple indeterminate are involved, a bit of care is needed. The key
ingredient is that one has a fine control over the \kl{maximal monomials} of
the \kl{discrete derivatives}, even when fixing some indeterminates.
As one would expect, the \kl{discrete derivatives} are linear operations on
polynomials, that commutes with the partial application operators
$\restr{\cdot}{\nu}$, and the \kl{translation operators} $\translate{K}$.

\begin{fact}
    \label{discrete-deriv-linear:fact}
    For all tuple $\vec{X}$ of indeterminates,
    for all $K \in \Nat$, $L \in \Rel$, for all partial function
    $\nu \colon \vec{X} \topartial \Nat$:
    \begin{enumerate}
        \item $\translate{K} \colon \Rel[\vec{X}] \to \Rel[\vec{X}]$
            is a linear operator,
        \item $\Diff{K}{ \cdot } \colon \Rel[\vec{X}] \to \Rel[\vec{X}]$
            is a linear operator,
        \item $\restr{\cdot}{\nu} \colon \Rel[\vec{X}] \to \Rel[\vec{X}]$
            is a linear operator,
        \item $\Diff{K}{ \cdot } \circ \restr{\cdot}{\nu}
            = \restr{\cdot}{\nu} \circ \Diff{K}{\cdot}$.
        \item $\Diff{K}{ \cdot } \circ \translate{L}
            = \translate{K} \circ \Diff{L}{\cdot}$,
        \item $\restr{\cdot}{\nu} \circ \translate{L}
            = \translate{L} \circ \restr{\cdot}{\translate{L}(\nu)}$.
    \end{enumerate}
\end{fact}

\begin{fact}
    \label{translation-maximal:fact}
    For all $P \in \Rel[\vec{X}]$, and $K \in \Nat$,
    $\MaximalMonomials(P) = \MaximalMonomials(\translate{K}(P))$.
\end{fact}

\AP Let us now introduce the ordering over which the induction of
\cref{lem:correct-to-n-rat} is built. Recall that $\MaximalMonomials(P)$ is the
set of \kl{maximal monomials} of $P$, hence belongs to $\Pfin(\Monomials)$. We
order \kl{monomials} with the \kl{divisibility ordering}, making $\Monomials$ a
\kl{well-quasi-ordering} that is isomorphic to $\Nat^k$ with the product
ordering \cite[see e.g.][Dickson’s Lemma]{SCSC12}. We endow $\Pfin(\Monomials)$
with the \intro{Hoare ordering}, that is, $S_1 \hoareleq S_2$ whenever for all
\kl{monomials} $M_1 \in S_1$, there exists a monomial $M_2 \in S_2$, such that
$M_1$ \kl{divides} $M_2$. The set $(\Pfin(\Monomials), \hoareleq)$ remains a
\kl{well-quasi-ordering} \cite[see e.g.][Hoare quasi-ordering]{SCSC12}.

The following \cref{derivation-simplifies:lemma,derivation-covers:lemma} 
show how the \kl{discrete differentiation} operator
interacts with \kl{maximal monomials} with respect to the \kl{Hoare ordering}:
it extracts \emph{submaximal} monomials from a given polynomial.

\begin{lemma}
    \label{derivation-simplifies:lemma}
    For all $P \in \Rel[\vec{X}]$ that are non-constant,
    for all $K \in \Nat$,
    $\MaximalMonomials(\Diff{K}{P}) \hoarele
    \MaximalMonomials(P)$.
\end{lemma}
\begin{proof}
    By linearity of $\Diff{K}{P}$ (\cref{discrete-deriv-linear:fact}), 
    it suffices to prove the result
    for \kl{monomials} $S \in \Monomials$.
\end{proof}

\begin{fact}
    Let $K > 0$,
    and let $M,T$ be two \kl{monomials}, such that
    $T$ \kl{strictly divides} $M$.
    Then,
    $T$ \kl{divides} some \kl{maximal monomial}
    of $\Diff{K}{M}$.
\end{fact}

\begin{lemma}
    \label{derivation-covers:lemma}
    For all $P,Q \in \Rel[\vec{X}]$ that are non-constant,
    for all $K > 0$,
    if $\MaximalMonomials(P) \hoarele \MaximalMonomials(Q)$,
    then
    $\MaximalMonomials(P) \hoareleq \MaximalMonomials(\Diff{K}{Q})$.
\end{lemma}


\begin{lemma}
    \label{derivation-stabilises-correct:lem}
    Let $P \in \CorrectPoly$,
    $P_1$ be the sum of \kl{maximal monomials} of $P$,
    and $P_2 \defined P - P_1$ be the sum of
    non-maximal monomials of $P$.
    There exists a computable $K$,
    such that
    $(\Diff{K}{P_1} + P_2) \in \CorrectPoly$.
\end{lemma}


\begin{lemma}
    \label{lem:correct-to-n-rat}
    Let $\vec{X}$ be a tuple of indeterminates,
    and let $P \in \Rel[\vec{X}]$.
    If $P \in \CorrectPoly$, then $P$ is \kl{represented}
    by a \kl{star-free $\Nat$-polyregular function},
    which can be explicitly constructed from $P$.
\end{lemma}
\begin{proof}
    We prove the result by induction on $\MaximalMonomials(P)$. 
    In the proof, we write $\vec{X}$ for the indeterminates appearing in $P$,
    that is, we assume without loss of generality that all indeterminates are used.

    \textbf{Base case:} If the (unique) \kl{maximal monomial} of $P$ is a
    constant term. Since $P \in \CorrectPoly$, $P = n \in \Nat$, and therefore
    $P$ is \kl{represented} by a constant \kl{star-free $\Nat$-polyregular
    function}.

    \textbf{Induction:} Assume that $P$ is not a constant polynomial, and let
    us write $P = P_1 + P_2$ where $P_1$ is the sum of the \kl{maximal
    monomials} of $P$. We compute a bound $K$ such that $Q \defined
    (\Diff{K}{P_1} + P_2) \in \CorrectPoly$ using
    \cref{derivation-stabilises-correct:lem}. Thanks to
    \cref{derivation-simplifies:lemma}, we also know that $\MaximalMonomials(Q)
    \hoarele \MaximalMonomials(P)$. By induction hypothesis, $Q$ is
    \kl{represented} by a \kl{star-free $\Nat$-polyregular function}
    which is effectively computable.

    Let us now remark that $P_1 \in \Nat[\vec{X}]$, and is therefore
    (effectively) \kl{represented} by a \kl{star-free $\Nat$-polyregular function}
    (\cref{n-poly-n-poly:example}).
    Furthermore, $\translate{K}(Q)$ is also (effectively)
    \kl{represented} by a \kl{star-free $\Nat$-polyregular function}
    (see \cref{translation-invariance:fact}).
    As a consequence, $\translate{K}(P)$ is (effectively) \kl{represented} 
    by a function $f_\Delta$,
    since it is obtained as the following sum:
    \begin{equation*}
        \translate{K}(P) 
        = P_1 + \translate{K}(Q) \quad .
    \end{equation*}

    For all partial valuations $\nu \colon \vec{X} \topartial \set{0, \dots, K}$
    fixing at least one indeterminate, $\MaximalMonomials(\restr{P}{\nu})
    \hoarele \MaximalMonomials{P}$. Because $\restr{P}{\nu} \in \CorrectPoly$,
    one can use the induction hypothesis to compute a \kl{star-free
    $\Nat$-polyregular function} $f_\nu$ that \kl{represents} $\restr{P}{\nu}$.


    Let us assume that the alphabet over which the (\kl{commutative}) functions
    $f_\Delta$ and $f_\nu$ are defined is $\set{a_1, \dots, a_n}$, with $a_i$
    representing the indeterminate $X_i$ of the polynomials. Now, let us define
    by case analysis the following \kl{commutative} \kl{star-free
    $\Nat$-polyregular function}, defined on words $w$ of the form $w \defined
    a_1^{X_1} \cdots a_n^{X_n}$, with $X_1, \dots, X_n \geq 0$.

    \begin{equation*}
        f(w) \defined
        \begin{cases}
            f_\nu(w) & \text{ if } \exists i \in \set{1, \dots, n}, X_i \leq K \\
            f_\Delta(a_1^{X_1 - K} \cdots a_n^{X_n - K}) & \text{ otherwise }
        \end{cases}
        \quad .
    \end{equation*}
    It is clear that
    $f$ is a \kl{commutative} \kl{star-free $\Nat$-polyregular function},
    and that
    $f$ \kl{represents} $P$.
\end{proof}

While \cref{lem:correct-to-n-rat} provides effective conversion, it does not
explicitly state that the membership is decidable to keep the proof clearer. A
similar proof scheme can be followed to conclude that membership is decidable.

\begin{lemma}
    \label{decidability-correct:lem}
    It is decidable whether a polynomial 
    $P \in \Rel[\vec{X}]$
    belongs to $\CorrectPoly$.
\end{lemma}
\begin{proof}
    Let $P \in \Rel[\vec{X}]$. We prove by induction on
    $\MaximalMonomials(P)$ that whether $P \in \CorrectPoly$
    is decidable.

    If $P$ is a constant polynomial, then
    $P \in \CorrectPoly$ if and only if $P = n \in \Nat$
    which is decidable.

    Otherwise, $P$ is not a constant polynomial, and let us write $P = P_1 +
    P_2$ where $P_1$ is the sum of the \kl{maximal monomials} of $P$. If $P_1
    \not \in \Nat[\vec{X}]$, then $P \not \in \CorrectPoly$, and this is
    decidable. Hence, we can assume that $P_1 \in \Nat[\vec{X}]$. Using
    \cref{derivation-stabilises-correct:lem}, there exists a computable bound
    $K$, such that if $P \in \CorrectPoly$, then t $Q \defined (\Diff{K}{P_1} +
    P_2) \in \CorrectPoly$. Leveraging, \cref{derivation-simplifies:lemma}, we
    also know that $\MaximalMonomials(Q) \hoarele \MaximalMonomials(P)$, and
    therefore that we can decide whether $Q \in \CorrectPoly$. Notice that if
    $Q \not \in \CorrectPoly$, then $P \not \in \CorrectPoly$, hence we can
    assume that $Q \in \CorrectPoly$.

    Similarly, for partial valuations
    $\nu \colon \vec{X} \topartial \set{0, \dots, K}$
    fixing at least one indeterminate, $\MaximalMonomials(\restr{P}{\nu})
    \hoarele \MaximalMonomials{P}$. 
    We can check for all these partial valuations that
    $\restr{P}{\nu} \in \CorrectPoly$ by induction hypothesis,
    and if one test is not satisfied, then $P \not \in \CorrectPoly$.

    Let us now conclude that if all the above checks answered correctly,
    then $P \in \CorrectPoly$. Let $\nu \colon \vec{X} \topartial \Nat$
    be a partial valuation. Then, 
    one of the three following cases arise:
    \begin{itemize}
        \item 
            Either,
        $\nu$ fixes \emph{some} indeterminate $X_i$ to a value $n_i < K$.
        In that case, let us define $\delta$ as the partial function that coincides
        with $\nu$ on its domain
        $\dom(\delta) = \dom(\nu) \setminus \set{ X_i }$.
        Then, $\restr{P}{\nu} = \restr{\restr{P}{X_i = n_i}}{\delta}$.
        As we previously checked that $\restr{P}{X_i = n_i} \in \CorrectPoly$,
        we conclude in particular that 
        $\restr{P}{\nu}$ has \kl{non-negative} \kl{maximal monomials}.

        \item Or, for all $X_i$ in the (potentially empty) domain of $\nu$, $\nu(X_i)
            \geq K$. In that case, let us write $\delta \defined
            \translate{-K}(\nu)$, that is the partial map $\delta \colon
            \vec{X} \topartial \Nat$ having the same domain as $\nu$, and such
            that for all $X_i \in \dom(\nu)$, $\delta(X_i) \defined \nu(X_i) -
            K$. Recall that $Q = \Diff{K}{P_1} + P_2$, and therefore that
            $\translate{K}(P) = P_1 + \translate{K}(Q)$. By linearity,
            $\restr{\translate{K}(P)}{\delta} = \restr{P_1}{\delta} +
            \restr{\translate{K}(Q)}{\delta}$, and we conclude that the
            \kl{maximal monomials} of $\restr{\translate{K}(P)}{\delta}$ are
            \kl{non-negative}.
            Since $\restr{\translate{K}(P)}{\delta} = \translate{K}{\restr{P}{\nu}}$,
            and since
            $\translate{K}$ leaves \kl{maximal monomials} invariant,
            we conclude that
            the \kl{maximal monomials} of $\restr{P}{\nu}$
            are the same as those of $\restr{\translate{K}(P)}{\delta}$,
            and are therefore \kl{non-negative}.
            \qedhere
    \end{itemize}
\end{proof}

We are now ready to state the corrected and generalized version of
\cref{karh:thm}, which is the main technical contribution of the paper.

\begin{theorem}
    \label{corrected-version:thm}
    Let $P \in \Rel[\vec{X}]$ be a polynomial.
    The following are equivalent:
    \begin{enumerate}
        \item \label{corrected-1:item} $P \in \CorrectPoly$,
        \item \label{corrected-2:item} $P$ is \kl{represented} by a \kl{$\Nat$-rational series},
        \item \label{corrected-3:item} $P$ is \kl{represented} by a \kl{$\Nat$-polyregular function},
        \item \label{corrected-4:item} $P$ is \kl{represented} by a \kl{star-free $\Nat$-polyregular function},
    \end{enumerate}
    Furthermore, the membership is decidable, and effective conversion
    procedures exist between all the representations.
\end{theorem}
\begin{proof}
    The implications 
    \cref{corrected-4:item} $\implies$
    \cref{corrected-3:item} $\implies$
    \cref{corrected-2:item} are obvious.
    \cref{lem:correct-to-n-rat} proves
    \cref{corrected-1:item} $\implies$ \cref{corrected-4:item},
    while \cref{n-rat-correct:lem}
    proves 
    \cref{corrected-2:item} $\implies$ \cref{corrected-1:item}.
    Note that the lemmas provide effective conversion procedures,
    and that \cref{lem:correct-to-n-rat} also provides a decision
    procedure.
\end{proof}

Let us now state, for the sake of a completeness, the equality of
$\CorrectPoly$ and $\CoveredPoly$ in the case of two indeterminates. This is
relevant because it shows that examples given in \cite{KARH77} are actually
correct, even though based on an invalid result, and it may be the case for
other works based on \cite{KARH77}.

\begin{lemma}
    \label{lem:correct-covered-2}
    $\CorrectPoly[X,Y] = \CoveredPoly[X,Y]$.
\end{lemma}
\begin{proof}
    It is clear that $\CorrectPoly[X,Y] \subseteq \CoveredPoly[X,Y]$,
    by considering the empty valuation $\nu \colon \set{X,Y} \topartial \Nat$.
    For the converse inclusion, let us consider $P(X,Y)$
    that is \kl{non-negative}, such that the \kl{maximal monomials}
    have \kl{positive coefficients}.
   

    If we fix none of the variables, then the \kl{maximal monomials}
    have \kl{positive coefficients} by assumption. If we fix one of the
    variables, we can assume without loss of generality that we 
    fix $X = k$ for some $k \in \Nat$.
    Then $P(k,Y)$ is a \kl{non-negative} \emph{univariate} polynomial, 
    and therefore must have a positive leading coefficient
    (which is the unique \kl{maximal monomial} in this case)
    or be constant equal to 0. In both cases, the \kl{maximal monomials}
    have \kl{positive coefficients}.
    The same reasoning applies \emph{a fortiori} in the case where
    we fix the two indeterminate, leading to a constant polynomial.
\end{proof}


It was conjectured in the 
\cite[Open question 5.55]{gaetanphd}.
\cite[Conjecture 7.61]{gaetanphd}
Let us remark that a previous conjecture was not true, and provide the
recursively defined variant. This can be understood in the light of
\cref{corrected-version:thm}, as the fact that \kl{$\Nat$-rational polynomials}
are essentially $\Nat$-polynomials.

\begin{example}
    The polynomial $\BadPoly$ is not a 
    \kl{$\Nat$-rational polynomial},
    but is \kl{non-negative} and satisfies
    $\translate{10}(\BadPoly) \in \Nat[\vec{X}]$.
\end{example}

\begin{lemma}
    \label{derivation-translation:lem}
    Let $P \in \Rel[\vec{X}]$, the following are equivalent
    \begin{enumerate}
        \item \label{d-t-correct:item} $P \in \CorrectPoly$,
        \item \label{d-t-transl:item}
            There exists $K \in \Nat$,
            such that for every partial
            function $\nu \colon \vec{X} \topartial \Nat$,
            $\translate{K}(\restr{P}{\nu}) \in \Nat[\vec{X}]$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    To prove \cref{d-t-transl:item} $\implies$
    \cref{d-t-correct:item}, let us remark that
    if $P$ is \kl{non-negative} and $\translate{K}(P) \in \Nat[\vec{X}]$,
    then $\translate{K}(P) \in \CorrectPoly$ thanks to
    \cref{n-poly-n-poly:example}.
    In particular, 
    then for every partial valuation 
    $\nu \colon \vec{X} \topartial \Nat$, 
    $\restr{\translate{K}(P)}{\nu} \in \Nat[\vec{X}]$,
    and in particular conclude that
    \kl{maximal monomials} of $\restr{\translate{K}(P)}{\nu}$ are exactly the
    \kl{maximal monomials} of $\restr{P}{\nu}$, the former being
    \kl{non-negative} if $\translate{K}(P) \in \Nat[\vec{X}]$.

    Conversely, the implication \cref{d-t-correct:item} $\implies$
    \cref{d-t-transl:item} is proven by induction on $\MaximalMonomials(P)$.
    If $P$ is a constant polynomial, then $P = n$ for some $n \in \Nat$,
    and we conclude that $\translate{0}(P) \in \Nat[\vec{X}]$.
    Otherwise, $P = P_1 + P_2$ where $P_1$ is the sum of the \kl{maximal
    monomials} of $P$.
    Using \cref{derivation-stabilises-correct:lem},
    there exists a computable $K \in \Nat$
    such that 
    $Q \defined
    \Diff{K}{P_1} + P_2$ belongs to $\CorrectPoly$.
    Since, $\MaximalMonomials(Q) \hoarele \MaximalMonomials(P)$,
    we conclude by induction hypothesis that
    there exists $L \in \Nat$ such that 
    for every partial valuation $\nu \colon \vec{X} \topartial \Nat$,
    $\translate{L}(\restr{Q}{\nu}) \in \Nat[\vec{X}]$. 
    Similarly,
    for all partial functions $\nu \colon \vec{X} \topartial \Nat$
    fixing at least one indeterminate (appearing in $P$),
    $\MaximalMonomials(\restr{P}{\nu}) \hoarele \MaximalMonomials(P)$,
    hence there exists $L_\nu \in \Nat$ such that
    $\translate{L_\nu}{\restr{P}{\nu}} \in \Nat[\vec{X}]$.
    Let us define $L_m$ to be the maximum of $L$, and $L_\nu$
    where $\nu$ ranges over partial functions described above.

    Let us prove that for all partial functions
    $\nu \colon \vec{X} \topartial \Nat$,
    $\translate{L_m + K}(\restr{P}{\nu}) \in \Nat[\vec{X}]$.
    If $\nu$ is the empty valuation, then $\restr{P}{\nu} = P$,
    and
    $\translate{L_m + K}(P) = \translate{L_m}(P_1) + \translate{K+L_m}(Q)$
    is a sum of two polynomials in $\Nat[\vec{X}]$.
    Otherwise,
    $\translate{L_m + K}(\restr{P}{\nu}) = \translate{K}(\translate{L_m}(\restr{P}{\nu}))$
    belongs to $\Nat[\vec{X}]$ since the latter is stable under
    positive translations.
\end{proof}

