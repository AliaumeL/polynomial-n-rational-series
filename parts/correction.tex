%! TeX program = xelatex
%! lang = en-US

\AP We will discuss at the end of \cref{sec:poly-to-n-poly} why
\cref{thm:counter-example} is minimal in the number of indeterminates, which
first requires us to provide a \emph{correct} analogue of \cref{karh:thm}. Our
counterexample relies on the fact that $\CoveredPoly$ is not stable under
fixing indeterminates, while \kl{$\Nat$-rational polynomials} are. Indeed, the
polynomial $\BadPoly$ satisfies
$\BadPoly(X,Y,1) = 3X^2 + 3Y^2 - 2XY$, which has a negative coefficient for a
\kl{maximal monomial}. Let us now prove that closing
$\CoveredPoly$ under variable assignments is enough to recover from
\cref{karh:thm}. We use the following notation to fix the value of some
indeterminate, if $P(X,Y)$ is a polynomial in $\Rel[X,Y]$, then
$\intro*\restr{P(X,Y)}{X = 1}$ is the polynomial $P(1,Y) \in \Rel[Y]$. More
generally, if $\nu$ is a partial function from $\vec{X}$ to $\Nat$, written
$\nu \colon \vec{X} \topartial \Nat$, the restriction $\restr{P(\vec{X})}{\nu}$
is the polynomial with indeterminates $\vec{Y} \defined \vec{X} - \dom(\nu)$
obtained by fixing the variables of the domain of $\nu$.


\begin{definition}
	The class $\intro*\CorrectPoly[\vec{X}]$ is the collection of
	polynomials $P \in \Rel[\vec{X}]$ such that,
	for every partial function $\nu \colon \vec{X} \topartial \Nat$,
	every \kl{maximal monomial} of
	$\restr{P}{\nu}$ is \kl{non-negative}.
\end{definition}

First, let us remark that $\CorrectPoly \subseteq \CoveredPoly$, because
polynomials in $\CorrectPoly$ are \kl{non-negative}. We also remarked at the
beginning of this section that our counterexample $\BadPoly$ provided in
\cref{thm:counter-example} is not in $\CorrectPoly$. The rest of the
section is mainly concerned with proving the following corrected version of
\cref{karh:thm}.

\begin{theorem}[label=corrected-version:thm,]
	Let $P \in \Rel[\vec{X}]$.
	The following are equivalent:
	\begin{enumerate}
		\item \label{corrected-1:item} $P \in \CorrectPoly$,
		\item \label{corrected-2:item} $P$ is \kl{represented} by a \kl{$\Nat$-rational series},
		\item \label{corrected-3:item} $P$ is \kl{represented} by a \kl{$\Nat$-polyregular function},
		\item \label{corrected-4:item} $P$ is \kl{represented} by a \kl{star-free $\Nat$-polyregular function},
	\end{enumerate}
	Furthermore, the properties are decidable, and conversions effective.
\end{theorem}

\Cref{corrected-version:thm} is surprising given the
fact that it is not possible to decide whether a polynomial $P \in \Rel[\vec{X}]$
is \kl{non-negative} or if a polynomial $P$ belongs to $\CoveredPoly$
(\cref{undecidable-non-negative:lem}), by reduction to the undecidability of
Hilbert's Tenth Problem \cite{HILB1902,MATI1970}. That is, $\CorrectPoly$ is a
decidable class that strictly contains $\Nat[\vec{X}]$, and is contained in the
undecidable classes $\CoveredPoly$ and the class of \kl{non-negative}
polynomials.

\begin{remark}[restate=undecidable-non-negative:lem,label=undecidable-non-negative:lem]
    \proofref{undecidable-non-negative:lem}
    Checking whether a polynomial
    $P \in \Rel[\vec{X}]$ is \kl{non-negative} is undecidable.
    Similarly, checking whether a polynomial $P \in \Rel[\vec{X}]$
    belongs to $\CoveredPoly$ is undecidable.
\end{remark}


The proof of \cref{corrected-version:thm} is divided into two parts. First, we
provide in \cref{sec:n-poly-to-poly} a fine combinatorial understanding of what
functions can be computed in $\NPoly$ and $\ZPoly$. This allows us to prove
that \kl{$\Nat$-polyregular functions} are in $\CorrectPoly$
(\cref{n-rat-correct:lem}). Then, in \cref{sec:poly-to-n-poly} we will show how
to compute polynomials in $\CorrectPoly$ using $\NPoly$
(\cref{lem:correct-to-n-rat}). Finally, we will next generalize
\cref{corrected-version:thm} to polynomials in $\Rat[\vec{X}]$ in
\cref{sec:rel-to-rat}.


\subsection{From $\Nat$-polyregular functions to polynomials}
\label{sec:n-poly-to-poly}

\AP Let us prove that \kl{$\Nat$-rational polynomials} are in $\CorrectPoly$.
This fact follows from the correct implication in the statement of
\cref{karh:thm}, but
we provide a self-contained proof using a refinement of the classical
combinatorial \emph{pumping arguments} for $\ZPoly$ \cite[Lemma 4.16]{CDTL23} and
$\NPoly$ \cite[Lemma 5.37]{DOUE23}. We take extra care to reprove in our
upcoming \cref{n-poly-combinatorics:lem} a strong statement that has
two main goals. Our first goal is to highlight the role of \kl{commutative}
\kl{polyregular functions} in the broader study of \kl{polyregular functions},
which is done by reformulating the traditional pumping argument as a
composition property involving said functions, which will be reused in the
upcoming \cref{k-combinatorial:def,ultimately-polynomial:def}
of
\cref{beyond-polynomials:sec}. Our second goal
is to give a precise shape of the functions that arise from such \emph{pumping
arguments}, which was lacking in former similar statements.

\AP To address our first goal, let us define that a function $q$ is a
\intro{pumping pattern} from $\Nat^p$ to $\Sigma^*$
whenever there exists words $\alpha_0, \dots, \alpha_p \in \Sigma^*$, and words
$u_1, \dots, u_p \in \Sigma^*$, such that $q(X_1, \dots, X_p) = \alpha_0
\prod_{i = 1}^p u_i^{X_i} \alpha_i$. That is, $q$ is syntactically defined by a
non-commutative monomial over the monoid $\Sigma^*$. \kl{Pumping patterns}
are \kl{commutative} \kl{polyregular functions}.

\AP Our second goal is achieved by understanding that \kl{$\Nat$-polyregular
functions} essentially compute binomial coefficients, as illustrated by the
polynomial $X(X-1)/2 = \binom{X}{2}$
of \cref{q-polynomial-n-poly:ex}. A \intro{simple binomial function} is a
function of the form $\binom{X - \ell}{k}$, where $\ell$ and $k$ are natural
numbers. We extend this to \intro{natural binomial functions} that are obtained
by considering $\Nat$-linear combinations of products of \kl{simple binomial
functions}, that is, we consider functions that have the following shape:
$f(x_1, \dots, x_k) = \sum_{i = 1}^n n_i \prod_{j = 1}^k \binom{x_j -
p_{i,j}}{k_{i,j}}$. Beware that $\binom{X - \ell}{k}$ is defined to be $0$ when
$X \leq \ell$, and is therefore not a polynomial. Let us immediately
prove that \kl{simple binomial functions}  can be \kl{represented} in $\NSF$,
generalizing \cref{q-polynomial-n-poly:ex}.
Conversely, we prove in \cref{n-poly-combinatorics:lem} that,
    when suitably pumping a \kl{$\Nat$-polyregular function}, one
always obtains \kl{natural binomial functions}.


\begin{lemma}
	\label{binomial-function-star-free:lem}
	Let $F$ be a \kl{simple binomial function} from $\Nat^k$ to $\Nat$.
	Then it is \kl{represented} by a \kl{star-free polyregular function}.
\end{lemma}
\begin{proof}
	Because of the stability properties of
	$\NSF$ (\cref{stability-polyregular:lemma}), we only need to
	check that given $r,s \in \Nat$,
	the function $x \mapsto \binom{x - r}{s}$ is \kl{represented}
	by a function $f_{r,s} \in \NSF$.
	Let us prove it when $r = 0$, since the other functions
	can be obtained by translating $f_{r,s}$.
    By definition, $\binom{x}{s} = \card{P_{x,s}}$,
    where $P_{x,s} \defined \setof{ (x_1, \dots, x_s) \in \Nat^s }{ 1 \leq x_1 < \cdots < x_s \leq x }$.
    Let us proceed as in \cref{q-polynomial-n-poly:ex} and define 
    $D_{w,s} \defined \setof{ (u_1, \dots, u_s, u_{s+1}) \in (\Sigma^+)^s \times \Sigma^* }{ w = u_1 u_2 \cdots u_s u_{s+1} }$.
    It is clear that $D_{a^x,s}$ is in bijection with $P_{x,s}$ for all $x \in \Nat$
    using the map $(x_1, \dots, x_s) \mapsto (a^{x_1}, \dots, a^{x_s})$.
    Now, using the monoid $M \defined (\set{0,1}, \max)$
    and the morphism $\mu(\varepsilon) \defined 0$ and $\mu(a) \defined 1$,
    one can compute $\card{D_{w,s}}$ 
    as $\pi^\dagger (w)$ where $\pi \colon M^{s+1} \to \Nat$ is defined by
    $\pi(m_1, \dots, m_s, m_{s+1}) \defined m_1 \times \cdots \times m_s$.
    We conclude that $f_{0,s} \in \NSF[s]$ is a \kl{star-free polyregular function}.
\end{proof}


\begin{lemma}[restate=n-poly-combinatorics:lem,label=n-poly-combinatorics:lem]
    \proofref{n-poly-combinatorics:lem}
	Let $f$ be an \kl{$\Nat$-polyregular} function.
	There exists a computable $\omega \in \Nat_{\geq 1}$
	such that for all \kl{pumping patterns}
	$q \colon \Nat^p \to \Sigma^*$,
	there exists a computable \kl{natural binomial function} $F$
	such that:
	\begin{equation*}
		f \circ q(\omega X_1, \dots, \omega X_p)
		=
		F
		\quad
		\text{ over } (\Nat_{\geq 1})^p
		\quad .
	\end{equation*}
\end{lemma}

The multiplicative factor $\omega$ is necessary in
\cref{n-poly-combinatorics:lem}. Indeed, the function $f \colon \set{a}^* \to
\Nat$ defined as $0$ when the input is of odd length and $1$ when the input is
of even length is \kl{$\Nat$-polyregular}, but $f(a^X)$ is not a polynomial. We
can trade off this multiplicative factor for a constant term addition under the
extra assumption that the function is \kl{star-free polyregular}, as described
in the following \cref{n-sf-combinatorics:lem}. This lemma is not immediately
of use, but is crucial for the upcoming characterization of $\Nat$-rational
polynomials in \cref{decide-rat-poly-npoly:cor}, which in turn is a key
ingredient of our main \cref{zsf-npoly-nsf:thm}.

\begin{lemma}[restate=n-sf-combinatorics:lem,label=n-sf-combinatorics:lem]
    \proofref{n-sf-combinatorics:lem}
	Let $f$ be a \kl{star-free $\Nat$-polyregular} function.
	There exists a computable $s \in \Nat_{\geq 1}$
	such that for all \kl{pumping patterns}
	$q \colon \Nat^p \to \Sigma^*$,
	there exists a computable \kl{natural binomial function} $F$
	such that:
	\begin{equation*}
		f \circ q(X_1 + s, \dots, X_p + s)
		=
		F
		\quad
		\text{ over } \Nat^p
		\quad .
	\end{equation*}
\end{lemma}

Because \kl{natural binomial functions} behave as polynomials with
\kl{non-negative} \kl{maximal monomials} on large enough inputs, we can
conclude from \cref{n-poly-combinatorics:lem}
that \kl{$\Nat$-rational polynomials} are in $\CorrectPoly$.

\begin{corollary}
	\label{n-rat-correct:lem}
	Let $P \in \Rel[X_1, \dots, X_p]$ be an \kl{$\Nat$-rational polynomial}.
	Then,
	$P \in \CorrectPoly$.
\end{corollary}
\begin{proof}
    Let $f$ be a \kl{commutative} \kl{$\Nat$-rational series}
	with domain defined as $\Sigma \defined \set{a_1, \dots, a_p}$
	that \kl{represents} $P$.
    Because $f$ has \kl{polynomial growth},
    $f \in \NPoly$ 
    (\cref{polyregular-polynomial-growth:lemma}).
	Using \cref{n-poly-combinatorics:lem},
	there exists a number $\omega \in \Nat_{\geq 1}$
	and \kl{natural binomial function} $Q$
	such that
	for all $n_1, \dots, n_p \geq 1$:
	\begin{equation*}
		f\left(
		\prod_{i = 1}^p a_i^{\omega n_i}
		\right)
		= Q(n_1, \dots, n_p)
		= P(\omega n_1, \dots, \omega n_p)
		\quad .
	\end{equation*}
    For large enough values of $X$, the \kl{simple binomial function}
	$\binom{X - p}{k}$ coincides with a polynomial whose leading coefficient
	is $1/k!$ which is \kl{non-negative}.
	We conclude that
	the \kl{maximal monomials} of
	$P(\omega X_1, \dots, \omega X_p)$ are \kl{non-negative},
	and since $\omega \geq 1$, we conclude that
	the \kl{maximal monomials} of $P$ have \kl{non-negative} coefficients.

	For every partial valuation $\nu \colon \vec{X} \topartial \Nat$,
	the polynomial $\restr{P}{\nu}$ continues to be represented
	by a \kl{$\Nat$-polyregular function}, namely
	$f_u \colon w \mapsto f(uw)$ 
    where $w$ belongs to a restricted alphabet.
    As a consequence,
	the \kl{maximal monomials} of
	$\restr{P}{\nu}$ are also \kl{non-negative},
	and
	we have proven that $P \in \CorrectPoly$.
\end{proof}


\subsection{From polynomials to $\Nat$-polyregular functions}
\label{sec:poly-to-n-poly}

\AP This section is devoted to proving that polynomials in $\CorrectPoly$ can
be \kl{represented} by \kl{star-free $\Nat$-polyregular functions}. The key
lemma of this section is \cref{lem:correct-to-n-rat}, which is proved by
induction on the number of indeterminates of a given polynomial $P$. In order
to prove that result, we use the combinatorial
\cref{derivation-stabilises-correct:lem} that allows us to transform a
polynomial $P \in \CorrectPoly$ into a polynomial in $\Nat[\vec{X}]$ through a
well-chosen translation of the indeterminates. This argument is based on the
notion of \intro{discrete derivative} which is built by translating the domain
of the polynomial. To that end, let us write $\intro*\translate{K}$ for the
\intro{translation function} that maps a polynomial $P \in \Rel[X_1, \dots,
X_k]$ to the polynomial $P(X_1 + K, \dots, X_k + K)$.

\begin{definition}
	\label{discrete-derivative:def}
	Let
	$K \in \Nat$,
	and
	$P \in \Rel[\vec{X}]$ be a polynomial,
	then
	%\begin{equation*}
	$
		\intro*\Diff{K}{P} \defined
		\translate{K}(P) - P
	$.
	%    \quad .
	%\end{equation*}
\end{definition}



\begin{lemma}
	\label{all-positive-derivative:lem}
	Let $P \in \Nat[\vec{X}]$ that is non-constant, and $K \in \Nat$,
	then $\Diff{K}{P} \in \Nat[\vec{X}]$ and all of its
	coefficients are (positive) multiples of $K$.
	Furthermore, every monomial that strictly divides some monomial of $P$
	appears in $\Diff{K}{P}$.
\end{lemma}
\begin{proof}
	We prove the result for monomials, as it extends
	to $\Nat$-linear combinations by linearity.
	Let $P = \prod_{i = 1}^k X_i^{\alpha_i}$ be a monomial.
	Notice that $\translate{K}(P) = \prod_{i = 1}^k (X_i + K)^{\alpha_i}$,
	and using a binomial expansion
	we list all the possible divisors of $P$,
	all of which with coefficients that are positive integers and multiples of $K$ except the coefficient
	of the maximal monomial (equal to $P$ itself) which is $1$.
	As a consequence, $\translate{K}(P) - P$ is simply
	obtained by removing this maximal monomial, which concludes the proof.
\end{proof}

\begin{lemma}
	\label{derivation-stabilises-correct:lem}
	Let $P \in \CorrectPoly$,
	$P_1$ be the sum of \kl{maximal monomials} of $P$,
	and $P_2 \defined P - P_1$ be the sum of
	non-maximal monomials of $P$.
	There exists a computable number $K \in \Nat$,
	such that
	$Q \defined (\Diff{K}{P_1} + \translate{K}(P_2)) \in \Nat[\vec{X}]$.
\end{lemma}
\begin{proof}
	Let us first tackle the specific case where $P$ is a constant polynomial.
	In this case, $P_1 = P$ and $P_2 = 0$.
	Furthermore, $\Diff{K}{P_1} = 0$ for all $K \in \Nat$.
	We conclude that $\Diff{K}{P_1} + \translate{K}(P_2) = 0$
	for all $K \in \Nat$, hence belongs to $\Nat[\vec{X}]$. Selecting $K = 0$
	we conclude.
	Assume now that $P$ is not a constant polynomial. We will use
	\cref{all-positive-derivative:lem} on a well-selected value of $K$. Let us
	write $\alpha$ to be the maximal absolute value of a coefficient in $P$.
	Let $D$ be the number of unitary monomials that divide some monomial
	appearing in $P$. We can now define $K \defined D \times \alpha$,
	and let
	$Q \defined (\Diff{K}{P_1} + \translate{K}(P_2))$.
	Remark that $\Diff{K}{P_1}$ is already in $\Nat[\vec{X}]$,
	and the constant coefficient of $\translate{K}(P_2)$ is also
	in $\Nat$.
	For any other monomial of $P_2$, by the maximality of $P_1$,
	it strictly divides some monomial of $P_1$, and
	equals some monomial of $\Diff{K}{P_1}$ up to a multiplication by a factor in $\Rat$. Because every monomial
	of $\Diff{K}{P_1}$ has a coefficient that is a multiple of $K = \alpha \times D$, we can
	compensate every monomial of $P_2$ by a monomial of $\Diff{K}{P_1}$.
	Therefore,
	$Q \in \Nat[\vec{X}]$.
\end{proof}

\begin{lemma}
	\label{lem:correct-to-n-rat}
	Let $P \in \Rel[\vec{X}]$.
	If $P \in \CorrectPoly$, then $P$ is \kl{represented}
	by a \kl{star-free $\Nat$-polyregular function},
	which is computable given $P$.
\end{lemma}
\begin{proof}
	We prove the result by induction on the number of indeterminates of $P$.
	In the proof, we write $\vec{X}$ for the indeterminates appearing in $P$,
	that is, we assume without loss of generality that all indeterminates are used.

	\textbf{Base case:} If the (unique) \kl{maximal monomial} of $P$ is a
	constant term. Since $P \in \CorrectPoly$, $P = n \in \Nat$, and therefore
	$P$ is \kl{represented} by a constant \kl{star-free $\Nat$-polyregular
		function}.

	\textbf{Induction:} Assume that $P$ is not a constant polynomial, and let
	us write $P = P_1 + P_2$ where $P_1$ is the sum of the \kl{maximal
		monomials} of $P$. We compute a bound $K$ such that $Q \defined
		(\Diff{K}{P_1} + \translate{K}(P_2)) \in \Nat[\vec{X}]$ 
        (\cref{derivation-stabilises-correct:lem}). In particular, $Q$ is
	\kl{represented} by a \kl{star-free $\Nat$-polyregular function} using
	\cref{n-poly-n-poly:example}, the latter being effectively computable from
	$Q$. Let us now remark that $P_1 \in \Nat[\vec{X}]$, and is therefore
	(effectively) \kl{represented} by a \kl{star-free $\Nat$-polyregular
		function} (using again \cref{n-poly-n-poly:example}). As a consequence,
	$\translate{K}(P) = P_1 + Q$ is (effectively) \kl{represented} by a
	function $f_\Delta$.

	For all partial valuations $\nu \colon \vec{X} \topartial \set{0, \dots,
			K}$ fixing at least one indeterminate, one can use the induction hypothesis
	to compute a \kl{star-free $\Nat$-polyregular function} $f_\nu$ that
	\kl{represents} $\restr{P}{\nu}$. This is possible because we assumed that
	all indeterminates in $\vec{X}$ are used in $P$.


	Let us assume that the alphabet over which the (\kl{commutative}) functions
	$f_\Delta$ and $f_\nu$ are defined is $\set{a_1, \dots, a_k}$, with $a_i$
	representing the indeterminate $X_i$ of the polynomials. Now, let us define
	by case analysis the following \kl{commutative} \kl{star-free
		$\Nat$-polyregular function}, defined on words $w$ of the form $w \defined
		a_1^{x_1} \cdots a_k^{x_k}$, with $x_1, \dots, x_k \geq 0$.

	\begin{equation*}
		f(w) \defined
		\begin{cases}
			f_{[X_i \mapsto x_i]}(w)                     & \text{ if } \exists i \in \set{1, \dots, k}, x_i \leq K \\
			f_\Delta(a_1^{x_1 - K} \cdots a_k^{x_k - K}) & \text{ otherwise }
		\end{cases}
		\quad .
	\end{equation*}
	Remark that
	$f$ is a \kl{commutative} \kl{star-free $\Nat$-polyregular function}
	that
	\kl{represents} $P$.
\end{proof}


While \cref{lem:correct-to-n-rat} provides an effective conversion procedure,
it does not explicitly state that the membership is decidable to keep the proof
clearer. A similar proof scheme can be followed to conclude that membership is
decidable, and even show that elements in $\CorrectPoly$ are, up to suitable
translations, polynomials in $\Nat[\vec{X}]$
(\cref{derivation-translation:lem}). Beware that partial applications are still
needed in this characterization, as \cref{bad-poly-translate:ex} illustrates. 

\begin{lemma}[restate=derivation-translation:lem,label=derivation-translation:lem]
	\proofref{derivation-translation:lem}
	Let $P \in \Rel[\vec{X}]$.
	There exists a computable number $K \in \Nat$
	such that the following are equivalent:
	\begin{enumerate}
		\item \label{d-t-correct:item} $P \in \CorrectPoly$,
		\item \label{d-t-transl:item}
		      for
		      all partial functions $\nu \colon \vec{X} \topartial \Nat$,
		      $\translate{K}(\restr{P}{\nu}) \in \Nat[\vec{X}]$,
		\item \label{d-t-transl-fin:item}
		      for all partial functions
		      $\nu \colon \vec{X} \topartial \set{0, \dots, K}$,
		      $\translate{K}(\restr{P}{\nu}) \in \Nat[\vec{X}]$.
	\end{enumerate}
	In particular, the above properties are decidable.
\end{lemma}

\begin{example}
	\label{bad-poly-translate:ex}
	The polynomial $\BadPoly$ is not a
	\kl{$\Nat$-rational polynomial},
	but is \kl{non-negative} and satisfies
	$\translate{10}(\BadPoly) \in \Nat[\vec{X}]$.
\end{example}

We now have all the tools to prove the corrected version of \cref{karh:thm}.

\begin{proofof}[corrected-version:thm]
	The implications
	\cref{corrected-4:item} $\implies$
	\cref{corrected-3:item} $\implies$
	\cref{corrected-2:item} are obvious.
	\cref{lem:correct-to-n-rat} proves
	\cref{corrected-1:item} $\implies$ \cref{corrected-4:item},
	while \cref{n-rat-correct:lem}
	proves
	\cref{corrected-2:item} $\implies$ \cref{corrected-1:item}.
	Note that the lemmas provide effective conversion procedures,
	and that
	\cref{derivation-translation:lem}
	also provides a decision
	procedure.
\end{proofof}


For completeness, let us remark that the counterexample of
\cref{thm:counter-example} uses three indeterminates, and this is not a
coincidence: in the particular cases of one or two indeterminates,  the classes
$\CorrectPoly$ and $\CoveredPoly$ coincide. In particular, the examples
appearing in \cite{KARH77} are not invalidated, as they all use at most two
indeterminates. Note that the equivalence is clear for the univariate case,
where being non-negative and having non-negative maximal coefficient clearly
imply being an \kl{$\Nat$-rational polynomial}.

\begin{lemma}
	\label{lem:correct-covered-2}
	$\CorrectPoly[X,Y] = \CoveredPoly[X,Y]$.
\end{lemma}
\begin{proof}
	It is clear that $\CorrectPoly[X,Y] \subseteq \CoveredPoly[X,Y]$,
	by considering the empty valuation $\nu \colon \set{X,Y} \topartial \Nat$.
	For the converse inclusion, let us consider $P(X,Y)$
	that is \kl{non-negative}, such that the \kl{maximal monomials}
	are  \kl{non-negative}.


	If we fix none of the variables, then the \kl{maximal monomials}
	are \kl{non-negative} by assumption. If we fix one of the
	variables, we can assume without loss of generality that we
	fix $X = k$ for some $k \in \Nat$.
	Then $P(k,Y)$ is a \kl{non-negative} \emph{univariate} polynomial,
	and therefore must either have a positive leading coefficient
	(which is the unique \kl{maximal monomial} in this case)
	or be constant equal to 0. In both cases, the \kl{maximal monomials}
	have positive coefficient.
	The same reasoning applies \emph{a fortiori} in the case where
	we fix the two indeterminates, leading to a constant polynomial.
\end{proof}

\subsection{From $\Rel$ to $\Rat$}
\label{sec:rel-to-rat}

\AP Let us complete our analysis of polynomials \kl{represented} by $\NRat$
or $\ZRat$ by considering polynomials with coefficients in $\Rat$, and
justify that all the combinatorial work has already happened in $\Rel$ and
$\Nat$. From \cref{n-sf-combinatorics:lem}, we know
that the polynomials that can be computed by \kl{star-free $\Nat$-polyregular
functions} are going to coincide (on large enough inputs) with \kl{natural binomial
functions}. For that reason, we introduce the following ``polynomial
counterpart" of a binomial coefficient: given two numbers $\ell,k \in \Nat$,
$\intro*\pbinom{X - \ell}{k}$ defined as $(X - \ell) \cdots (X - \ell - k) /
k!$,\footnote{ In particular, $\pbinom{X - \ell}{k}$ is defined to be $1$ when
$k = 0$, and $X - \ell$ when $k = 1$. } that we call a \intro{binomial
monomial}, and we introduce \intro{natural binomial polynomials} as $\Nat$-linear
combinations of products of \kl{binomial monomials}, i.e., of the shape:
$P(X_1, \dots, X_k) = \sum_{i = 1}^n n_i \prod_{j = 1}^k \pbinom{X_j -
p_{i,j}}{k_{i,j}}$. Similarly, we introduce the class of \intro{integer
binomial polynomials}, which are obtained by $\Rel$-linear combinations of
products of \kl{binomial monomials}.

\AP
These definitions are justified by the classical result of Pólya that
characterizes polynomials $P$ in $\Rat[X]$ that are \intro{integer-valued} (i.e., are such
that $P(\Rel) \subseteq \Rel$) as \kl{integer binomial polynomials}
\cite{POLYA1915,CACHA1996}. Note
that this result straightforwardly extends to multiple indeterminates as we
prove in \cref{integer-binomial-polynomial:lem}.

\begin{lemma}[restate=integer-binomial-polynomial:lem,label=integer-binomial-polynomial:lem]
	\proofref{integer-binomial-polynomial:lem}
	Let $P \in \Rat[X_1, \dots, X_k]$ be a polynomial.
	Then, $P$ is an \kl{integer binomial polynomial} if and only if
	$P(\Rel^k) \subseteq \Rel$, if and only if $P(\Nat^k) \subseteq \Rel$.
\end{lemma}

As an immediate corollary,  we completely characterize the class of polynomials
in $\Rat[\vec{X}]$ that are \kl{represented} by $\ZPoly$ as the \kl{integer
binomial polynomials}.

\begin{theorem}
	\label{integer-binomial-polynomials:cor}
	Let $P \in \Rat[\vec{X}]$. Then, the following properties are equivalent:
	\begin{enumerate}
        \item \label{int-bin-3:item} $P$ is \kl{integer-valued},
        \item \label{int-bin-2s:item} $P$ is \kl{represented} by a \kl{$\Rel$-rational series},
		\item \label{int-bin-2:item} $P$ is \kl{represented} by a \kl{$\Rel$-polyregular function},
		\item \label{int-bin-1:item} $P$ is \kl{represented} by a \kl{star-free $\Rel$-polyregular function},
		\item \label{int-bin-0:item} $P$ is an \kl{integer binomial polynomial}.
	\end{enumerate}
	These properties are furthermore decidable.
\end{theorem}
\begin{proof}
	The implications \cref{int-bin-1:item}
	$\implies$ \cref{int-bin-2:item} $\implies$ 
    \cref{int-bin-2s:item}
    $\implies$ \cref{int-bin-3:item} are obvious.
	Now, \cref{int-bin-3:item} $\implies$ \cref{int-bin-0:item} is a direct
	consequence of \cref{integer-binomial-polynomial:lem}.
	Finally, \cref{int-bin-0:item} $\implies$ \cref{int-bin-1:item} follows from the fact
	that $\pbinom{X - p}{k}$ is \kl{represented} by a \kl{star-free $\Rel$-polyregular function}
	defined by hardcoding the output values (in $\Rel$) when $0 \leq X \leq p$, and
	using a \kl{star-free $\Nat$-polyregular function} when $X > p$
	(\cref{binomial-function-star-free:lem}).
	Because
	$\ZSF$ is closed under products and $\Rel$-linear combinations, we conclude.
\end{proof}


\AP Obtaining an analogue of \cref{integer-binomial-polynomials:cor} for
\kl{$\Nat$-polyregular functions} requires a bit more work, as polynomials in
$\Rat[\vec{X}]$ that are \kl{represented} by $\NPoly$ are not exactly
\kl{natural binomial polynomials}
(see \cref{natural-binomial-polynomial-positive-bad:ex}). To address the issues
raised by the former example, we introduce the notion of \intro{strongly
natural binomial polynomials}, as the polynomials $P \in \Rat[X]$ such that for
all partial valuation $\nu \colon \topartial \Nat$, $\restr{P}{\nu}$ is a
\kl{natural binomial polynomial}, which characterizes the class of polynomials
that are \kl{represented} by $\NPoly$ (\cref{decide-rat-poly-npoly:cor}).

\begin{example}[restate=natural-binomial-polynomial-positive-bad:ex,label=natural-binomial-polynomial-positive-bad:ex]
	%\proofref{natural-binomial-polynomial-positive-bad:ex}
	The polynomial
	$Q(X,Y,Z) \defined \pbinom{X - 4}{1} \pbinom{Y}{1} \pbinom{Z}{1}
		+ 8 \pbinom{Y}{2} + 8 \pbinom{Z}{2} + 4$
    is a \kl{non-negative} \kl{natural binomial polynomial} in $\Rel[X,Y,Z]$,
	but cannot be computed by a \kl{star-free $\Nat$-polyregular function}.
    Indeed, 
    $Q(0,Y,Z)$ has a negative maximal monomial, hence $Q \not \in \CorrectPoly$,
    and we conclude using 
    \cref{corrected-version:thm}.
\end{example}


\begin{lemma}[restate=polyrec-integer-strong:lem,label=polyrec-integer-strong:lem]
    \proofref{polyrec-integer-strong:lem}
    Let $P \in \Rat[\vec{X}]$ be an \kl{integer-valued} polynomial, 
    and $n \in \Nat_{\geq 1}$ be
    such that $n P \in \CorrectPoly$.
    Then, $P$ is a \kl{strongly natural binomial polynomial}.
\end{lemma}

\begin{theorem}
	\label{decide-rat-poly-npoly:cor}
	Let $P \in \Rat[\vec{X}]$ be a polynomial with \emph{rational}
	coefficients and let $\alpha$ be the smallest number in $\Nat_{\geq 1}$
	such that $\alpha P \in \Rel[\vec{X}]$. Then, 
    the following are equivalent:
	\begin{enumerate}
        \item \label{rat-npoly-4:item} $\alpha P \in \CorrectPoly$ 
            and $P$ is \kl{integer-valued},
        \item \label{rat-npoly-0:item} $P$ is \kl{represented} by a \kl{$\Nat$-rational series},
		\item \label{rat-npoly-1:item} $P$ is \kl{represented} by a \kl{$\Nat$-polyregular function},
		\item \label{rat-npoly-2:item} $P$ is \kl{represented} by a \kl{star-free $\Nat$-polyregular function},
		\item \label{rat-npoly-3:item}
		      $P$ is a \kl{strongly natural binomial polynomial}.
	\end{enumerate}
	In particular, the properties are decidable.
\end{theorem}
\begin{proof}
    Let us first remark that $\NPoly \subseteq \NRat$,
    and that if $P$ is \kl{represented} by a function $f \in \NRat$,
    then said function has \kl{polynomial growth}, and in particular
    $f \in \NPoly$ thanks to \cref{polyregular-polynomial-growth:lemma}.
    As a consequence, \cref{rat-npoly-0:item} $\iff$ \cref{rat-npoly-1:item}.
    For the implication \cref{rat-npoly-1:item} $\implies$
    \cref{rat-npoly-4:item}, we obtain $\alpha P \in \CorrectPoly$ via
    \cref{corrected-version:thm} by remarking that \kl{$\Nat$-polyregular functions} have output in $\Nat$ and are closed under
    multiplication by a constant $\alpha \in \Nat$. The fact that $P$ is
    \kl{integer-valued} follows from
    \cref{integer-binomial-polynomials:cor} and the fact that
    $\NSF \subseteq \ZPoly$.
    The implication \cref{rat-npoly-4:item} $\implies$
    \cref{rat-npoly-3:item} is obtained thanks to \cref{polyrec-integer-strong:lem}.

    Let us now prove by induction on the number of indeterminates that
    \cref{rat-npoly-3:item} $\implies$
    \cref{rat-npoly-2:item}. Note that by construction, there exists a
    number $K \in \Nat$ such that when the input values of $P$ are all greater
    than $K$, $P$ coincides with a \kl{natural binomial function}, which is
    itself \kl{represented} by a \kl{star-free $\Nat$-polyregular function}. If
    some input value $X_i$ is set to a number $x_i \leq K$, then one can
    leverage the fact that $\restr{P}{X_i = x_i}$ remains a \kl{strongly
    natural binomial polynomial} to conclude by induction that $\restr{P}{X_i =
    x_i}$ is \kl{represented} by a \kl{star-free $\Nat$-polyregular function}.
    Combining these, we obtain a \kl{star-free $\Nat$-polyregular function}
    \kl{representing} $P$.

    Finally, the implication  \cref{rat-npoly-2:item} $\implies$ \cref{rat-npoly-1:item} is
    immediate as $\NSF \subseteq \NPoly$.
\end{proof}

Let us remark that \cref{decide-rat-poly-npoly:cor} shows that the
class of polynomials \kl{represented} by $\NPoly$ is the same as the class of
polynomials \kl{represented} by $\NSF$, which is a non-trivial statement that
will be reused in the study of more general \kl{commutative} functions in
$\ZPoly$.
